      *$XIDPGM   PROC =PRC9100   150211 153130
      *$XIDPGM   ENT =MAIN O-TYPE =9050  M-DEVT =COBOL
      *$XIDPGM   NOM-OCC =FADR201   M-PRO =STG
       IDENTIFICATION DIVISION.

      ***   ENVIRONNEMENT  TBEN   ***

      *=========================================================9000=*
      *                                                              *
      *               PROGRAMME CICS AVEC PILOTAGE INTEGRE           *
      *                                                              *
      *==============================================================*
      *$XINCLUDE XGENFADR201 SPEC  4101LIBR  FADR201 STDFADR201A        INL
      *==============================================================*
      *     PROGRAM : FADR201    TP    MAIN                          *
      *        LOAD : FADR201                                        *
      *                                                              *
      *      ZOOM SAISIE SECONDE ADRESSE                             *
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * SAISIE DE LA SECONDE ADRESSE PAR ZOOM                        *
      * SUR ADRESSE DE IDEN                                          *
      *                                                              *
      *                                                              *
      *--------------------------------------------------------------*
      *   PROC.=M    DC SYST=CICS             TR.CODE=ADR2           *
      *              DB SYST=DB2                                     *
      *                                                              *
      *--------------------------------------------------------------*
      *   GENERATION ........... : 21-08-00                          *
      *==============================================================*
       PROGRAM-ID. FADR201 .
      *$XENDINCLUDE
      *
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
      *
           EJECT
       DATA DIVISION.
       WORKING-STORAGE SECTION.
      *
      *$XINCLUDE XGENFADR201 DATA  4211LIBR  FADR201 STDFADR201D        INL
       01  STDP-FADR201.
      *--------------------------------------------------------------*
      * PROGRAM'S STANDARD DATA                   GENERAT.: 21-08-00 *
      *--------------------------------------------------------------*
      *
           05  STDP-NOM-FONC     PIC X(4)  VALUE 'ADR2'.
      *
           05  STDP-NOM-PGM      PIC X(8)  VALUE 'FADR201'.
           05  STDP-CODE-TRN     PIC X(8)  VALUE 'ADR2'.
           05  STDP-NOM-OBJ      PIC X(8)  VALUE 'FADR201'.
      *
           05  STDP-NBMAX        PIC S9(04) COMP VALUE +1.
           05  STDP-IND          PIC S9(04) COMP VALUE ZERO.
      *
           05  STDP-TAB-ECR.
               10  FILLER        PIC X(02) VALUE '01'.
               10  FILLER        PIC X(08) VALUE 'ADR201'.
               10  FILLER        PIC X(01) VALUE ' '.
               10  FILLER        PIC X(01) VALUE '1'.
               10  FILLER        PIC X(40) VALUE
                   'ZOOM SAISIE SECONDE ADRESSE'.
               10  FILLER        PIC X(08) VALUE 'ADR201S'.
               10  FILLER        PIC X(08) VALUE 'ADR201M'.
               10  FILLER        PIC X(08) VALUE  SPACE.
      *
           05  STDP-ECRANS  REDEFINES STDP-TAB-ECR.
               10  STDP-ECRAN  OCCURS  1.
                   15  STDP-NUMECR    PIC X(02).
                   15  STDP-NOMECR    PIC X(08).
                   15  STDP-TEMPS     PIC X(01).
                   15  STDP-LIGACT    PIC X(01).
                   15  STDP-LIBECR    PIC X(40).
                   15  STDP-MAPS      PIC X(08).
                   15  STDP-MAP       PIC X(08).
                   15  STDP-PTEARMIDE PIC X(08).
      *
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST0000DA                        STDST0000DA        INL
      *--------------------------------------------------------------*  00010069
      *  PROGRAM'S STANDARD VARIABLES                                *  00020099
      *--------------------------------------------------------------*  00030069
       01  WS-STD.                                                      00040069
      *                                                                 00050099
      *----INFORMATIONS ON STANDARD PROCESSINGS                         00060099
           05  WS-FONC-SERVICE.                                         00070069
               10  WS-ACTNOM-STPF01    VALUE 'AIDC'        PIC  X(08).  00080099
               10  WS-ACTNOM-STPF02    VALUE 'STPF02'      PIC  X(08).  00090087
               10  WS-ACTNOM-TPF3      VALUE 'TPF3'        PIC  X(08).  00100099
               10  WS-ACTNOM-STPF04    VALUE 'STPF04'      PIC  X(08).  00110087
               10  WS-ACTNOM-STPF05    VALUE 'STPF05'      PIC  X(08).  00120087
               10  WS-ACTNOM-STLACT    VALUE 'STLACT'      PIC  X(08).  00130087
               10  WS-ACTNOM-AIDK      VALUE 'AIDK'        PIC  X(04).  00140099
      *----PGM FOR MANAGEMENT OF USER'S AUTHORIZATIONS                  00150099
               10  WS-PIAUTO-PGM       VALUE 'PIAUTO'      PIC  X(08).  00160099
      *----PGM FOR CHAINING MANAGEMENT                                  00170099
               10  WS-STENCH-PGM       VALUE 'STENCH'      PIC  X(08).  00180099
      *----PGM FOR MESSAGE MANAGEMENT                                   00190099
               10  WS-STDMSG-SUBR      VALUE 'ST1000T'     PIC  X(08).  00200082
               10  WS-STDMSG-MSG                           PIC  X(71)   00210099
                                       VALUE                            00220091
                 'PROGRAMME ST1000T NON OPERATIONNEL OU INDISPONIBLE'.  00230091
      *----PGM FOR SCREEN'S FIELDS PROTECTION                           00240099
               10  WS-ST6000-PGM       VALUE 'ST6000'      PIC  X(08).  00250099
      *----PGM FOR ERROR LOGGING                                        00260099
               10  WS-STERROR-PGM      VALUE 'STER01T'     PIC  X(08).  00270099
      *----TRN DISPLAYING ERROR                                         00280099
               10  WS-STERROR-TRN      VALUE 'STER'        PIC  X(04).  00290099
      *----NAME OF CONTEXT/DESCRIPTOR TS                                00300099
               10  WS-TS-CTXT-NOM      VALUE '£CTX'        PIC  X(04).  00310096
               10  WS-TS-DSCT-NOM      VALUE '£DSC'        PIC  X(04).  00320096
      *----NAME OF TS FOR SCREEN STORAGE/RECALL                         00330099
               10  WS-TS-PF2-NOM1      VALUE '£PF2'        PIC  X(04).  00340099
               10  WS-TS-PF2-NOM2      VALUE '$PF2'        PIC  X(04).  00350099
      *----NAME OF TS FOR USER'S AUTHORIZATIONS                         00360099
               10  WS-TS-AUTO-NOM      VALUE '£AUT'        PIC  X(04).  00370099
      *----NAME (BY DEFAULT) OF CICS USER                               00380099
               10  WS-CICSUSER-NOM     VALUE 'CICSUSER'    PIC  X(08).  00390099
      *                                                                 00400099
      *----INFORMATIONS ON INTERACTION VALUE                            00410099
           05  WS-CDINTERACT                               PIC  X(01).  00420069
               88  PREMI-INTERACT      VALUE '1'.                       00430069
               88  NIEME-INTERACT      VALUE 'N'.                       00440069
      *                                                                 00450099
      *----INFORMATIONS ON INPUT VALUE                                  00460099
           05  WS-ENTREE                                   PIC  X(02).  00470069
               88  ENT-RUPTURE-FC     VALUE 'IF'.                       00480069
               88  ENT-RUPTURE-EC     VALUE 'IE'.                       00490069
               88  ENT-APPL-FONC      VALUE 'AF'.                       00500069
               88  ENT-RETR-FONC      VALUE 'RF'.                       00510069
               88  ENT-APPL-ECRN      VALUE 'AE'.                       00520069
               88  ENT-RETR-ECRN      VALUE 'RE'.                       00530069
               88  ENT-APPL-SVCE      VALUE 'AS'.                       00540069
               88  ENT-RETR-SVCE      VALUE 'RS'.                       00550069
           05  WS-ENTREE-R REDEFINES WS-ENTREE.                         00560069
               10  WS-ENTREE-TYPE                          PIC  X(01).  00570069
               10  FILLER                                  PIC  X(01).  00580069
      *                                                                 00590099
      *----INFORMATIONS ON OUTPUT VALUE                                 00600099
           05  WS-SORTIE                                   PIC  X(02).  00610069
               88  SOR-ENVOI-MESS        VALUE 'EM'.                    00620069
               88  SOR-ENCH-TRAIT        VALUE 'ET'.                    00630069
               88  SOR-APPL-FONC         VALUE 'AF'.                    00640069
               88  SOR-RETR-FONC         VALUE 'RF'.                    00650069
               88  SOR-APPL-ECRN         VALUE 'AE'.                    00660069
               88  SOR-RETR-ECRN         VALUE 'RE'.                    00670069
               88  SOR-APPL-SVCE         VALUE 'AS'.                    00680069
               88  SOR-RETR-SVCE         VALUE 'RS'.                    00690069
               88  SOR-RETR-MENU         VALUE 'RM'.                    00700069
      *                                                                 00710099
      *----INFORMATIONS ON STATUS OF RECEIVED MESSAGE                   00720099
           05  WS-STATUT-MESSAGE                           PIC  X(01).  00730069
               88  LECTURE-MESSAGE       VALUE 'L'.                     00740069
               88  IGNORE-MESSAGE        VALUE 'I'.                     00750069
      *                                                                 00760099
      *----INFORMATIONS ON PROCESSING                                   00770099
           05  WS-TRAITEMENT.                                           00780069
               10  WS-ENC-ECET.                                         00790072
                   15  WS-ENC-EC                           PIC  X(02).  00800079
                   15  WS-ENC-ET.                                       00810072
                       20  WS-ENC-ET-I                     PIC  X.      00820072
                       20  WS-ENC-ET-N                     PIC  X.      00830072
               10  WS-CODACT.                                           00840080
                   15  WS-TF                               PIC  X(02).  00850080
                   15  WS-CMDE                             PIC  X(02).  00860080
               10  WS-TRAIT.                                            00870069
                   15  WS-TRAIT-PREF                       PIC  X(01).  00880069
                   15  WS-TRAIT-NOM                        PIC  X(04).  00890099
               10  WS-TRAIT-RESULTAT                       PIC  X(02).  00900069
               10  WS-NECET.                                            00910080
                   15  WS-NECRN                            PIC  X(02).  00920080
                   15  WS-NETAT.                                        00930080
                       20  WS-NETAT-I                      PIC  X(01).  00940080
                       20  WS-NETAT-N                      PIC  X(01).  00950080
           05  WS-ENC-ECET-INI                             PIC  X(04).  00960099
      *                                                                 00970099
      *----COMMAREA USED BY THE ERROR DISPLAY TRANSACTION               00980099
           05  WS-ER-COMMAREA.                                          00990099
               10  WS-ER-COMMAREA-DATE               PIC  S9(7) COMP-3. 01000099
               10  WS-ER-COMMAREA-DATE-DB2           PIC  X(10).        01010099
               10  WS-ER-COMMAREA-HEURE              PIC  S9(7) COMP-3. 01020099
               10  WS-ER-COMMAREA-HEURE-DB2          PIC  X(8).         01030099
               10  WS-ER-COMMAREA-TACHE              PIC  S9(7) COMP-3. 01040099
               10  WS-ER-COMMAREA-CTRANS             PIC  X(4).         01050099
               10  WS-ER-COMMAREA-ORIG               PIC  X(5).         01060099
               10  WS-ER-COMMAREA-TYPE               PIC  X(4).         01070099
               10  WS-ER-COMMAREA-ERREUR             PIC  X(8).         01080099
               10  WS-ER-COMMAREA-USER               PIC  X(8).         01090099
      *                                                                 01100099
      *----INFORMATIONS ON TRANSITION                                   01110099
           05  WS-TR-IND                                   PIC  X(01).  01120099
               88  TRANSIT-OUI            VALUE '1'.                    01130099
               88  TRANSIT-NON            VALUE 'N'.                    01140099
      *                                                                 01150099
      *----INFORMATIONS ON CHAINING WITH EXTERNAL COMMAND               01160099
           05  WS-FONCSVT-CMDE.                                         01170089
               10  WS-FONCSVT-IDOPE                        PIC  X(04).  01180099
               10  WS-FONCSVT-ARGUM                        PIC  X(20).  01190089
               10  WS-FONCSVT-ARGUM-C REDEFINES WS-FONCSVT-ARGUM        01200099
                                               OCCURS 20   PIC  X(01).  01210099
      *                                                                 01220099
      *----INFORMATIONS "SEND MAP ERASE"                                01230099
           05  WS-TOPERMAP                                 PIC  X(01).  01240095
      *                                                                 01250099
      *----INFORMATIONS "TOP SCREEN RUPTURE"                            01260099
           05  WS-TOPEC                                    PIC  X(01).  01270099
           05  WS-TOP-PREPINI                              PIC  X(01).  01280099
      *                                                                 01290099
      *----INFORMATIONS "SEND MAP BITS MDT ON"                          01300099
           05  WS-TOPMDTON                                 PIC  X(01).  01310099
           05  WS-TOPMDTON-ALL                             PIC  X(01).  01320099
      *                                                                 01330099
      *----NUMBER OF MODIFIED SCREEN FIELDS                             01340099
           05  WS-EN-NBCHM                            COMP PIC S9(04).  01350099
      *                                                                 01360099
      *----INFORMATIONS ON ACTION LINE SCROLLING                        01370099
           05  WS-SCROLL                                   PIC  X(01).  01380069
               88  SCROLL-OUI             VALUE '1'.                    01390099
               88  SCROLL-NON             VALUE 'N'.                    01400069
      *                                                                 01410099
      *----INFORMATIONS ON ACTIVATED COMMAND DETECTION                  01420099
           05  WS-DET-COMMANDE.                                         01430069
               10  WS-DET-I                           COMP PIC S9(04).  01440069
               10  WS-DET-NUMLIG                      COMP PIC S9(04).  01450069
      *                                                                 01460099
      *----DISPLAY MESSAGE END FUNCTION/FUNCTIONAL PROCEDURE            01470099
           05  WS-MESSAGE.                                              01480092
               10  WS-MESSAGE-ATTR                         PIC  X(07)   01490099
                                          VALUE '     A&'.              01500094
               10  WS-MESSAGE-FONC                         PIC  X(04).  01510099
               10  WS-MESSAGE-PARAM                        PIC  X(76).  01520099
               10  WS-MESSAGE-MESS                         PIC  X(79).  01530099
      *                                                                 01540099
      *----INFORAMTIONS ON CODE HELP WITH LINKED FIELDS MANAGEMENT      01550099
           05  WS-CTRLET.                                               01560099
               10  WS-CTRLET-APPEL                         PIC  X(01).  01570099
               10  WS-CTRLET-CDERR                         PIC  X(01).  01580099
               10  WS-CTRLET-INDICE                   COMP PIC S9(04).  01590099
               10  WS-CTRLET-INDICE-R REDEFINES                         01600099
                   WS-CTRLET-INDICE                        PIC  X(02).  01610099
               10  WS-CTRLET-LIEN                          PIC  X(03).  01620099
               10  WS-CTRLET-IDENT             OCCURS 3.                01630099
                   15  WS-CTRLET-POSCHP               COMP PIC S9(04).  01640099
                   15  WS-CTRLET-LGNCHP               COMP PIC S9(04).  01650099
                   15  WS-CTRLET-TABCTRL                   PIC  X(08).  01660099
                   15  WS-CTRLET-NOM-BI                    PIC  X(16).  01670099
                   15  WS-CTRLET-NOM-MAP                   PIC  X(08).  01680099
                   15  WS-CTRLET-ATTRIBUT-INI              PIC  X(01).  01690099
                   15  WS-CTRLET-ATTRIBUT-MOD              PIC  X(01).  01700099
               10  WS-CTRLET-PARM              OCCURS 3.                01710099
                   15  WS-CTRLET-PARM-C        OCCURS 40   PIC  X(01).  01720099
      *                                                                 01730099
      *----DIFFERENT WORK AREAS --------------------------------------  01740099
           05  WS-TRAVAIL.                                              01750079
               10  WS-LGAUTO                          COMP PIC S9(04).  01760099
               10  WS-TSDES-LG         VALUE +4       COMP PIC S9(04).  01770099
               10  WS-TS-ID.                                            01780079
                   15  WS-TS-TRMID                         PIC  X(04).  01790079
                   15  WS-TS-NOM                           PIC  X(04).  01800079
               10  WS-AUTO-ITEM                       COMP PIC S9(04).  01810099
               10  WS-TSCO-ITEM                       COMP PIC S9(04).  01820099
               10  WS-TSDES-ITEM                      COMP PIC S9(04).  01830099
               10  WS-TS-ITEM                         COMP PIC S9(04).  01840099
               10  WS-ITEM-TRAV                            PIC  9(04).  01850099
               10  WS-LGCOM                           COMP PIC S9(04).  01860099
               10  WS-TRAIT-PILOTE                         PIC  X(02).  01870079
      *----PRINTERS ASSOCIATED TO THE TERMINAL                          01880099
               10  WS-TERM-PRINTER                         PIC  X(04).  01890099
               10  WS-TERM-ALTPRINTER                      PIC  X(04).  01900099
      *----SQLCODE AREA IN CHAR, FOR DUMP AADF DB2                      01910099
               10  WS-SQLCODEX            VALUE ZERO       PIC  ++++.   01920099
      *----DIBSTAT AREA,         FOR DUMP AADF DL1                      01930099
               10  WS-DIBSTAT.                                          01940099
                   15  FILLER             VALUE 'DH'       PIC  X(02).  01950099
                   15  WS-DIBSTAT2                         PIC  X(02).  01960099
      *----TIME                                                         01970099
               10  WS-EIBTIME                              PIC  9(07).  01980069
               10  WS-EIBTIME-X  REDEFINES WS-EIBTIME.                  01990069
                   15  WS-ZONE1                            PIC  X(01).  02000069
                   15  WS-INFO-HEURE.                                   02010069
                       20  WS-HH                           PIC  X(02).  02020069
                       20  WS-MM                           PIC  X(02).  02030069
                       20  WS-SS                           PIC  X(02).  02040069
      *----CPU DATES AND PROCESSING                                     02050099
               10  WS-TABDATE                              PIC  X(24)   02060069
                       VALUE  '312831303130313130313031'.               02070069
               10  WS-TABDATE-JJ  REDEFINES  WS-TABDATE                 02080069
                                               OCCURS  12  PIC  9(02).  02090099
      *                                                                 02100099
               10  WS-DAT-AAMMJJ                           PIC  9(06).  02110069
               10  WS-DAT-AAMMJJ-R  REDEFINES  WS-DAT-AAMMJJ.           02120069
                   15  WS-DAT-AA                           PIC  9(02).  02130069
                   15  WS-DAT-MM                           PIC  9(02).  02140069
                   15  WS-DAT-JJ                           PIC  9(02).  02150069
      *                                                                 02160099
               10  WS-DAT-AAQQQ                            PIC  9(05).  02170069
               10  WS-DAT-AAQQQ-R  REDEFINES  WS-DAT-AAQQQ.             02180069
                   15  WS-DAT-Q-AA                         PIC  9(02).  02190069
                   15  WS-DAT-Q-JJ                         PIC  9(03).  02200069
      *                                                                 02210099
               10  WS-CPT                    COMP-3        PIC  S9(05). 02220069
               10  WS-RESTE                  COMP-3        PIC  S9(05). 02230069
                                                                        02231099
      *----CPU DATE  DB2 FORMAT                                         02232099
               10  WS-DTCPU-DB2.                                        02233099
                   15  WS-DTCPU-DB2-JJ                     PIC  9(02).  02234099
                   15  WS-DTCPU-DB2-POINT1                 PIC  X(01).  02235099
                   15  WS-DTCPU-DB2-MM                     PIC  9(02).  02236099
                   15  WS-DTCPU-DB2-POINT2                 PIC  X(01).  02237099
                   15  WS-DTCPU-DB2-AAAA                   PIC  9(04).  02238099
                   15  FILLER  REDEFINES  WS-DTCPU-DB2-AAAA.            02239099
                       20  WS-DTCPU-DB2-SS                 PIC  9(02).  02239199
                       20  WS-DTCPU-DB2-AA                 PIC  9(02).  02239299
                                                                        02239399
      *----CPU DATE  CCYYMMDD FORMAT                                    02240099
               10  WS-DTCPU                                PIC  9(08).  02250069
               10  WS-DTCPU-X           REDEFINES WS-DTCPU.             02260069
                   15  WS-DTCPU-S                          PIC  9(02).  02270069
                   15  WS-DTCPU-S-X     REDEFINES WS-DTCPU-S            02280069
                                                           PIC  X(02).  02290099
                   15  WS-DTCPU-AMJ                        PIC  9(06).  02300069
                   15  WS-DTCPU-AMJ-X   REDEFINES WS-DTCPU-AMJ.         02310069
                       20  WS-DTCPU-AA                     PIC  9(02).  02320069
                       20  WS-DTCPU-AA-X REDEFINES WS-DTCPU-AA          02330069
                                                           PIC  X(02).  02340069
                       20  WS-DTCPU-MM                     PIC  9(02).  02350069
                       20  WS-DTCPU-MM-X REDEFINES WS-DTCPU-MM          02360069
                                                           PIC  X(02).  02370069
                       20  WS-DTCPU-JJ                     PIC  9(02).  02380069
                       20  WS-DTCPU-JJ-X REDEFINES WS-DTCPU-JJ          02390069
                                                           PIC  X(02).  02400069
      *----CPU DATE  JULLIAN FORMAT (CCYYDDD)                           02410099
               10  WS-DQCPU                                PIC  9(07).  02420069
               10  WS-DQCPU-X REDEFINES WS-DQCPU.                       02430069
                   15  WS-DQCPU-S                          PIC  9(02).  02440069
                   15  WS-DQCPU-S-X     REDEFINES WS-DQCPU-S            02450069
                                                           PIC  X(02).  02460069
                   15  WS-DQCPU-AQ                         PIC  9(05).  02470069
                   15  WS-DQCPU-AQ-X    REDEFINES WS-DQCPU-AQ.          02480069
                       20  WS-DQCPU-AA                     PIC  9(02).  02490069
                       20  WS-DQCPU-AA-X REDEFINES WS-DQCPU-AA          02500069
                                                           PIC  X(02).  02510069
                       20  WS-DQCPU-QQ                     PIC  9(03).  02520069
                       20  WS-DQCPU-QQ-X REDEFINES WS-DQCPU-QQ          02530069
                                                           PIC  X(03).  02540069
      *----PROCESSING DATE  JULLIAN FORMAT (CCYYDDD)                    02550099
               10  WS-DQTRT                                PIC  9(07).  02560069
               10  WS-DQTRT-X REDEFINES WS-DQTRT.                       02570069
                   15  WS-DQTRT-S                          PIC  9(02).  02580069
                   15  WS-DQTRT-S-X     REDEFINES WS-DQTRT-S            02590069
                                                           PIC  X(02).  02600069
                   15  WS-DQTRT-AQ                         PIC  9(05).  02610069
                   15  WS-DQTRT-AQ-X    REDEFINES WS-DQTRT-AQ.          02620069
                       20  WS-DQTRT-AA                     PIC  9(02).  02630069
                       20  WS-DQTRT-AA-X REDEFINES WS-DQTRT-AA          02640069
                                                           PIC  X(02).  02650069
                       20  WS-DQTRT-QQ                     PIC  9(03).  02660069
                       20  WS-DQTRT-QQ-X REDEFINES WS-DQTRT-QQ          02670069
                                                           PIC  X(03).  02680069
      *----AREA FOR DATE TRANSFORMATION IN DB2 FORM                     02690099
               10  WS-DB2-DATE.                                         02700099
                   15  WS-DB2-JJ                           PIC  9(02).  02710099
                   15  WS-DB2-JJ-POINT                     PIC X        02720099
                                                    VALUE         '.'.  02730099
                   15  WS-DB2-MM                           PIC  9(02).  02740099
                   15  WS-DB2-MM-POINT                     PIC X        02750099
                                                    VALUE         '.'.  02760099
                   15  WS-DB2-SSAA                         PIC  9(04).  02770099
                   15  FILLER REDEFINES WS-DB2-SSAA.                    02780099
                       20  WS-DB2-SS                       PIC  9(02).  02790099
                       20  WS-DB2-AA                       PIC  9(02).  02800099
      *----AREA FOR DATE TRANSFORMATION IN CCYYMMDD FORM                02810099
               10  WS-AFFICH-DATE.                                      02820099
                   15  WS-AFFICH-SSAA                      PIC  9(04).  02830099
                   15  FILLER REDEFINES WS-AFFICH-SSAA.                 02840099
                       20  WS-AFFICH-SS                    PIC  9(02).  02850099
                       20  WS-AFFICH-AA                    PIC  9(02).  02860099
                   15  WS-AFFICH-MM                        PIC  9(02).  02870099
                   15  WS-AFFICH-JJ                        PIC  9(02).  02880099
               10  WS-AFFICH-DATE-X REDEFINES WS-AFFICH-DATE            02890099
                                                           PIC  9(08).  02900099
      *----AREA FOR TIME TRANSFORMATION IN DB2 FORM                     02910099
               10  WS-DB2-TIME.                                         02920099
                   15  WS-DB2-TIMHH                        PIC  9(02).  02930099
                   15  FILLER                              PIC  X       02940099
                                                    VALUE         '.'.  02950099
                   15  WS-DB2-TIMMM                        PIC  9(02).  02960099
                   15  FILLER                              PIC X        02970099
                                                    VALUE         '.'.  02980099
                   15  WS-DB2-TIMSS                        PIC  9(02).  02990099
      *----AREA FOR TIME TRANSFORMATION IN HHMMSS FORM                  03000099
               10  WS-AFFICH-TIME.                                      03010099
                   15  WS-AFFICH-TIMHH                     PIC  9(02).  03020099
                   15  WS-AFFICH-TIMMM                     PIC  9(02).  03030099
                   15  WS-AFFICH-TIMSS                     PIC  9(02).  03040099
               10  WS-AFFICH-TIME-X REDEFINES WS-AFFICH-TIME            03050099
                                                           PIC  9(06).  03060099
      *----DC SESSION IDENT                                             03070099
               10  WS-SESS-ID                              PIC  X(08).  03080069
               10  FILLER REDEFINES WS-SESS-ID.                         03090099
                   15  FILLER                              PIC  X(04).  03100099
                   15  WS-SESS-IDCICS                      PIC  X(04).  03110099
      *----USER-ID                                                      03120069
               10  WS-USER-ID                              PIC  X(08).  03130069
      *----ITERATION INDICATOR ON INTERACTION                           03140099
               10  WS-TEST-ITER                            PIC  X(01).  03150069
      *----NAME OF FUNCTIONAL-PROCEDURE PILOTE                          03160099
               10  WS-NOM-PILOTE-PF.                                    03170069
                   15  FILLER                              PIC  X       03180070
                                                    VALUE         'F'.  03190070
                   15  WS-PILOTE-PF                        PIC  X(07).  03200079
      *----INFORMATIONS FOR AIDC FUNCTION                               03210099
               10  WS-AIDC.                                             03220099
                   15  WS-AIDC-NOM-CHP                     PIC  X(08).  03230099
                   15  WS-AIDC-NOM-BI                      PIC  X(16).  03240099
      *----NAME OF FIELDS WITH OR WITHOUT SUFFIX                        03250099
               10  WS-NOM-CHPOCC.                                       03260099
                   15  WS-NOM-CHPOCC-CAR       OCCURS 8    PIC  X(01).  03270099
               10  WS-NOM-CHP.                                          03280099
                   15  WS-NOM-CHP-CAR          OCCURS 8    PIC  X(01).  03290099
      *----CURSOR POSITION IN RECEPTION                                 03300099
               10  WS-CURSEUR-POS                    COMP  PIC S9(04).  03310069
               10  WS-CURSEUR-LIG                    COMP  PIC S9(04).  03320069
               10  WS-CURSEUR-COL                    COMP  PIC S9(04).  03330069
      *----COLUMN NUMBER FOR END OF FIELD                               03340099
               10  WS-CHAMP-COLFIN                   COMP  PIC S9(04).  03350069
      *                                                                 03360099
      *----TABLE FOR STORAGE OF DESCRIPTOR OUTPUT DATA                  03370099
           05  WS-EN-NBCHPS                          COMP  PIC S9(04)   03380099
                                                    VALUE        +250.  03390099
           05  WS-DSC-CHAMPS-OUTPUT.                                    03400069
               10  WS-STDP-IND                       COMP  PIC S9(04).  03410099
               10  WS-POS-CURS                       COMP  PIC S9(04).  03420099
               10  WS-DSC-CHAMP-OUTPUT         OCCURS 250.              03430099
                   15  WS-DSC-ATTRIBUT                     PIC  X(01).  03440099
                   15  WS-DSC-COULEUR                      PIC  X(01).  03450099
                   15  WS-DSC-HILIGHT                      PIC  X(01).  03460099
                   15  WS-DSC-VALIDATION                   PIC  X(01).  03470099
           05  WS-DSC-ATTR.                                             03480099
               10  WS-DSC-ATTR-LIGNE           OCCURS  12               03490099
                                    INDEXED  BY  WS-DSC-ATTR-IND.       03500099
                   15  WS-DSC-ATTR-MDTOFF                  PIC  X(01).  03510099
                   15  WS-DSC-ATTR-MDTON                   PIC  X(01).  03520099
           05  WS-DSC-ATTR-VALEURS                         PIC  X(24)   03530099
                                     VALUE ' WAAIIBBCCDPJQERFSKTGUHV'.  03540099
      *                                                                 03550099
      *--- WORK AREAS OF LINKED FIELDS                                  03560099
           05  WS-LIEN-CHP-WRK                             PIC X(08).   03570099
           05  WS-LIEN-CHP-TABLE.                                       03580099
               10  WS-LIEN-CHP-LIGNE           OCCURS 250               03590099
                                    INDEXED  BY  WS-LIEN-CHP-IND.       03600099
                   15  WS-LIEN-CHP-GAUCHE                  PIC X(08).   03610099
                   15  WS-LIEN-CHP-NBOCC                   PIC 9(02).   03620099
                   15  WS-LIEN-CHP-TYPE                    PIC X(03).   03630099
                   15  WS-LIEN-CHP-DROITE                  PIC X(08).   03640099
                   15  WS-LIEN-GAUCHE-POS                  PIC 9(04).   03650099
                   15  WS-LIEN-GAUCHE-LONG                 PIC 9(03).   03660099
                   15  WS-LIEN-TABLE-CTRL                  PIC X(08).   03670099
      *                                                                 03680099
      *----WORK TABLE OF INFORMATION BASE FIELDS                        03690099
           05  CHPBI-NOM-TABLE.                                         03700099
               10  CHPBI-NOM-LIGNE             OCCURS 250               03710099
                                    INDEXED  BY  CHPBI-NOM-IND.         03720099
                   15  CHPBI-NOM-DEVT                      PIC  X(08).  03730099
                   15  CHPBI-CHP-NBOCC                     PIC  9(02).  03740099
                   15  CHPBI-NOM-BI                        PIC  X(16).  03750099
      *                                                                 03760099
      *----DIRECT ENTRY IN FUNCTION: RECEPTION AREA                     03770099
      *----  (TRANSACTION CODE + OPTIONAL DATA)                         03780099
           05  WS-ZONLECT.                                              03790069
               10  WS-ZLECT-LONG                     COMP  PIC S9(04).  03800082
               10  WS-ZLECT.                                            03810069
                   15  WS-ZLECT-TRNID                      PIC  X(04).  03820085
                   15  WS-ZLECT-IDENT                      PIC  X(300). 03830099
                   15  WS-ZLECT-IDENT-C REDEFINES WS-ZLECT-IDENT        03840083
                                               OCCURS 300  PIC  X(01).  03850099
      *                                                                 03860099
      *----INFORMATIONS ON 'STPF02' TS AND 'STPF03' TS                  03870099
           05  WS-ZONPF2-PF3.                                           03880070
               10  WTS-LENGTH                        COMP  PIC S9(04)   03890082
                                                    VALUE         +43.  03900099
               10  WTS-MONO.                                            03910070
                   15  WTS-MONO-CFORCE                     PIC  9(01)   03920099
                                                    VALUE           0.  03930099
                   15  WTS-MONO-EIBTRNID                   PIC  X(04).  03940099
                   15  WTS-MONO-EIBCPOSN             COMP  PIC S9(04).  03950082
                   15  WTS-MONO-USERID                     PIC  X(08).  03960099
                   15  WTS-MONO-POSTE          OCCURS 7.                03970099
                       20  WTS-MONO-ANCNOM                 PIC  X(04).  03980099
               10  WTS-LENGTH2                       COMP  PIC S9(04)   03990099
      *                                             VALUE         +15.  04000099
                                                    VALUE         +16.  04001099
      *                                                                 04010099
      *----WORK AREAS "INQUIRE TRANSACTION/PROGRAM"                     04020099
           05  WS-ZINQUIRE.                                             04030099
               10  WS-ZINQUIRE-TRANID                      PIC  X(04).  04040099
               10  WS-ZINQUIRE-PGRMID                      PIC  X(08).  04050099
               10  WS-ZINQUIRE-STATUST               COMP  PIC S9(09).  04060099
               10  WS-ZINQUIRE-STATUSP               COMP  PIC S9(09).  04070099
      *                                                                 04080099
      *----WORK AREAS "RECEIVE BUFFER / BACKUP FUNCTION COMMAREA"       04090099
       01  WS-ZONRECB-LONG                           COMP  PIC S9(04).  04100099
       01  WS-ZONTRAV                                      PIC  X(5120).04110099
      *$XENDINCLUDE
           EJECT
       01  WS-COMMAREA-ENCH.
      *$XINCLUDE ZSTDSTENCH                          STDSTENCH          INL
      *--------------------------------------------------------------*  00010001
      *  COMMAREA FOR CHAINING MANAGEMENT                            *  00020007
      *--------------------------------------------------------------*  00030001
           05  WS-ENCH-RETOUR                              PIC  X(02).  00040001
           05  WS-ENCH-NOMESS                              PIC  X(06).  00050001
           05  WS-ENCH-PMESS                    OCCURS 3   PIC  X(20).  00060004
           05  WS-ENCH-NOM-FONC                            PIC  X(04).  00070001
           05  WS-ENCH-FONCSVT-IDOPE                       PIC  X(04).  00080001
           05  FILLER REDEFINES WS-ENCH-FONCSVT-IDOPE.                  00090003
               10  WS-ENCH-FONCSVT-IDOPE-1C                PIC  X(01).  00100003
               10  FILLER                                  PIC  X(03).  00110003
           05  WS-ENCH-TF                                  PIC  X(02).  00120004
           05  WS-ENCH-FONCSVT-ARGUM                       PIC  X(20).  00130001
           05  WS-ENCH-ZLECT-LONG                     COMP PIC S9(04).  00140004
           05  WS-ENCH-FONC-VISI                           PIC  X(01).  00150005
           05  WS-ENCH-FONC-VISI-PREC                      PIC  X(01).  00160006
           05  WS-ENCH-TRAIT-PARM                          PIC  X(300). 00170005
           05  WS-ENCH-TRAIT-PARM-PREC                     PIC  X(300). 00180005
           05  WS-ENCH-LGPARM                         COMP PIC S9(04).  00190001
      *$XENDINCLUDE
           EJECT
       01  WS-COMMAREA-PF.
      *$XINCLUDE ZSTDST0000DG                        STDST0000DG        INL
      *                                                                 00010000
      *----FUNCTIONAL PROCEDURE : ACTIVE ET NEXT                        00020007
      *                                                                 00030000
           05  WS-PFACT.                                                00040000
               10  WS-PFACT-LGCOM                     COMP PIC S9(04).  00050000
               10  WS-PFACT-APPEL                          PIC  X(02).  00060000
               10  WS-PFACT-RETOUR                         PIC  X(02).  00070000
      *                                                                 00080000
      *----ACTIVE PROCEDURE - PHASE IN PROGRESS                         00090007
      *                                                                 00100000
               10  WS-PFACT-LIGNE.                                      00110000
                   15  WS-PFACT-CLE.                                    00120000
                       20  WS-PFACT-PHASE                  PIC  X(01).  00130000
                       20  WS-PFACT-FONC                   PIC  X(04).  00140000
                       20  WS-PFACT-RESU                   PIC  X(02).  00150000
                   15  WS-PFACT-NPHASE                     PIC  X(01).  00160000
               10  WS-PFSVT-CODE                           PIC  X(05).  00170004
      *                                                                 00180000
      *----- COMMAREA EXCHANGED BETWEEN FUNCTIONS OR WITH PROC. PILOTE  00190007
      *                                                                 00200000
           05  WS-TRAIT-PARM                               PIC  X(300). 00210006
      *$XENDINCLUDE
           EJECT
       01  WS-TABLE-TF.
           05  WS-TABLETF-NBMAX                      COMP  PIC S9(04)
                                                    VALUE         +20.
           05  WS-TABLETF.
               10  FILLER                                  PIC  X(01).
               10  WS-TABLETF-LIGNE             OCCURS 20
                                     INDEXED  BY  WS-TABLETF-IND.
                   15  WS-TABLETF-ID                       PIC  X(02).
                   15  WS-TABLETF-LIBACT                   PIC  X(06).
                   15  WS-TABLETF-FONC                     PIC  X(04).
           05  WS-TABLETF-VALEURS.
               10  FILLER                                  PIC  X(01)
                                                    VALUE       SPACE.
      *$XINCLUDE XGENFADR201 DATA  4261LIBR  FADR201 MODFADR201M        INL
      *-----------HERE YOU CAN ADD DATA COMPONENT'S------------------*
      *-----------"INCLUDE" CONTAINING THE TABLE OF------------------*
      *-----------FUNCTION KEYS USED BY CHAININGS--------------------*
      *-----------BETWEEN FUNCTIONS----------------------------------*
      *
           EJECT
       01  WSTR-FADR201.
      *--------------------------------------------------------------*
      * WORKING STOR. SPECIFIC TO THE PROGRAM   GENERATED : 03-12-98 *
      *--------------------------------------------------------------*
      *
           05  WSTR-DATA                 PIC X(001).

      * --> VARIABLE DB2

      *$XINCLUDE HOBJFVVAR   COMM  8130LIBR  FVVARD  MODFVVARD          INL
      * CLEANED            98/09/18
      * XX                 XX
      *  XX               XX  XXXXXX  XXXXXX  X    X  X  X    X  XXXXXX
      *   XX     XXX     XX   X    X  X    X  XX   X  X  XX   X  X
      *    XX   XX XX   XX    X    X  X    X  X X  X  X  X X  X  X
      *     XX XX   XX XX     XXXXXX  XXXXXX  X  X X  X  X  X X  X  XXX
      *      XXX     XXX      X    X  X   X   X   XX  X  X   XX  X    X
      *       X       X       X    X  X    X  X    X  X  X    X  XXXXXX
      *
      *
      *  ATTENTION : TOUTES MODIFICATIONS FAITES DANS FVVAR DOIVENT
      *              ETRE REPORTéES DANS :
      *
      *              --->  'AGL.NEUGES.DB2COPY(WVARBLO)'
      *
      *              VOIR EGALEMENT SI :
      *              --->  'AGL.NEUGES.DB2COPY(PVARBLO)'
      *              N EST PAS CONCERNE PAR CES MODIFICATIONS
      *
      * XX                 XX
      *  XX               XX  XXXXXX  XXXXXX  X    X  X  X    X  XXXXXX
      *   XX     XXX     XX   X    X  X    X  XX   X  X  XX   X  X
      *    XX   XX XX   XX    X    X  X    X  X X  X  X  X X  X  X
      *     XX XX   XX XX     XXXXXX  XXXXXX  X  X X  X  X  X X  X  XXX
      *      XXX     XXX      X    X  X  X    X   XX  X  X   XX  X    X
      *       X       X       X    X  X    X  X    X  X  X    X  XXXXXX
      *
      *----------------------------------------------------------------*
      * TRAITEMENT LOGICIEL OU PROGRAMME OU SOUS PROGRAMME FVVAR
      * INSERTION VARIABLES DB2
      * PARAMETRE DE COMMUNICATION E/S                                 *
      *----------------------------------------------------------------*

           EXEC SQL
                INCLUDE WVARBLO
           END-EXEC.


      *  TABLE BLOC NOTE

       01  FILLER  PIC X(27)  VALUE  '>>>>>>>>  IBBLOCN  <<<<<<<<'.

           EXEC SQL
                INCLUDE IBBLOCN
           END-EXEC.

           COPY ZTBBLOCN.


      *$XENDINCLUDE

      *$XINCLUDE HOBJFVADR2M COMM  8130LIBR  FVADR2MDMODFVADR2MD        INL
      *----------------------------------------------------------------*
      * TRAITEMENT LOGICIEL OU PROGRAMME OU SOUS PROGRAMME FVADR2
      * MAJ INFO. 2NDE ADRESSE
      * PARAMETRE DE COMMUNICATION E/S                                 *
      *----------------------------------------------------------------*
      *
       01  ZCOM-DATA.

            05  ZCOM-ACTION-SW          PIC X      VALUE SPACE.
                88  ZCOM-CREATE                    VALUE  'C'.
                88  ZCOM-MODIFY                    VALUE  'M'.
                88  ZCOM-DELETE                    VALUE  'D'.
            05  ZCOM-CHANGE-SW          PIC X      VALUE SPACE.
                88  ZCOM-CHANGE                    VALUE  'C'.
                88  ZCOM-NO-CHANGE                 VALUE  'N'.
            05  ZCOM-TYPADR             PIC XX     VALUE SPACE.
            05  ZCOM-TYPEDEF            PIC XX     VALUE 'FO'.
            05  ZCOM-SOC                PIC  999   VALUE ZERO.
            05  ZCOM-FOYER              PIC  9(10) VALUE ZERO.
            05  ZCOM-NOMPREN1           PIC X(28)  VALUE SPACE.
            05  ZCOM-ADRLVBEA           PIC X(32)  VALUE SPACE.
            05  ZCOM-ADRLADRE           PIC X(32)  VALUE SPACE.
            05  ZCOM-ADRCPTT            PIC X(5)   VALUE SPACE.
            05  ZCOM-ADRLVILL           PIC X(32)  VALUE SPACE.
            05  ZCOM-ADRCPAYS PIC S9(3)V USAGE COMP-3 VALUE ZERO.
            05  ZCOM-ADRLPAYS           PIC X(25)  VALUE SPACE.

           EXEC SQL
                INCLUDE TBADRES
           END-EXEC.

           EXEC SQL
                INCLUDE TBBLOCN
           END-EXEC.

           COPY  ZTBADRES.

           EXEC SQL
                INCLUDE TBDOPRN
           END-EXEC.

           COPY  ZTBDOPRN.

      *$XENDINCLUDE


      * ZONES DE RECEPTION DE LA COMMAREA

       01  WF-ENTREE.
           03  COM-PRNSOC      PIC    999.
           03  TCLINFOY        PIC    9(10).
           03  FILLER          PIC    X(18).
           03  TCLILNOMPREN    PIC    X(28).
           03  FILLER          PIC    X(231).

      * ZONE ACTION
       01 TACTION              PIC    X    VALUE  SPACE.

      * INTERRUPTEUR DE CREATION OU DE MAJ
       01  INT-CREAMAJ   PIC  X.
           88  CREATION    VALUE  'O'.

      * INTERRUPTEUR DE MODIFICATION DE LA MAP
       01  IND-CHANGEMENT  PIC  X.
           88  CHANGEMENT     VALUE  'O'.

           EXEC SQL
               INCLUDE  FVADRD
           END-EXEC.
      * UPDATED FOR TBEN BY MT 05.07.2000
           COPY ADR201.
      * END OF UPDATE BY MT
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 DATA  4271LIBR  FADR201 MODFADR201I        INL
       01  DBRC-FADR201.
      *--------------------------------------------------------------*
      * STRUCTURES OF PROGRAM'S DATABASE        GENERATED : 03-12-98 *
      *--------------------------------------------------------------*
      *
           05  DBRC-DATA               PIC X(001).
      *
      *$XENDINCLUDE
           EJECT
           EXEC SQL
                INCLUDE SQLCA
           END-EXEC.
           EJECT
       01  LS-COMMAREA                                   PIC X(5120).
       01  LS-COMMAREA-R REDEFINES LS-COMMAREA.
      *$XINCLUDE ZSTDST0000LA                        STDST0000LA        INL
      *--------------------------------------------------------------*  00010017
      *  DEFINITION OF INTERPROGRAM COMMAREA                         *  00020079
      *--------------------------------------------------------------*  00030017
      *  STANDARD PART 793C.                                         *  00040079
      *  USED PART     4327C. WITH NNNN USER DATA (FUNCTIONAL LEVEL) *  00050079
      *                            1920 INTERNAL MESSAGE             *  00060079
      *                            PPPP USER DATA (PROGRAM LEVEL)    *  00070079
      *                  AND  NNNN + PPPP < 2407C.                   *  00080079
      *--------------------------------------------------------------*  00090017
           05  LS-STD.                                                  00100061
      *                                                                 00110017
      *----INFORMATIONS ON MESSAGES TO DISPLAY--------------------78C.  00120079
               10  LS-MESS.                                             00130017
                   15  LS-MESS-NUM                         PIC  X(06).  00140063
                   15  FILLER                              PIC  X(01).  00150069
                   15  LS-MESS-LIB                         PIC  X(71).  00160069
      *                                                                 00170017
      *----INFORMATIONS ON FUNCTION PILOTING----------------------51C.  00180079
      *                                                                 00190017
               10  LS-STD-FONC.                                         00200017
      *                                                                 00210060
      *--------------------PREVIOUS INTERACTION                         00220080
                   15  LS-FONC-PREC.                                    00230017
                       20  LS-PREC-PF                      PIC  X(05).  00240017
                       20  LS-PREC-FONCTION.                            00250017
                           25  LS-PREC-FONC                PIC  X(04).  00260017
                           25  LS-PREC-PROG                PIC  X(08).  00270017
                           25  LS-PREC-ECET.                            00280017
                               30  LS-PREC-EC              PIC  X(02).  00290017
                               30  LS-PREC-ET              PIC  X(02).  00300017
                   15  LS-PREC-RESU                        PIC  X(02).  00310063
                   15  LS-PREC-TF                          PIC  X(02).  00320063
                   15  LS-PREC-ACT-IND                COMP PIC S9(04).  00330017
      *                                                                 00340017
      *--------------------INTERACTION IN PROGRESS                      00350081
      *                                                                 00360017
                   15  LS-FONC-ENC.                                     00370017
                       20  LS-ENC-PF                       PIC  X(05).  00380017
                       20  LS-ENC-FONCTION.                             00390017
                           25  LS-ENC-FONC                 PIC  X(04).  00400017
                           25  LS-ENC-PROG                 PIC  X(08).  00410017
                           25  LS-ENC-ECET.                             00420062
                               30  LS-ENC-EC               PIC  X(02).  00430062
                               30  LS-ENC-ET               PIC  X(02).  00440062
                   15  LS-ENC-ENFONC                       PIC  X(02).  00450067
                   15  LS-PFACT-PHASE                      PIC  X(01).  00460065
      *                                                                 00470017
      *----INFORMATIONS ON BACKUP FOR RECEPTION; F/E/S RETURN----14C.   00480079
      *                                                                 00490017
               10  LS-ENCH-SAUV.                                        00500053
                   15  LS-ENCH-PGMSAUV                     PIC  X(08).  00510052
                   15  LS-ENCH-TRNSAUV                     PIC  X(04).  00520051
                   15  LS-ENCH-ICOURS                COMP  PIC S9(04).  00530051
      *                                                                 00540017
      *----INFOR. ON TS FOR BACKUP F/E/S CALL CONTEXT-------------4C.   00550079
      *                                                                 00560017
               10  LS-TSCO-CONTEXTE.                                    00570017
                   15  LS-TSCO-ITEM                   COMP PIC S9(04).  00580061
                   15  LS-TSCO-IND                    COMP PIC S9(04).  00590017
      *                                                                 00600061
      *----INFOR. ON TS FOR BACKUP SCREEN DESCRIPTOR-----------------4C.00610079
      *                                                                 00620061
               10  LS-TSDES-CONTEXTE.                                   00630061
                   15  LS-TSDES-ITEM                  COMP PIC S9(04).  00640061
                   15  LS-TSDES-IND                   COMP PIC S9(04).  00650061
      *                                                                 00660017
      *----INFOR. ON TS FOR USER----------------------------------26C.  00670079
      *                                                                 00680017
               10  LS-TSFONC-NOM                           PIC  X(04).  00690066
      *                                                                 00700017
               10  LS-TABLE-TS.                                         00710017
                   15  LS-TABTS-NBMAX                 COMP PIC S9(04).  00720017
                   15  LS-TABTS-NOM             OCCURS 05  PIC  X(04).  00730061
      *                                                                 00740064
      *----STORAGE OF FUN. NAME FOR RETURN TO PREVIOUS-FUNCTION -----4C.00750081
      *                                                                 00760064
               10  LS-RAPPEL-FONC                          PIC  X(04).  00770075
      *                                                                 00780076
      *----STORAGE OF PARAMETERS FOR RETURN TO SUMMARY--------------10C.00790079
      *                                                                 00800076
               10  LS-SOMMAIRE-PARM                        PIC  X(10).  00810076
      *                                                                 00820076
      *----VISIBILITY INDICATORS-----------------------------------2C.  00830080
      *                                                                 00840076
               10  LS-FONC-VISI                            PIC  X(01).  00850076
               10  LS-FONC-VISI-PREC                       PIC  X(01).  00860076
      *                                                                 00870060
      *----INTERFUNCTION COMMAREA--------------------------------600C.  00880080
      *                                                                 00890060
               10  LS-TRAIT-PARM.                                       00900060
                   15  LS-TRAIT-PARM-C          OCCURS 300 PIC  X(01).  00910076
               10  LS-TRAIT-PARM-PREC                      PIC  X(300). 00920076
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 DATA  4222LIBR  FADR201 STDFADR201C        INL
      *$XINCLUDE ACLSFADR201 DCF   3212LIBR  FADR201BMODFADR201B        INL
           05  LSF-FONC.
      *--------------------------------------------------------------*
      * DONNEES PARTAGEES - NIV. FONCTION                            *
      *--------------------------------------------------------------*
      *
               10  LSF-DATA             PIC X(001).
      *

      *$XENDINCLUDE
      *$XENDINCLUDE
      *--------------------------------------------------------------*
      * ATTRIBUTS ECRANS + MESSAGE INTERNE ECRANS                    *
      *--------------------------------------------------------------*
           05  MSGI-MESSAGE.
               10  MSGI-CAR               OCCURS 1920
                                          INDEXED BY MSGI-CAR-IND
                                                           PIC  X(01).
      *$XINCLUDE XGENFADR201 DATA  5222LIBR  ADR201  STDADR201I         INL
           05 ADR201-MSGI REDEFINES MSGI-MESSAGE.
      *--------------------------------------------------------------*
      * INTERNAL MESSAGE                        GENERATED : 21-08-00 *
      *--------------------------------------------------------------*
      *
             06  FILLER.
               07  LIG2.
      *            NOM DU CICS
                   09  E-SESS-ID-VAL.
                       10  E-SESS-ID                  PIC  X(004).
      *
      *            USER DE L'INTERVENANT
                   09  E-USER-ID-VAL.
                       10  E-USER-ID                  PIC  X(008).
      *
      *            TITRE DE L'ECRAN
                   09  E-ECR-LIBC-VAL.
                       10  E-ECR-LIBC                 PIC  X(040).
      *
      *            DATE DU JOUR
                   09  E-DATEJ-VAL.
                       10  E-DATEJ                    PIC  9(08).
                       10  E-DATEJ-R   REDEFINES E-DATEJ.
                           15  E-DATEJ-SS             PIC  9(02).
                           15  E-DATEJ-AMJ            PIC  9(06).
                           15  E-DATEJ-AMJ-R
                                       REDEFINES E-DATEJ-AMJ.
                               20 E-DATEJ-AA          PIC  9(02).
                               20 E-DATEJ-MM          PIC  9(02).
                               20 E-DATEJ-JJ          PIC  9(02).
      *
      *
             06  FILLER.
               07  LIG4.
      *            CODE SOCIETE
                   09  E-DPRNSOC-VAL.
                       10  E-DPRNSOC                  PIC  9(003).
      *
      *            NUMERO DE FOYER
                   09  E-CLINFOY-VAL.
                       10  E-CLINFOY                  PIC  9(010).
      *
      *
             06  FILLER.
               07  LIG6.
      *            Nom/Prénom:
                   09  E-CLILNOMPREN-VAL.
                       10  E-CLILNOMPREN              PIC  X(028).
      *
      *
             06  FILLER.
               07  LIG9.
      *            ADRESSE
                   09  E-ADRLADRE-VAL.
                       10  E-ADRLADRE                 PIC  X(032).
      *
      *            Complément:
                   09  E-ADRLVBEA-VAL.
                       10  E-ADRLVBEA                 PIC  X(032).
      *
      *
             06  FILLER.
               07  LIG11.
      *            CODE PAYS BENELUX
                   09  E-CPAYSBEN-VAL.
                       10  E-CPAYSBEN                 PIC  X(002).
      *
      *            NO CODE POSTAL
                   09  E-ADRCPTT-VAL.
                       10  E-ADRCPTT                  PIC  X(004).
      *
      *            CODE QUARTIER
                   09  E-CQUART-VAL.
                       10  E-CQUART                   PIC  X(002).
      *
      *            Ville:
                   09  E-ADRLVILL-VAL.
                       10  E-ADRLVILL                 PIC  X(028).
      *
      *            LOCACH
                   09  E-ADRLLOCACH-VAL.
                       10  E-ADRLLOCACH               PIC  X(023).
      *
      *
             06  FILLER.
               07  LIG13.
      *            CODE PAYS
                   09  E-ADRCPAYS-VAL.
                       10  E-ADRCPAYS                 PIC  9(003).
      *
      *            Pays:
                   09  E-ADRLPAYS-VAL.
                       10  E-ADRLPAYS                 PIC  X(025).
      *
      *
             06  FILLER.
               07  LIG17.
      *            ACTION
                   09  E-ACTION-VAL.
                       10  E-ACTION                   PIC  X(001).
      *
      *
             06  FILLER.
               07  LIG23.
                   09  E-LIG-ACT-VAL.
                       10  E-LIG-ACT                  PIC  X(078).
      *
      *
             06  FILLER.
               07  LIG24.
                   09  E-LIG-MSG-VAL.
                       10  E-LIG-MSG                  PIC  X(078).
      *
      *
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 DATA  4231LIBR  FADR201 MODFADR201N        INL
      *----------------------------------------------------------------*
      * VARIABLES TEMPORAIRES DESTINEES A LA GESTION DES CPTT BENELUX
      *----------------------------------------------------------------*
      *UPDATED FOR TBEN BY CK 25.07.2000
           05  WSTR-CPTT-TMP.
              07  WSTR-CPTT11-TMP   PIC X(1).
              07  WSTR-CPTT25-TMP   PIC X(4).
           05  WSTR-LVILL-TMP.
              07  WSTR-CQUART-TMP   PIC X(2).
              07  WSTR-FILLER-TMP   PIC X(2).
              07  WSTR-NLVILLE-TMP  PIC X(28).
      *    COPY  WCPTTBEN.
      *END OF UPDATE BY CK
           05  LSP-PROG.
      *--------------------------------------------------------------*
      * COMMAREA SPECIFIC TO THE PROGRAM        GENERATED : 03-12-98 *
      *--------------------------------------------------------------*
      *
               10  LSP-DATA       PIC X(001).
               10  LSP-ACTION     PIC X.
               10  LSP-SOC        PIC  999.
               10  LSP-FOYER      PIC  9(10).
               10  LSP-NOMPREN1   PIC X(28).
               10  LSP-ADRLVBEA   PIC X(32).
               10  LSP-ADRLADRE   PIC X(32).
      *UPDATED FOR TBEN BY CK 24.07.2000
      *        10  LSP-ADRCPTT    PIC X(5).
               10  LSP-ADRCPTT.
                 12  LSP-ADRCPTT11 PIC X(1).
                 12  LSP-ADRCPTT25 PIC X(4).
      *        10  LSP-ADRLVILL   PIC X(32).
               10  LSP-ADRLVILL.
                  12  LSP-ADRCQUART  PIC X(2).
                  12  LSP-ADRFILLER  PIC X(2).
                  12  LSP-ADRNLVILLE PIC X(28).
      *END OF UPDATE BY CK
               10  LSP-ADRCPAYS   PIC S9(3)V USAGE COMP-3.
               10  LSP-ADRLPAYS   PIC X(25).
      *
               10  LSP-ADR-FOUND-SW          PIC X(001).
                  88  LSP-ADR-FOUND          VALUE 'F'.
                  88  LSP-ADR-NOT-FOUND      VALUE 'N'.
      *
               10 LSP-ADRESSE-INV-SW         PIC X.
                    88  LSP-ADRESSE-OK       VALUE ' '.
                    88  LSP-ADRESSE-FAUSSE   VALUE 'F'.
                    88  LSP-ADRESSE-INVALIDE VALUE 'I'.

      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 DATA  4241LIBR  FADR201 STDFADR201E        INL
       01  FADR201-MTRA.
      *--------------------------------------------------------------*
      * PROGRAM'S TRANSITION MATRIX             GENERATED : 21-08-00 *
      *--------------------------------------------------------------*
      *
           05  MTRA-NBMAX        PIC S9(04) COMP VALUE +12.
           05  MTRA-IND          PIC S9(04) COMP VALUE ZERO.
      *
           05  MTRA-VALEURS.
               10  FILLER        PIC X(76) VALUE
                      '0000DEBUT     T01  010101              FADR201
      -               '                   ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0000          T01  02EX01'.
               10  FILLER        PIC X(76) VALUE
                      '0101HELP  01         0101      AIDC    FADR201 SP
      -               'PAIDC              ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101AIDK  11         0101      AIDK    FADR201 SG
      -               'PAIDK              ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101PF2   02         0101      STPF02  FADR201 SP
      -               'PSTPF02            ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101PF3   03         0101      TPF3    FADR201 SG
      -               'PTPF3              ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101EC/PRE04         0101      STPF04  FADR201 SG
      -               'PSTPF04            ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101SOMM. 05         0101      STPF05  FADR201 SG
      -               'PSTPF05            ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101LACT  06         0101      STLACT  FADR201 SP
      -               'MSTLACT            ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101VALID EN  T01  010101ADR2X         FADR201
      -               '                   ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101      EN  T01  080101ADR2X         FADR201
      -               '                   ADR2'.
               10  FILLER        PIC X(76) VALUE
                      '0101EFFACEER         EX01'.
      *
           05  MTRA-TABLE  REDEFINES MTRA-VALEURS.
      *
               10  MTRA-LIGNE  OCCURS 12.
      *
                   15  MTRA-ECET.
                       20  MTRA-ECRN                  PIC X(02).
                       20  MTRA-ETAT                  PIC X(02).
                   15  MTRA-ACTION.
                       20  MTRA-LIBACT                PIC X(06).
                       20  MTRA-CODACT.
                           25  MTRA-TF                PIC X(02).
                           25  MTRA-CMDE              PIC X(02).
                   15  MTRA-TRAIT.
                       20  MTRA-TRAIT-PREF            PIC X(01).
                       20  MTRA-TRAIT-NOM.
                           25  MTRA-TRAIT-NOM1        PIC X(02).
                           25  MTRA-TRAIT-NOM2        PIC X(02).
                   15  MTRA-RESU                      PIC X(02).
                   15  MTRA-NECET.
                       20  MTRA-NECRN                 PIC X(02).
                       20  MTRA-NETAT                 PIC X(02).
                   15  MTRA-NOMESS                    PIC X(06).
                   15  MTRA-NOPROG.
                       20  MTRA-PGM-TRAIT             PIC X(08).
                       20  MTRA-PGM-EM                PIC X(08).
                   15  MTRA-STD-ACT.
                       20  MTRA-TYPE-TRANSIT          PIC X(01).
                       20  MTRA-TYPAPP-TRAIT          PIC X(01).
                       20  MTRA-NATURE-TRAIT          PIC X(01).
                       20  MTRA-STD-ACTNOM            PIC X(08).
      *
                   15  MTRA-TYPE-ECET                 PIC X(02).
                   15  MTRA-TRN.
                       20  MTRA-TRN-TRAIT.
                           25  MTRA-TRN-TRAIT1        PIC X(04).
                           25  MTRA-TRN-TRAIT2        PIC X(04).
                       20  MTRA-TRN-EM.
                           25  MTRA-TRN-EM1           PIC X(04).
                           25  MTRA-TRN-EM2           PIC X(04).
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 DATA  5231LIBR  ADR201  STDADR201LI        INL
       01  ADR201-LIENS.
      *--------------------------------------------------------------*
      * INTER-FIELDS LINKS                      GENERATED : 21-08-00 *
      *--------------------------------------------------------------*
      *
           05  LIEN-CHP-NBMAX  VALUE  +0              COMP PIC S9(04).
      *
           05  LIEN-CHP-VALEURS.
             10  FILLER  VALUE SPACE                     PIC X(36).
      *
      *
      *
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 DATA  5241LIBR  ADR201  STDADR201BI        INL
       01  ADR201-CHPBI.
      *--------------------------------------------------------------*
      * FIELDS WITH SIGNIFICANT INFORM. BASE IDENT   GEN. : 21-08-00 *
      *--------------------------------------------------------------*
      *
           05  CHPBI-NOM-NBMAX  VALUE  +9             COMP PIC S9(04).
      *
           05  CHPBI-NOM-VALEURS.
               10  FILLER VALUE
                         'STE     01DPRNSOC         '      PIC  X(26).
      *
               10  FILLER VALUE
                         'NUMFOY  01CLINFOY         '      PIC  X(26).
      *
               10  FILLER VALUE
                         'NOMFOY  01CLILNOMPREN     '      PIC  X(26).
      *
               10  FILLER VALUE
                         'RUE     01ADRLADRE        '      PIC  X(26).
      *
               10  FILLER VALUE
                         'CPLTADR 01ADRLVBEA        '      PIC  X(26).
      *
               10  FILLER VALUE
                         'LOCACH  01ADRLLOCACH      '      PIC  X(26).
      *
               10  FILLER VALUE
                         'ADR     01ADRCPAYS        '      PIC  X(26).
      *
               10  FILLER VALUE
                         'ADRPAYS 01ADRLPAYS        '      PIC  X(26).
      *
               10  FILLER VALUE
                         'ACTION  01ACTION          '      PIC  X(26).
      *
      *$XENDINCLUDE
           EJECT
       01  MSTD-DATA.
      *$XINCLUDE ZSTDST0000DB                        STDST0000DB        INL
      *--------------------------------------------------------------*  00010001
      *  PARAMETERS FOR MESSAGES'MANAGEMENT                          *  00020009
      *--------------------------------------------------------------*  00030001
           05  MSTD-LG                                COMP PIC S9(04).  00040001
           05  MSTD-RETOUR                                 PIC  X(02).  00050004
      *                                                                 00060001
      *----MESSAGE DESCRIPTION                                          00070009
      *                                                                 00080001
           05  MSTD-MESSAGE.                                            00090001
               10  MSTD-NOM-FONC                           PIC  X(04).  00100001
               10  MSTD-MESS.                                           00110001
                   15  MSTD-NOMESS.                                     00120001
                       20  MSTD-NOMESS-FONC                PIC  X(04).  00130001
                       20  MSTD-NOMESS-NUM-F               PIC  X(02).  00140001
                   15  MSTD-NOMESS-ST   REDEFINES MSTD-NOMESS.          00150001
                       20  MSTD-NOMESS-PREF                PIC  X(02).  00160001
                       20  MSTD-NOMESS-NUM                 PIC  X(04).  00170001
                   15  MSTD-FIL                            PIC  X(01).  00180002
                   15  MSTD-LIBMESS                        PIC  X(71).  00190005
                   15  MSTD-LIBMESS-DET REDEFINES MSTD-LIBMESS.         00200001
                       20  MSTD-CLIB    OCCURS 71                       00210005
                                        INDEXED BY CLIB-X.              00220001
                           25  MSTD-CLIB-9                 PIC  9(01).  00230001
      *                                                                 00240001
      *----PARAMETERS (3 MAXIMUM) TO INSERT IN THE MESSAGE              00250009
      *                                                                 00260001
           05  MSTD-PMESS-TABLE.                                        00270001
               10  MSTD-PMESS           OCCURS 3                        00280001
                                        INDEXED BY PMES-X.              00290001
                   15  MSTD-PMES-PARM   OCCURS 20                       00300002
                                        INDEXED BY CPMES-X              00310002
                                                   CPMES-Y.             00320003
                       20  MSTD-CPMES                      PIC  X(01).  00330002
      *                                                                 00340001
           05  FILLER                                      PIC  X(07).  00350001
      *                                                                 00360001
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 DATA  4251LIBR  FADR201 STDFADR201F        INL
      *--------------------------------------------------------------*
      * PROGRAM'S RELATIVE MESSAGES             GENERATED : 21-08-00 *
      *--------------------------------------------------------------*
      *
           05  MESR-EN.
               10  MESR-NBMAX  PIC S9(04) COMP VALUE ZERO.
               10  MESR-IND    PIC S9(04) COMP VALUE ZERO.
      *
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST0000DF                        STDST0000DF        INL
      *--------------------------------------------------------------*  00010004
      *  DATA USED TO FORM THE ACTION LINE                           *  00020012
      *--------------------------------------------------------------*  00030004
       01  WS-STD-ACTION.                                               00040004
      *----SUBSCRIPTS FOR TABLES'MANIPULATION                           00050012
      *                                                                 00060004
           05  WS-IND1                                COMP PIC S9(04).  00070004
           05  WS-IND2                                COMP PIC S9(04).  00080004
           05  WS-IND3                                COMP PIC S9(04).  00090004
           05  WS-IND4                                COMP PIC S9(04).  00100004
           05  WS-ACTS          VALUE ZERO            COMP PIC S9(04).  00110004
           05  WS-ACTION-TF                                PIC  X(02).  00120005
           05  WS-ACTION-TF9    REDEFINES WS-ACTION-TF     PIC  9(02).  00130004
           05  WS-ACTION-LIBACT                            PIC  X(06).  00131011
      *----ACTION LINE (FUNCTION-KEYS)                                  00140014
      *                                                                 00150004
           05  WS-PTF-VAL.                                              00160004
               10  FILLER       VALUE  'EF=       '        PIC  X(10).  00170007
               10  FILLER       VALUE  'EN=       '        PIC  X(10).  00180004
               10  FILLER       VALUE  '01=       '        PIC  X(10).  00190004
               10  FILLER       VALUE  '02=       '        PIC  X(10).  00200004
               10  FILLER       VALUE  '03=       '        PIC  X(10).  00210004
               10  FILLER       VALUE  '04=       '        PIC  X(10).  00220004
               10  FILLER       VALUE  '05=       '        PIC  X(10).  00230004
               10  FILLER       VALUE  '06=       '        PIC  X(10).  00240004
               10  FILLER       VALUE  '07=       '        PIC  X(10).  00250004
               10  FILLER       VALUE  '08=       '        PIC  X(10).  00260004
               10  FILLER       VALUE  '09=       '        PIC  X(10).  00270004
               10  FILLER       VALUE  '10=       '        PIC  X(10).  00280004
               10  FILLER       VALUE  '11=       '        PIC  X(10).  00290004
               10  FILLER       VALUE  '12=       '        PIC  X(10).  00300004
               10  FILLER       VALUE  '13=       '        PIC  X(10).  00310004
               10  FILLER       VALUE  '14=       '        PIC  X(10).  00320004
               10  FILLER       VALUE  '15=       '        PIC  X(10).  00330004
               10  FILLER       VALUE  '16=       '        PIC  X(10).  00340004
               10  FILLER       VALUE  '17=       '        PIC  X(10).  00350004
               10  FILLER       VALUE  '18=       '        PIC  X(10).  00360004
               10  FILLER       VALUE  '19=       '        PIC  X(10).  00370004
               10  FILLER       VALUE  '20=       '        PIC  X(10).  00380004
               10  FILLER       VALUE  '21=       '        PIC  X(10).  00390004
               10  FILLER       VALUE  '22=       '        PIC  X(10).  00400004
               10  FILLER       VALUE  '23=       '        PIC  X(10).  00410004
               10  FILLER       VALUE  '24=       '        PIC  X(10).  00420004
               10  FILLER       VALUE  'A1=       '        PIC  X(10).  00430004
               10  FILLER       VALUE  'A2=       '        PIC  X(10).  00440004
               10  FILLER       VALUE  'A3=       '        PIC  X(10).  00450004
      *                                                                 00460004
           05  WS-PTF-TABLE           REDEFINES WS-PTF-VAL.             00470004
               10  WS-PTF             OCCURS 29.                        00480004
                   15  WS-PTF-ACT.                                      00490004
                       20  WS-PTF-ACTDEB.                               00500004
                           25  WS-PTF-TF                   PIC  X(02).  00510004
                           25  WS-PTF-EQ                   PIC  X(01).  00520004
                       20  WS-PTF-LIB                      PIC  X(06).  00530004
                   15  WS-PTF-X                            PIC  X(01).  00540004
      *                                                                 00550004
           05  WS-LIGNE               VALUE SPACE          PIC  X(78).  00560005
      *                                                                 00570006
           05  WS-LIG-DEFAUT          REDEFINES WS-LIGNE.               00580006
               10  WS-ACT-PTF         OCCURS  26           PIC  X(03).  00590006
      *                                                                 00600006
           05  WS-LIG-TABLE           REDEFINES WS-LIGNE.               00610006
               10  WS-LIG-ACT-PTF                          PIC  X(02).  00620004
               10  WS-LIG-ACT-LIB                          PIC  X(03).  00630004
               10  WS-PTF-ED          OCCURS  7            PIC  X(10).  00640004
               10  WS-LIG-ACT-CONTINU                      PIC  X(03).  00650005
      *                                                                 00660004
      *$XENDINCLUDE
           EJECT
      *--------------------------------------------------------------*
      *  DONNEES DU MAPPING   MESS PHYSIQUE <---> MESS INTERNE       *
      *--------------------------------------------------------------*
      *$XINCLUDE ZSTDST0000DC                        STDST0000DC        COPY
      *$XINCLUDE 0SUPPRESS
           COPY ST0000DC SUPPRESS.
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 DATA  5212LIBR  ADR201  STDADR201G         COPY
      *$XINCLUDE 0SUPPRESS
           COPY ADR201G  SUPPRESS.
      *$XENDINCLUDE
      *
      *--------------------------------------------------------------*
      *  DEFINITION STANDARDS DC                                     *
      *--------------------------------------------------------------*
      *$XINCLUDE ZSTDST0000DH                        STDST0000DH        COPY
      *$XINCLUDE 0SUPPRESS
           COPY ST0000DH SUPPRESS.
      *$XENDINCLUDE
      *
      *$XINCLUDE ZSTDSTCICSDA                        STDSTCICSDA        INL
      *--------------------------------------------------------------*
      *  DC MONITOR DEFINITION   CICS                                *
      *--------------------------------------------------------------*
           COPY DFHAID      SUPPRESS.                                   14360000
      *
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDSTCOMAUT                        STDSTCOMAUT        INL
           COPY COMAUTO.                                                00010000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDSTARMIDE                        STDSTARMIDE        INL
      *------------------------------------------------------------     00010002
      *----    IF YOU MODIFY THIS COPY, UPDATE THE SUBROUTINE    --     00020005
      *----   PIARMI WHICH CONTAINS THE COPY WITH SPA- PREFIX    --     00030005
      *----              INSTEAD OF ARM- PREFIX                  --     00040005
      *------------------------------------------------------------     00050002
          COPY ARMZCOM.                                                 00060002
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST0000DD                        STDST0000DD        INL
      *--------------------------------------------------------------*  00010012
      *  STANDARD PARAMETERS FOR CICS ERRORS MANAGEMENT              *  00020017
      *--------------------------------------------------------------*  00030012
       01  STDER-DATA.                                                  00040012
           05  STDER-ERRCICS-FLAG.                                      00050012
               10  ACCEPT-ERR-OUI          VALUE '1'       PIC  X(01).  00060012
               10  ACCEPT-ERR-NON          VALUE '0'       PIC  X(01).  00070012
           05  STDER-EXEC-RETOUR                           PIC  X(12).  00080015
               88  NORESP                  VALUE 'NORESP      '.        00090015
               88  NOTFND                  VALUE 'NOTFND      '.        00100015
               88  DUPREC                  VALUE 'DUPREC      '.        00110015
               88  ENDFILE                 VALUE 'ENDFILE     '.        00120015
               88  LENGERR                 VALUE 'LENGERR     '.        00130015
               88  ITEMERR                 VALUE 'ITEMERR     '.        00140015
               88  PGMIDERR                VALUE 'PGMIDERR    '.        00150015
               88  ENDDATA                 VALUE 'ENDDATA     '.        00160015
               88  MAPFAIL                 VALUE 'MAPFAIL     '.        00170015
               88  INVMPSZ                 VALUE 'INVMPSZ     '.        00180015
               88  QIDERR                  VALUE 'QIDERR      '.        00190015
               88  ENQBUSY                 VALUE 'ENQBUSY     '.        00200015
      *----TABLE FOR SEARCH OF EXCEPTIONAL CONDITIONS                   00210017
      *                 AND OF ASSOCIATED RETURN CODES                  00220017
      *                                                                 00230012
      *----IF ADDITION OF A CONDITION IN THE TABLE, INCREMENT (+1)      00240017
      *    THE STDER-HEX-CTR COUNTER AND MODIFY THE OCCURS.             00250017
      *                                                                 00260012
           05  STDER-HEX-COND.                                          00270012
               10  STDER-HEX-CTR           VALUE +11   COMP PIC S9(04). 00280012
               10  STDER-HEX-LIST.                                      00290012
                   15  STDER-COND-13.                                   00300012
                       20  STDER-HEX-13    VALUE +13   COMP PIC S9(04). 00310012
                       20  ACCEPT-NOTFND               PIC  X(01).      00320012
                       20  FILLER          VALUE 'NOTFND'   PIC  X(12). 00330012
                   15  STDER-COND-14.                                   00340012
                       20  STDER-HEX-14    VALUE +14   COMP PIC S9(04). 00350012
                       20  ACCEPT-DUPREC                    PIC  X(01). 00360012
                       20  FILLER          VALUE 'DUPREC'   PIC  X(12). 00370012
                   15  STDER-COND-20.                                   00380012
                       20  STDER-HEX-20    VALUE +20   COMP PIC S9(04). 00390012
                       20  ACCEPT-ENDFILE                   PIC  X(01). 00400012
                       20  FILLER          VALUE 'ENDFILE'  PIC  X(12). 00410012
                   15  STDER-COND-22.                                   00420012
                       20  STDER-HEX-22    VALUE +22   COMP PIC S9(04). 00430012
                       20  ACCEPT-LENGERR                   PIC  X(01). 00440012
                       20  FILLER          VALUE 'LENGERR'  PIC  X(12). 00450012
                   15  STDER-COND-26.                                   00460012
                       20  STDER-HEX-26    VALUE +26   COMP PIC S9(04). 00470012
                       20  ACCEPT-ITEMERR                   PIC  X(01). 00480012
                       20  FILLER          VALUE 'ITEMERR'  PIC  X(12). 00490012
                   15  STDER-COND-27.                                   00500012
                       20  STDER-HEX-27    VALUE +27   COMP PIC S9(04). 00510012
                       20  ACCEPT-PGMIDERR                  PIC  X(01). 00520012
                       20  FILLER          VALUE 'PGMIDERR' PIC  X(12). 00530012
                   15  STDER-COND-29.                                   00540012
                       20  STDER-HEX-29    VALUE +29   COMP PIC S9(04). 00550012
                       20  ACCEPT-ENDDATA                   PIC  X(01). 00560012
                       20  FILLER          VALUE 'ENDDATA'  PIC  X(12). 00570012
                   15  STDER-COND-36.                                   00580012
                       20  STDER-HEX-36    VALUE +36   COMP PIC S9(04). 00590012
                       20  ACCEPT-MAPFAIL                   PIC  X(01). 00600012
                       20  FILLER          VALUE 'MAPFAIL'  PIC  X(12). 00610012
                   15  STDER-COND-38.                                   00620012
                       20  STDER-HEX-38    VALUE +38   COMP PIC S9(04). 00630012
                       20  ACCEPT-INVMPSZ                   PIC  X(01). 00640012
                       20  FILLER          VALUE 'INVMPSZ'  PIC  X(12). 00650012
                   15  STDER-COND-44.                                   00660012
                       20  STDER-HEX-44    VALUE +44   COMP PIC S9(04). 00670012
                       20  ACCEPT-QIDERR                    PIC  X(01). 00680012
                       20  FILLER          VALUE 'QIDERR'   PIC  X(12). 00690012
                   15  STDER-COND-55.                                   00700012
                       20  STDER-HEX-1232  VALUE +55   COMP PIC S9(04). 00710012
                       20  ACCEPT-ENQBUSY                   PIC  X(01). 00720012
                       20  FILLER          VALUE 'ENQBUSY'  PIC  X(12). 00730012
               10  STDER-HEX-TAB REDEFINES STDER-HEX-LIST.              00740012
                   15  STDER-HEX-POSTE    OCCURS 11                     00750012
                                          ASCENDING KEY STDER-HEX-CODE  00760012
                                          INDEXED BY STDER-HEX-I.       00770012
                       20  STDER-HEX-CODE              COMP PIC S9(04). 00780012
                       20  STDER-HEX-CODE-X  REDEFINES STDER-HEX-CODE   00790012
                                                            PIC  X(02). 00800012
                       20  STDER-CODE-ACCEPT                PIC  X(01). 00810012
                       20  STDER-CODE-RETOUR                PIC  X(12). 00820012
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDSTERREUR                        STDSTERREUR        INL
           05  STDER-ERREUR.                                            00010000
               10  STDER-DATE                        PIC S9(7)  COMP-3. 00020000
               10  STDER-HEURE                       PIC S9(7)  COMP-3. 00030000
               10  STDER-TACHE                       PIC S9(7)  COMP-3. 00040000
               10  STDER-TYPE-ERREUR                 PIC X(4).          00050000
               10  STDER-CODE-TRANS                  PIC X(4).          00060000
               10  STDER-ENVIRONNEMENT               PIC X(8).          00070000
               10  STDER-USER                        PIC X(8).          00080000
               10  STDER-DATE-COMPILE                PIC X(20).         00090000
               10  STDER-NOM-FONCTION                PIC X(4).          00100000
               10  STDER-NOM-PROG                    PIC X(8).          00110000
               10  STDER-NOM-MAPSET                  PIC X(8).          00120000
               10  STDER-NOM-MAP                     PIC X(8).          00130000
               10  STDER-LIB-ECRAN                   PIC X(40).         00140000
               10  STDER-BOITE                       PIC X(08).         00150000
               10  STDER-PARAG                       PIC X(32).         00160000
               10  STDER-LIG-MTRA                    PIC X(76).         00170000
               10  STDER-LS-MESS                     PIC X(78).         00180000
               10  STDER-ABCODE.                                        00190000
                   15  STDER-ABCODE-1                PIC XX.            00200000
                   15  STDER-ABCODE-2                PIC XX.            00210000
      **AD     10  FILLER                            PIC X(4).          00211005
               10  FILLER                            PIC X(3).          00212004
               10  STDER-HDLR                        PIC X(1).          00213004
                   88  APPEL-HANDLER  VALUE '1'.                        00214004
               10  STDER-TERM-PHYS                   PIC X(4).          00220000
               10  STDER-IMPR                        PIC X(4).          00240000
               10  STDER-TS-USER OCCURS 5            PIC X(4).          00250000
               10  STDER-DUMP                        PIC X.             00260000
               10  STDER-BACKOUT                     PIC X.             00270000
               10  STDER-MESSAGE                     PIC X(32).         00280000
               10  FILLER                            PIC X(46).         00290000
               10  STDER-ABSTIME-DEBUT               PIC S9(15) COMP-3. 00300000
               10  STDER-ABSTIME-FIN                 PIC S9(15) COMP-3. 00310000
               10  STDER-EIB-BLOC.                                      00320000
                   15  STDER-EIBTIME                 PIC S9(7)  COMP-3. 00330000
                   15  STDER-EIBDATE                 PIC S9(7)  COMP-3. 00340000
                   15  STDER-EIBTRNID                PIC X(4).          00350000
                   15  STDER-EIBTASKN                PIC S9(7)  COMP-3. 00360000
                   15  STDER-EIBTRMID                PIC X(4).          00370000
                   15  STDER-DFHEIGDI                PIC S9(4)  COMP.   00380000
                   15  STDER-EIBCPOSN                PIC S9(4)  COMP.   00390000
                   15  STDER-EIBCALEN                PIC S9(4)  COMP.   00400000
                   15  STDER-EIBAID                  PIC X.             00410000
                   15  STDER-EIBFN                   PIC X(2).          00420000
                   15  STDER-EIBRCODE                PIC X(6).          00430000
                   15  STDER-EIBDS                   PIC X(8).          00440000
                   15  STDER-EIBREQID                PIC X(8).          00450000
                   15  STDER-EIBRSRCE                PIC X(8).          00460000
                   15  STDER-EIBSYNC                 PIC X.             00470000
                   15  STDER-EIBFREE                 PIC X.             00480000
                   15  STDER-EIBRECV                 PIC X.             00490000
                   15  STDER-EIBFIL01                PIC X.             00500000
                   15  STDER-EIBATT                  PIC X.             00510000
                   15  STDER-EIBEOC                  PIC X.             00520000
                   15  STDER-EIBFMH                  PIC X.             00530000
                   15  STDER-EIBCOMPL                PIC X.             00540000
                   15  STDER-EIBSIG                  PIC X.             00550000
                   15  STDER-EIBCONF                 PIC X.             00560000
                   15  STDER-EIBERR                  PIC X.             00570000
                   15  STDER-EIBERRCD                PIC X(4).          00580000
                   15  STDER-EIBSYNRB                PIC X.             00590000
                   15  STDER-EIBNODAT                PIC X.             00600000
                   15  STDER-EIBRESP                 PIC S9(8) COMP.    00610000
                   15  STDER-EIBRESP2                PIC S9(8) COMP.    00620000
                   15  STDER-EIBRLDBK                PIC X.             00630000
                   15  FILLER                        PIC X(15).         00640000
               10  STDER-DONNEE                      PIC X(1000).       00650000
               10  STDER-DB2 REDEFINES STDER-DONNEE.                    00660000
                   15  STDER-DB2-SQLCODE             PIC S9(3)  COMP-3. 00670000
                   15  STDER-DB2-SQLCA               PIC X(136).        00680000
                   15  STDER-DB2-TABLE               PIC X(18).         00690000
                   15  STDER-DB2-CLE                 PIC X(234).        00700000
                   15  FILLER                        PIC X(610).        00710000
               10  STDER-DL1 REDEFINES STDER-DONNEE.                    00720000
                   15  STDER-DL1-ZONE.                                  00730000
                       20  STDER-DL1-DIBSTAT         PIC XX.            00740000
                       20  STDER-DL1-NOMSEGM         PIC X(8).          00750000
                       20  STDER-DL1-NOMPCB          PIC X(12).         00760000
                       20  STDER-DL1-RGPCB           PIC XX.            00770000
                       20  STDER-DL1-MESSAGE         PIC X(20).         00780000
                       20  STDER-DL1-NOMRAC          PIC X(8).          00790000
                       20  STDER-DL1-CODEOP          PIC XX.            00800000
                       20  STDER-DL1-CLERACLIB       PIC X(20).         00810000
                       20  STDER-DL1-CLERACVAL       PIC X(50).         00820000
                       20  STDER-DL1-CLESEGLIB       PIC X(20).         00830000
                       20  STDER-DL1-CLESEGVAL       PIC X(50).         00840000
                   15  STDER-DL1-NOMPSB              PIC X(8).          00850000
                   15  FILLER                        PIC X(798).        00860000
               10  STDER-ARMIDE REDEFINES STDER-DONNEE.                 00870000
                   15  STDER-ARMI-FONCTION           PIC XX.            00880000
                   15  STDER-ARMI-MODE-TRAITMT       PIC XX.            00890000
                   15  STDER-ARMI-IDOBJET.                              00900000
                       20  STDER-ARMI-TYPE-OBJ       PIC XX.            00910000
                       20  STDER-ARMI-SITE-OBJ       PIC X(4).          00920000
                       20  STDER-ARMI-NOM-OBJ        PIC X(8).          00930000
                       20  STDER-ARMI-VERSION        PIC X.             00940000
                   15  STDER-ARMI-DATE-REFERENCE     PIC X(8).          00950000
                   15  STDER-ARMI-MEX.                                  00960000
                       20  STDER-ARMI-MEX-DATE       PIC X(8).          00970000
                       20  STDER-ARMI-MEX-HEURE      PIC X(4).          00980000
                   15  STDER-ARMI-IDSDT.                                00990000
                       20  STDER-ARMI-SITE-SDT       PIC X(4).          01000000
                       20  STDER-ARMI-NOM-SDT        PIC X(8).          01010000
                   15  FILLER                        PIC X.             01020000
                   15  STDER-ARMI-IDVUE.                                01030000
                       20  STDER-ARMI-SITEVUE        PIC X(4).          01040000
                       20  STDER-ARMI-COOBJVUE       PIC X(8).          01050000
                   15  FILLER                        PIC X.             01060000
                   15  STDER-ARMI-VALEUR-MINI        PIC X(30).         01070000
                   15  STDER-ARMI-VALEUR-MAXI        PIC X(30).         01080000
                   15  STDER-ARMI-CSYSTEME           PIC XX.            01090000
                   15  STDER-ARMI-CSOUS-SYSTEME.                        01100000
                       20  STDER-ARMI-CODESS         PIC X OCCURS 10.   01110000
                   15  STDER-ARMI-NBPOSTES           PIC X(4).          01120000
                   15  STDER-ARMI-TAILLEPOSTE        PIC X(4).          01130000
                   15  STDER-ARMI-CODERETOUR         PIC 99.            01140000
                       88  STDER-ARMI-ACCES-OK          VALUE ZERO .    01150000
                       88  STDER-ARMI-PROBLEME          VALUE 1 THRU 9. 01160000
                       88  STDER-ARMI-FIN-PTE           VALUE 48.       01170000
                       88  STDER-ARMI-FIN-DE-LISTE      VALUE 92 94 97. 01180000
                       88  STDER-ARMI-ENCORE-A-LIRE     VALUE 93 95.    01190000
                   15  STDER-ARMI-CODERESULTAT       PIC 9.             01200000
                       88  STDER-ARMI-PTE-STOPPEE       VALUE 0.        01210000
                       88  STDER-ARMI-NON-TROUVE        VALUE 0.        01220000
                       88  STDER-ARMI-TROUVE            VALUE 1.        01230000
                   15  STDER-ARMI-MESSAGE            PIC X(60).         01240000
                   15  STDER-ARMI-ACTEUR             PIC X(8).          01250000
                   15  STDER-ARMI-BLOCAGE            PIC X.             01260000
                       88  STDER-ARMI-ARRET-PTE         VALUE 'S'.      01270000
                       88  STDER-ARMI-POURSUITE-PTE     VALUE 'W' ' '.  01280000
                       88  STDER-ARMI-MAJ-AVANT-SUITE-PTE VALUE 'E' .   01290000
                       88  STDER-ARMI-DERNIER-STEP-PTE  VALUE 'F' .     01300000
                   15  STDER-ARMI-PREFIXE            PIC X(4).          01310000
                   15  FILLER                        PIC X(27).         01320000
                   15  STDER-ARMI-ZTECH              PIC X(8).          01330000
                   15  STDER-ARMI-SDT                PIC X(444).        01340000
                   15  FILLER                        PIC X(300).        01350000
               10  STDER-COMENCH                     PIC X(300).        01360001
      *$XENDINCLUDE
           EJECT
       LINKAGE SECTION.
      *
       01  DFHCOMMAREA       PIC X(5120).
           EJECT
      *
      *$XINCLUDE ZSTDSTCOPCWA                        STDSTCOPCWA        INL
           COPY  COPCWA.
      *$XENDINCLUDE
           EJECT
      *
       PROCEDURE DIVISION USING DFHCOMMAREA.
      * *============================================================*
      * *           I PROCEDURE DIVISION                             *
      * *------------------------------------------------------------*
      * *                                                            *
      * * 10000     I TRAITEMENT ENTREE DANS LE PROGRAMME            *
      * * 20000     I TRAITEMENT INTERACTION                         *
      * * 30000     I TRAITEMENT SORTIE DU PROGRAMME                 *
      * *                                                            *
      * *============================================================*
           PERFORM 10000-TRAIT-ENTREE.
           PERFORM 20000-TRAIT-INTERACTION.
           PERFORM 30000-TRAIT-SORTIE.
           GOBACK.
           EJECT
      * *============================================================*
      * * 10000     I TRAITEMENT ENTREE DANS LE PROGRAMME            *
      * *------------------------------------------------------------*
      * *                                                            *
      * * LE TRAITEMENT ENTREE EST EXECUTE A CHAQUE ENTREE PHYSIQUE  *
      * *    DANS LE PROGRAMME. IL COMPORTE :                        *
      * *                                                            *
      * *  - UN TRAITEMENT STANDARD D'INITIALISATION DES VARIABLES   *
      * *    DU PROGRAMME ET DE L'ENV. TECHNOLOGIQUE.                *
      * *  - UN TRAITEMENT SPECIFIQUE, EVENTUEL, PROPRE AU PROGRAMME *
      * *    POUR LES INITIALISATIONS COMPLEMENTAIRES.               *
      * *                                                            *
      * *============================================================*
       10000-TRAIT-ENTREE            SECTION.
           PERFORM 11000-TRAIT-ENTREE-STD.
           IF  WS-ENTREE    NOT = 'RF'             OR
              (WS-TRAIT-NOM NOT = WS-ACTNOM-STPF01 AND
                            NOT = WS-ACTNOM-AIDK)
               PERFORM 12000-TRAIT-ENTREE-SPEC
           END-IF.
           EJECT
      *$XINCLUDE ZSTDST1000PA                        STDST1000PA        INL
      * *============================================================*  00010099
      * * 11000      I STANDARD PROGRAM ENTRY                        *  00020099
      * *------------------------------------------------------------*  00030099
      * *                                                            *  00040099
      * *   THIS ENTRY PROCESSING IS STANDARD FOR ALL PROGRAMS.      *  00050099
      * *   IT PERFORMS :                                            *  00060099
      * *                                                            *  00070099
      * *    - THE INITIALIZATION OF ERRORS'CONDITIONS               *  00080099
      * *    - THE TEST ABOUT ORIGIN AND EVENTUALLY THE COMMAREA     *  00090099
      * *      RECOVERY                                              *  00100099
      * *    - THE INITIALIZATION OF PILOTING VARIABLES AND OF       *  00110099
      * *      WORK AREAS IN THE WORKING-STORAGE, DEPENDING ON THE   *  00120099
      * *      ENTRY TYPE                                            *  00130099
      * *                                                            *  00140099
      * *============================================================*  00150099
       11000-TRAIT-ENTREE-STD         SECTION.                          00160099
           EXEC CICS HANDLE ABEND                                       00170099
                     LABEL (90000-ERROR-ABEND)                          00180099
           END-EXEC.                                                    00190099
           INITIALIZE STDER-ERREUR.                                     00200099
           MOVE EIBDATE                 TO STDER-DATE.                  00210099
           MOVE EIBTIME                 TO STDER-HEURE.                 00220099
           MOVE SPACE                   TO MSTD-MESS.                   00230099
           MOVE SPACE                   TO WS-MESSAGE-FONC.             00240099
           MOVE SPACE                   TO WS-MESSAGE-PARAM.            00250099
           MOVE SPACE                   TO WS-MESSAGE-MESS.             00260099
      *                                                                 00270099
      *-----------INITIALIZATION CICS HANDLE CONDITION                  00280099
      *                                                                 00290099
           PERFORM 90000-CONDERR-INIT.                                  00300099
      *----RECOVER THE FUNCTION'S ABSTIME                               00310099
           EXEC CICS ASKTIME                                            00320099
                     ABSTIME(STDER-ABSTIME-DEBUT)                       00330099
           END-EXEC.                                                    00340099
      *---IDENTIFY CICS SESSION                                         00350099
      *---RECOVER CICS SIGNATURE (CESN)                                 00360099
           EXEC CICS ASSIGN APPLID (WS-SESS-ID)                         00370099
                            USERID (WS-USER-ID)                         00380099
           END-EXEC.                                                    00390099
           IF WS-USER-ID          = WS-CICSUSER-NOM                     00400099
              MOVE SPACE          TO WS-USER-ID                         00410099
           END-IF.                                                      00420099
      *---IDENTIFY PHYSICAL TERMINAL NAME                               00430099
           MOVE EIBTRMID          TO WS-TS-TRMID.                       00440099
      *---IDENTIFY ASSOCIATED PRINTERS                                  00450099
      *    EXEC CICS INQUIRE TERMINAL   (EIBTRMID)                      00460099
      *                      PRINTER    (WS-TERM-PRINTER)               00470099
      *                      ALTPRINTER (WS-TERM-ALTPRINTER)            00480099
      *    END-EXEC.                                                    00490099
      *                                                                 00500099
      *---------------TEST ON TRANSACTION CODE'S VALIDITY               00510099
      *                                                                 00520099
           IF  EIBTRNID       NOT = STDP-CODE-TRN                       00530099
               MOVE EIBTRNID        TO MSTD-PMESS (1)                   00540099
               MOVE STDP-CODE-TRN   TO MSTD-PMESS (2)                   00550099
               MOVE 'ST9101'        TO MSTD-NOMESS                      00560099
               MOVE 'PRIN'          TO STDER-TYPE-ERREUR                00570099
               MOVE 'AB'            TO WS-SORTIE                        00580099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         00590099
           END-IF.                                                      00600099
      *                                                                 00610099
      *---------------TEST ON CICS ORIGIN                               00620099
      *                                                                 00630099
           IF  EIBCALEN           > 0                                   00640099
               MOVE ZERO            TO WS-ZLECT-LONG                    00650099
               MOVE DFHCOMMAREA     TO LS-COMMAREA                      00660099
               GO TO 11000-TRAIT-ENTREE-STD-2                           00670099
           END-IF.                                                      00680099
      *                                                                 00690099
      *--------------DIRECT ENTRY INTO FUNCTION                         00700099
      *---ENTRY NOT ALLOWED FOR A NON ENTRY POINT PROGRAM               00710099
      *                                                                 00720099
           IF  MTRA-ECET (1)  NOT = ZERO                                00730099
               MOVE STDP-CODE-TRN   TO MSTD-PMESS (1)                   00740099
               MOVE 'ST9102'        TO MSTD-NOMESS                      00750099
               MOVE 'RM'            TO WS-SORTIE                        00760099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         00770099
           END-IF.                                                      00780099
      *---FORCE THE UPPERCASE /LOWER CASE CONVERSION                    00790099
      *    EXEC CICS SET TERMINAL (EIBTRMID)                            00800099
      *                  UCTRAN                                         00810099
      *                  NOHANDLE                                       00820099
      *    END-EXEC.                                                    00830099
      *                                                                 00840099
           MOVE  SPACE           TO LS-COMMAREA.                        00850099
           INITIALIZE LS-STD.                                           00860099
      *---LOAD DATA ENTERED ON SCREEN                                   00870099
           COMPUTE  WS-ZLECT-LONG = LENGTH OF WS-ZLECT.                 00880099
           MOVE  SPACE           TO  WS-ZLECT.                          00890099
           MOVE  ACCEPT-ERR-OUI  TO  ACCEPT-LENGERR.                    00900099
      *                                                                 00910099
           EXEC CICS RECEIVE INTO   (WS-ZLECT)                          00920099
                             LENGTH (WS-ZLECT-LONG)                     00930099
                             NOHANDLE                                   00940099
           END-EXEC.                                                    00950099
      *                                                                 00960099
           PERFORM  90000-CONDERR-TEST.                                 00970099
      *                                                                 00980099
           IF  LENGERR                                                  00990099
               COMPUTE  WS-ZLECT-LONG = LENGTH OF WS-ZLECT              01000099
           END-IF.                                                      01010099
      *                                                                 01020099
           IF  WS-ZLECT-LONG      <  5                                  01030099
               MOVE ZERO             TO WS-ZLECT-LONG                   01040099
               GO TO 11000-TRAIT-ENTREE-STD-0                           01050099
           END-IF.                                                      01060099
      *                                                                 01070099
           MOVE  ZERO                TO  WS-IND2.                       01080099
           PERFORM VARYING  WS-IND1  FROM  1  BY  1                     01090099
                   UNTIL  WS-IND1  >  (WS-ZLECT-LONG - 4)               01100099
                      OR  WS-IND2 = 1                                   01110099
              IF  WS-ZLECT-IDENT-C (WS-IND1)  NOT = SPACE               01120099
                                          OR      = LOW-VALUE           01130099
                     AND  WS-IND2 = 0                                   01140099
                  MOVE  1            TO  WS-IND2                        01150099
              END-IF                                                    01160099
           END-PERFORM.                                                 01170099
           IF  WS-IND2            = 0                                   01180099
               MOVE ZERO             TO WS-ZLECT-LONG                   01190099
               GO TO 11000-TRAIT-ENTREE-STD-0                           01200099
           END-IF.                                                      01210099
      *                                                                 01220099
           SUBTRACT  1             FROM  WS-IND1.                       01230099
           COMPUTE WS-IND3           =   WS-IND1 + 3.                   01240099
           MOVE  1                   TO  WS-IND2.                       01250099
           PERFORM  UNTIL  WS-IND1  >  (WS-ZLECT-LONG - 4)              01260099
               MOVE  WS-ZLECT-IDENT-C (WS-IND1)                         01270099
                                     TO  LS-TRAIT-PARM-C (WS-IND2)      01280099
               ADD   1               TO  WS-IND1  WS-IND2               01290099
           END-PERFORM.                                                 01300099
           COMPUTE WS-ZLECT-LONG     =   WS-ZLECT-LONG - WS-IND3.       01310099
      *                                                                 01320099
       11000-TRAIT-ENTREE-STD-0.                                        01330099
           MOVE SPACE              TO WS-FONCSVT-CMDE.                  01340099
           MOVE LS-TRAIT-PARM      TO WS-TRAIT-PARM.                    01350099
      *                                                                 01360099
      *---RECOVER USER'S AUTHORIZATIONS                                 01370099
           INITIALIZE COMAUTO.                                          01380099
           IF  WS-USER-ID    =  SPACE                                   01390099
               MOVE +1            TO  COM-AUTSIGN                       01400099
               GO TO 11000-TRAIT-ENTREE-STD-1                           01410099
           END-IF.                                                      01420099
      *                                                                 01430099
           MOVE LENGTH OF COMAUTO TO WS-LGAUTO.                         01440099
           MOVE ACCEPT-ERR-OUI    TO ACCEPT-PGMIDERR.                   01450099
      *                                                                 01460099
           EXEC CICS HANDLE ABEND                                       01470099
                     CANCEL                                             01480099
           END-EXEC.                                                    01490099
      *                                                                 01500099
           EXEC CICS LINK PROGRAM  (WS-PIAUTO-PGM)                      01510099
                          COMMAREA (COMAUTO)                            01520099
                          LENGTH   (WS-LGAUTO)                          01530099
                          NOHANDLE                                      01540099
           END-EXEC.                                                    01550099
      *                                                                 01560099
           PERFORM 90000-CONDERR-TEST.                                  01570099
      *                                                                 01580099
           EXEC CICS HANDLE ABEND                                       01590099
                     RESET                                              01600099
           END-EXEC.                                                    01610099
      *                                                                 01620099
      * *----------------------- PIAUTO PROGRAM DISABLED                01630099
           IF  PGMIDERR                                                 01640099
               MOVE WS-PIAUTO-PGM TO MSTD-PMESS (1)                     01650099
               MOVE 'ST9701'      TO MSTD-NOMESS                        01660099
               MOVE 'CICS'        TO STDER-TYPE-ERREUR                  01670099
               MOVE 'AB'          TO WS-SORTIE                          01680099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         01690099
           END-IF.                                                      01700099
      *                                                                 01710099
           IF  COM-AUTSIGN   =  -1                                      01720099
               MOVE 'AB'          TO WS-SORTIE                          01730099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         01740099
           END-IF.                                                      01750099
      *                                                                 01760099
           PERFORM 90000-ERASE-TSAUTO.                                  01770099
           MOVE +1                TO WS-AUTO-ITEM.                      01780099
      *                                                                 01790099
           EXEC CICS WRITEQ  TS QUEUE  (WS-TS-ID)                       01800099
                                FROM   (COMAUTO)                        01810099
                                LENGTH (WS-LGAUTO)                      01820099
                                ITEM   (WS-AUTO-ITEM)                   01830099
                                MAIN                                    01840099
                                NOHANDLE                                01850099
           END-EXEC.                                                    01860099
      *                                                                 01870099
           PERFORM 90000-CONDERR-TEST.                                  01880099
      *                                                                 01890099
       11000-TRAIT-ENTREE-STD-1.                                        01900099
      *                                                                 01910099
      *---CONTROL AUTHORIZATION OF A DIRECT ENTRY                       01920099
           IF  STDP-NOM-FONC  NOT = WS-ACTNOM-STPF01                    01930099
               PERFORM 80000-CONTROLE-ENCH                              01940099
           END-IF.                                                      01950099
      *                                                                 01960099
           IF  WS-SORTIE          = 'EM'                                01970099
               MOVE  WS-ZLECT-TRNID TO WS-MESSAGE-FONC                  01980099
               MOVE  WS-TRAIT-PARM  TO WS-MESSAGE-PARAM                 01990099
               MOVE  'RM'           TO WS-SORTIE                        02000099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         02010099
           END-IF.                                                      02020099
           IF  WS-SORTIE          = 'AB'                                02030099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         02040099
           END-IF.                                                      02050099
      *                                                                 02060099
           MOVE  STDP-NOM-FONC    TO LS-ENC-FONC.                       02070099
           MOVE  'EX'             TO LS-ENC-ENFONC.                     02080099
           GO TO 11000-TRAIT-ENTREE-STD-3.                              02090099
      *                                                                 02100099
       11000-TRAIT-ENTREE-STD-2.                                        02110099
           MOVE SPACE             TO WS-FONCSVT-CMDE.                   02120099
           MOVE LS-TRAIT-PARM     TO WS-TRAIT-PARM.                     02130099
      *                                                                 02140099
           MOVE WS-TS-AUTO-NOM    TO WS-TS-NOM.                         02150099
           MOVE LENGTH OF COMAUTO TO WS-LGAUTO.                         02160099
           MOVE +1                TO WS-AUTO-ITEM.                      02170099
           MOVE ACCEPT-ERR-OUI    TO ACCEPT-QIDERR.                     02180099
           MOVE ACCEPT-ERR-OUI    TO ACCEPT-LENGERR.                    02190099
      *                                                                 02200099
           EXEC CICS READQ   TS QUEUE  (WS-TS-ID)                       02210099
                                INTO   (COMAUTO)                        02220099
                                LENGTH (WS-LGAUTO)                      02230099
                                ITEM   (WS-AUTO-ITEM)                   02240099
                                NOHANDLE                                02250099
           END-EXEC.                                                    02260099
      *                                                                 02270099
           PERFORM 90000-CONDERR-TEST.                                  02280099
      *                                                                 02290099
           IF  QIDERR OR (STDP-NOM-FONC = 'CONF' OR 'TAUT')             02300099
               IF  WS-USER-ID     = SPACE                               02310099
                   INITIALIZE COMAUTO                                   02320099
                   MOVE +1        TO  COM-AUTSIGN                       02330099
                   GO TO 11000-TRAIT-ENTREE-STD-3                       02340099
               ELSE                                                     02350099
                   NEXT SENTENCE                                        02360099
               END-IF                                                   02370099
           ELSE                                                         02380099
               GO TO 11000-TRAIT-ENTREE-STD-3                           02390099
           END-IF.                                                      02400099
      *                                                                 02410099
           MOVE ACCEPT-ERR-OUI    TO ACCEPT-PGMIDERR.                   02420099
      *                                                                 02430099
           EXEC CICS HANDLE ABEND                                       02440099
                     CANCEL                                             02450099
           END-EXEC.                                                    02460099
      *                                                                 02470099
           EXEC CICS LINK PROGRAM  (WS-PIAUTO-PGM)                      02480099
                          COMMAREA (COMAUTO)                            02490099
                          LENGTH   (WS-LGAUTO)                          02500099
                          NOHANDLE                                      02510099
           END-EXEC.                                                    02520099
      *                                                                 02530099
           PERFORM 90000-CONDERR-TEST.                                  02540099
      *                                                                 02550099
           EXEC CICS HANDLE ABEND                                       02560099
                     RESET                                              02570099
           END-EXEC.                                                    02580099
      *                                                                 02590099
      * *------------------------ PIAUTO PROGRAM DISABLED               02600099
           IF  PGMIDERR                                                 02610099
               MOVE WS-PIAUTO-PGM TO MSTD-PMESS (1)                     02620099
               MOVE 'ST9701'      TO MSTD-NOMESS                        02630099
               MOVE 'CICS'        TO STDER-TYPE-ERREUR                  02640099
               MOVE 'AB'          TO WS-SORTIE                          02650099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         02660099
           END-IF.                                                      02670099
      *                                                                 02680099
           IF  COM-AUTSIGN   =  -1                                      02690099
               MOVE 'AB'          TO WS-SORTIE                          02700099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         02710099
           END-IF.                                                      02720099
      *                                                                 02730099
           PERFORM 90000-ERASE-TSAUTO.                                  02740099
           MOVE +1                TO WS-AUTO-ITEM.                      02750099
      *                                                                 02760099
           EXEC CICS WRITEQ  TS QUEUE  (WS-TS-ID)                       02770099
                                FROM   (COMAUTO)                        02780099
                                LENGTH (WS-LGAUTO)                      02790099
                                ITEM   (WS-AUTO-ITEM)                   02800099
                                MAIN                                    02810099
                                NOHANDLE                                02820099
           END-EXEC.                                                    02830099
      *                                                                 02840099
           PERFORM 90000-CONDERR-TEST.                                  02850099
      *                                                                 02860099
       11000-TRAIT-ENTREE-STD-3.                                        02870099
      *----RECOVER DATES                                                02880099
           EXEC CICS ADDRESS CWA (ADDRESS OF CWAZONE)                   02890099
           END-EXEC.                                                    02900099
           MOVE  EIBDATE          TO WS-DQCPU.                          02910099
           PERFORM  60000-TRANSF-DATES.                                 02920099
           MOVE  CWA-SIECLE       TO WS-DTCPU-S                         02930099
                                     WS-DQCPU-S                         02940099
                                     WS-DQTRT-S.                        02950099
                                                                        02951099
      *---RECOVER SYSTEM DATE IN DB2 FORMAT : (WS-DTCPU-DB2)            02952099
                                                                        02953099
           MOVE  '.'           TO   WS-DTCPU-DB2-POINT1                 02954099
                                    WS-DTCPU-DB2-POINT2.                02955099
           MOVE  WS-DTCPU-JJ   TO   WS-DTCPU-DB2-JJ.                    02956099
           MOVE  WS-DTCPU-MM   TO   WS-DTCPU-DB2-MM.                    02957099
           MOVE  WS-DTCPU-S    TO   WS-DTCPU-DB2-SS.                    02958099
           MOVE  WS-DTCPU-AA   TO   WS-DTCPU-DB2-AA.                    02959099
                                                                        02959199
      *---INITIALIZATION OF PILOTING VARIABLES AND OF WORK AREAS        02960099
           MOVE '1'               TO WS-CDINTERACT.                     02970099
           MOVE SPACE             TO WS-ENTREE                          02980099
                                     WS-SORTIE                          02990099
                                     WS-STATUT-MESSAGE                  03000099
                                     WS-TRAITEMENT                      03010099
                                     WS-ENC-ECET-INI                    03020099
                                     WS-TR-IND                          03030099
                                     WS-CTRLET                          03040099
                                     WS-TRAIT-PILOTE.                   03050099
           MOVE 'N'               TO WS-TOPERMAP.                       03060099
           MOVE 'N'               TO WS-TOPEC.                          03070099
           MOVE 'N'               TO WS-TOP-PREPINI.                    03080099
           MOVE 'N'               TO WS-TOPMDTON.                       03090099
           MOVE 'N'               TO WS-TOPMDTON-ALL.                   03100099
           MOVE 'N'               TO WS-SCROLL.                         03110099
           MOVE LENGTH OF LS-COMMAREA-R                                 03120099
                                  TO WS-LGCOM.                          03130099
           MOVE ZERO              TO WS-POS-CURS.                       03140099
           MOVE WS-DSC-ATTR-VALEURS                                     03150099
                                  TO WS-DSC-ATTR.                       03160099
           MOVE WS-TABLETF-VALEURS                                      03170099
                                  TO WS-TABLETF.                        03180099
      *---INITIALIZATION OF ARMIDE CONTROL AREAS                        03190099
           INITIALIZE ARM-CONTROLE.                                     03200099
           MOVE WS-USER-ID        TO ARM-USERCICS.                      03210099
           MOVE STDP-NOM-PGM      TO ARM-PROGRAMM.                      03220099
           MOVE STDP-NOM-FONC     TO ARM-NOM-FONCTION.                  03230099
      *                                                                 03240099
      *----------------------RETURN AFTER SCREEN RECALL (PF3)           03250099
      *                                                                 03260099
           IF LS-ENC-ENFONC     = 'P3'                                  03270099
               MOVE  'N'          TO WS-CDINTERACT                      03280099
               MOVE  'P3'         TO WS-ENTREE                          03290099
               MOVE  '1'          TO WS-TOPERMAP                        03300099
               MOVE  SPACE        TO LS-ENC-PF                          03310099
               MOVE  SPACE        TO LS-ENC-ENFONC                      03320099
               MOVE  1            TO LS-TSCO-ITEM                       03330099
               MOVE  ZERO         TO LS-TSCO-IND                        03340099
               MOVE  1            TO LS-TSDES-ITEM                      03350099
               MOVE  1            TO LS-TSDES-IND                       03360099
               MOVE  SPACE        TO LS-TSFONC-NOM                      03370099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         03380099
           END-IF.                                                      03390099
      *                                                                 03400099
      *------------------------FUNCTION RETURN / CALL                   03410099
      *                                                                 03420099
           IF LS-ENC-ENFONC     = 'RF'                                  03430099
               MOVE  'N'          TO WS-CDINTERACT                      03440099
               MOVE  'RF'         TO WS-ENTREE                          03450099
               MOVE  LS-PREC-RESU TO WS-TRAIT-RESULTAT                  03460099
               MOVE  SPACE        TO LS-ENC-ENFONC                      03470099
               SUBTRACT  1      FROM LS-TSCO-ITEM                       03480099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         03490099
           ELSE                                                         03500099
               IF LS-ENC-ENFONC = 'AF'                                  03510099
                  MOVE  'AF'           TO WS-ENTREE                     03520099
                  MOVE  STDP-NOM-PGM   TO LS-ENC-PROG                   03530099
                  MOVE  ZERO           TO LS-ENC-ECET                   03540099
                  MOVE  'FF'           TO LS-ENC-ENFONC                 03550099
                  ADD   1              TO LS-TSCO-ITEM                  03560099
                  MOVE  SPACE          TO LS-TABLE-TS                   03570099
                  MOVE  ZERO           TO LS-TABTS-NBMAX                03580099
                  IF LS-TSFONC-NOM NOT = SPACE                          03590099
                     MOVE  +1              TO LS-TABTS-NBMAX            03600099
                     MOVE  LS-TSFONC-NOM   TO LS-TABTS-NOM (1)          03610099
                     MOVE  SPACE           TO LS-TSFONC-NOM             03620099
                  END-IF                                                03630099
                  MOVE  SPACE          TO LSF-FONC                      03640099
                  MOVE  SPACE          TO LSP-PROG                      03650099
                  MOVE  LOW-VALUE      TO MSGI-MESSAGE                  03660099
                  GO TO 11000-TRAIT-ENTREE-STD-FIN                      03670099
               END-IF                                                   03680099
           END-IF.                                                      03690099
      *                                                                 03700099
      *------------------------SCREEN RETURN / CALL                     03710099
      *                                                                 03720099
           IF LS-ENC-ENFONC     = 'RE'                                  03730099
               MOVE  'N'          TO WS-CDINTERACT                      03740099
               MOVE  'RE'         TO WS-ENTREE                          03750099
               MOVE  LS-PREC-RESU TO WS-TRAIT-RESULTAT                  03760099
               MOVE  SPACE        TO LS-ENC-ENFONC                      03770099
               SUBTRACT  1      FROM LS-TSCO-ITEM                       03780099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         03790099
           ELSE                                                         03800099
               IF LS-ENC-ENFONC = 'AE'                                  03810099
                  MOVE  'AE'           TO WS-ENTREE                     03820099
                  MOVE  SPACE          TO LS-ENC-ENFONC                 03830099
                  ADD   1              TO LS-TSCO-ITEM                  03840099
                  MOVE  SPACE          TO LSP-PROG                      03850099
                  MOVE  LOW-VALUE      TO MSGI-MESSAGE                  03860099
                  GO TO 11000-TRAIT-ENTREE-STD-FIN                      03870099
               END-IF                                                   03880099
           END-IF.                                                      03890099
      *                                                                 03900099
      *------------------------SERVICE RETURN / CALL                    03910099
      *                                                                 03920099
           IF LS-ENC-ENFONC     = 'RS'                                  03930099
               MOVE  'N'          TO WS-CDINTERACT                      03940099
               MOVE  'RS'         TO WS-ENTREE                          03950099
               MOVE  LS-PREC-RESU TO WS-TRAIT-RESULTAT                  03960099
               MOVE  SPACE        TO LS-ENC-ENFONC                      03970099
               SUBTRACT  1      FROM LS-TSCO-ITEM                       03980099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         03990099
           ELSE                                                         04000099
               IF LS-ENC-ENFONC = 'AS'                                  04010099
                  MOVE  'AS'           TO WS-ENTREE                     04020099
                  MOVE  SPACE          TO LS-ENC-ENFONC                 04030099
                  ADD   1              TO LS-TSCO-ITEM                  04040099
                  MOVE  SPACE          TO LSP-PROG                      04050099
                  GO TO 11000-TRAIT-ENTREE-STD-FIN                      04060099
               END-IF                                                   04070099
           END-IF.                                                      04080099
      *                                                                 04090099
      *------------------------FUNCTION RUPTURE                         04100099
      *----DIRECT ENTRY / CHAINING WITH OR WITHOUT FUNCT. PROCEDURE     04110099
      *                                                                 04120099
           IF LS-ENC-ENFONC     = 'EX'                                  04130099
               MOVE  'IF'              TO WS-ENTREE                     04140099
               MOVE  STDP-NOM-PGM      TO LS-ENC-PROG                   04150099
               MOVE  ZERO              TO LS-ENC-ECET                   04160099
               MOVE  SPACE             TO LS-ENC-ENFONC                 04170099
               MOVE  1                 TO LS-TSCO-ITEM                  04180099
               MOVE  ZERO              TO LS-TSCO-IND                   04190099
               MOVE  ZERO              TO LS-TSDES-ITEM                 04200099
               MOVE  ZERO              TO LS-TSDES-IND                  04210099
               MOVE  SPACE             TO LS-TABLE-TS                   04220099
               MOVE  ZERO              TO LS-TABTS-NBMAX                04230099
               IF LS-TSFONC-NOM NOT = SPACE                             04240099
                  MOVE  +1             TO LS-TABTS-NBMAX                04250099
                  MOVE  LS-TSFONC-NOM  TO LS-TABTS-NOM (1)              04260099
                  MOVE  SPACE          TO LS-TSFONC-NOM                 04270099
               END-IF                                                   04280099
               MOVE  SPACE             TO LSF-FONC                      04290099
               MOVE  SPACE             TO LSP-PROG                      04300099
               MOVE  LOW-VALUE         TO MSGI-MESSAGE                  04310099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         04320099
           END-IF.                                                      04330099
      *                                                                 04340099
      *-----------------------SCREEN RUPTURE/NEW PROGRAM                04350099
      *                                                                 04360099
           IF LS-ENC-EC     NOT = LS-PREC-EC                            04370099
               MOVE 'IE'               TO WS-ENTREE                     04380099
               MOVE '1'                TO WS-TOPERMAP                   04390099
               MOVE '1'                TO WS-TOPEC                      04400099
               MOVE SPACE              TO LSP-PROG                      04410099
               IF LS-PREC-EC                                            04420099
                            NOT = '00'                                  04430099
                  MOVE  LOW-VALUE      TO MSGI-MESSAGE                  04440099
               END-IF                                                   04450099
               GO TO 11000-TRAIT-ENTREE-STD-FIN                         04460099
           END-IF.                                                      04470099
      *                                                                 04480099
      *------------------------PROGRAM'S NTH INTERACTION                04490099
      *                                                                 04500099
           MOVE  'N'                   TO WS-CDINTERACT.                04510099
      *                                                                 04520099
       11000-TRAIT-ENTREE-STD-FIN.                                      04530099
           EXIT.                                                        04540099
      *                                                                 04550099
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4311LIBR  FADR201 MODFADR201P%=12000 INL
      * *============================================================*
      * *   I SPECIFIC INITIALIZATIONS          GENERATED : 03-12-98 *
      * *============================================================*
       12000-TRAIT-ENTREE-SPEC             SECTION.
      *
           MOVE 'INITPROG'     TO STDER-BOITE.
      *
      *
      *      PARAGRAPH EXECUTED AT EACH INTERACTION ON THE PROGRAM
      *                         -------------------
      *
      *
           MOVE  WS-TRAIT-PARM  TO  WF-ENTREE.

           IF     WS-CDINTERACT   = 'N'
             OR WS-SORTIE     NOT = SPACE
                  GO TO 12000-TRAIT-ENTREE-SPEC-FIN.
      *
      *
      *      PARAGRAPH EXECUTED AT 1ST INTERACTION ON THE PROGRAM
      *                         ------------------
      *
      *
       12000-TRAIT-ENTREE-SPEC-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 20000     I TRAITEMENT INTERACTION                         *
      * *------------------------------------------------------------*
      * *                                                            *
      * * LE TRAITEMENT INTERACTION S'APPUIE SUR LES MATRICES        *
      * *  (ENCH., TRANSITION) QUI ASSURENT LE PILOTAGE DU DIALOGUE. *
      * *                                                            *
      * * LES FONCTIONS DE CE TRAITEMENT SONT :                      *
      * *                                                            *
      * *  - INITIALISATION DE L'INTERACTION APRES IDENTIFICATION DE *
      * *    L'ACTION (ENCHAINEMENT INTERNE, ACTION OPERATEUR),      *
      * *  - EXECUTION DE LA TACHE CORRESPONDANT A L'ACTION,         *
      * *  - EXECUTION DE LA TRANSITION POUR CONSTITUTION D'UN       *
      * *    MESSAGE OU DEMANDE D'ENCHAINEMENT.                      *
      * *    LA TRANSITION PEUT DONNER LIEU A ITERATION SUR LE TRAIT *
      * *    INTERACTION SI UN ENCHAINEMENT INTERNE TRAITE PAR LE    *
      * *    PROGRAMME EN-COURS EST DEMANDE.                         *
      * *                                                            *
      * *============================================================*
       20000-TRAIT-INTERACTION       SECTION.
           IF  WS-SORTIE NOT = SPACE
               GO TO 20000-TRAIT-INTERACTION-FIN
           END-IF.
      *
           MOVE LS-ENC-ECET   TO  WS-ENC-ECET.
      *
           IF  WS-ENTREE      = 'P3'
               PERFORM 65200-RESTO-DESCRIPTEUR
               MOVE WS-STDP-IND   TO STDP-IND
               PERFORM 65250-RESTIT-ATTR
               MOVE 'EM'          TO WS-SORTIE
               MOVE '1'           TO WS-TOPMDTON-ALL
               GO TO 20000-TRAIT-INTERACTION-FIN
           END-IF.
      *
       20000-TRAIT-INTERACT-APPEL.
           PERFORM 21000-INIT-INTERACTION.
           PERFORM 22000-EXEC-TRAITEMENT.
      *
           MOVE ZERO              TO  WS-TEST-ITER.
           PERFORM 23000-EXEC-TRANSITION.
      *
           IF  WS-TEST-ITER  = '1'
               GO TO 20000-TRAIT-INTERACT-APPEL
           END-IF.
      *
       20000-TRAIT-INTERACTION-FIN.
           EXIT.
           EJECT
      * *============================================================*
      * * 21000     I INITIALISATION INTERACTION                     *
      * *------------------------------------------------------------*
      * *                                                            *
      * * LE TRAITEMENT D'INITIALISATION DE L'INTERACTION EST FONC-  *
      * *    TION DU TYPE D'ENTREE DANS LE PROGRAMME :               *
      * *                                                            *
      * *  - RUPTURE SUR ECRAN ET NOUVEAU PROGRAMME                  *
      * *  - APPEL SERVICE OU ECRAN (RECHERCHE 1ER ETAT)             *
      * *  - RETOUR APRES TRAITEMENT D'UN APPEL FONCTION, ECRAN      *
      * *    OU SERVICE                                              *
      * *                                                            *
      * *============================================================*
       21000-INIT-INTERACTION       SECTION.
      *
      * *------------------------RUPTURE ECRAN ET NOUVEAU PROGRAMME
      *
           IF  WS-ENTREE            = 'IE'
               IF  WS-ENC-ET-I      = 'I'
                   MOVE 'IA'  TO WS-TRAIT-PILOTE
               ELSE
                   MOVE 'EM'  TO WS-SORTIE
               END-IF
           END-IF.
      *
      * *------------------------APPEL SERVICE OU ECRAN
      *
           IF  WS-ENTREE            = 'AE'  OR
                                    = 'AS'
               PERFORM 21100-ENTREE-SERV-ECR
           END-IF.
      *
           IF  WS-SORTIE        NOT = SPACE
               GO TO 21000-INIT-INTERACTION-FIN
           END-IF.
      *
           IF  WS-TRAIT-PILOTE      = 'IA'
               GO TO 21000-INIT-INTERACTION-SUITE
           END-IF.
      *
      * *------------------------RETOUR APPEL FONCTION, ECRAN, SERVICE
      *
           IF  WS-ENTREE-TYPE       = 'R'
               PERFORM 21200-RESTAU-CONTEXTE-PGM
               IF  WS-ENTREE        = 'RF'
                   IF  WS-TRAIT-NOM = WS-ACTNOM-STPF01 OR
                                    = WS-ACTNOM-AIDK
                       PERFORM 21300-RETDEBR-FONC-STD
                   ELSE
                       PERFORM 21400-RETDEBR-FONC-USER
                   END-IF
                   MOVE LS-TRAIT-PARM
                              TO WS-TRAIT-PARM
               END-IF
               GO TO 21000-INIT-INTERACTION-FIN
           END-IF.
      *
      * *------------------------ACQUISITION MESSAGE ET ACTION
      *
           IF  WS-ENTREE            = SPACE
               MOVE 'L'       TO WS-STATUT-MESSAGE
               PERFORM 21600-ACQUIS-MSGACT
           END-IF.
      *
       21000-INIT-INTERACTION-SUITE.
      *
      * *------------------------ANALYSE DE L'ACTION EFFECTUEE ET
      * *                        RECHERCHE DU TRAITEMENT A ACTIVER
      *
           PERFORM 21700-RECH-ACTION.
      *
      * *------------------------ANALYSE DU MESSAGE RECU
      * *                        GESTION DES ANOMALIES DETECTEES
      * *                        GESTION DEMANDE D'AIDE A LA CODIF
      *
           IF  WS-STATUT-MESSAGE        = 'L' OR
                                        = 'I'
               PERFORM 65200-RESTO-DESCRIPTEUR
               IF  WS-STATUT-MESSAGE    = 'L'   AND
                   WS-SORTIE            = SPACE
                   PERFORM 21800-ANAL-DESCRIPTEUR
                   IF  WS-SORTIE        = SPACE AND
                       MTRA-STD-ACTNOM (MTRA-IND)
                                    NOT = WS-ACTNOM-STPF01
                       PERFORM 60000-INITIAL-ARMIDE
                       PERFORM 21900-APPEL-PTEARMIDE
                   END-IF
               END-IF
               PERFORM 65250-RESTIT-ATTR
               IF (WS-TF                = '07'  OR
                                        = '08') AND
                  WS-EN-NBCHM       NOT = ZERO  AND
                  WS-SORTIE             = SPACE
                  MOVE '1'                  TO WS-TOPMDTON
                  MOVE 'ST9608'             TO MSTD-NOMESS
                  MOVE 'EM'                 TO WS-SORTIE
               END-IF
           END-IF.
      *
       21000-INIT-INTERACTION-FIN.
           EXIT.
           EJECT
      *$XINCLUDE ZSTDST2100PA                        STDST2100PA        INL
      * *============================================================*  00010000
      * * 21100  SEARCH 1ST STATUS OF SCREEN CALL OR SERVICE CALL    *  00020015
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * * - SEARCH AND LOAD 1ST STATUS WHEN 1ST INTERACTION OF A     *  00050015
      * *   SCREEN CALL OR A SERVICE CALL.                           *  00060015
      * * - ALIGNMENT OF PILOTING INTERACTION WS-TRAIT-PILOTE.       *  00070015
      * *                                                            *  00080002
      * *                                                            *  00090000
      * *============================================================*  00100000
       21100-ENTREE-SERV-ECR           SECTION.                         00110001
           MOVE '1'                     TO WS-TOPERMAP.                 00120014
           MOVE 1                       TO MTRA-IND.                    00130014
      *                                                                 00140000
       21100-ENTREE-SERV-ECR-RECH.                                      00150000
           IF  MTRA-IND > MTRA-NBMAX                                    00160000
               GO TO 21100-ENTREE-SERV-ECR-KO                           00170002
           END-IF.                                                      00180002
      *                                                                 00190000
           IF  MTRA-ECRN (MTRA-IND) NOT = WS-ENC-EC                     00200006
               ADD 1                    TO MTRA-IND                     00210000
               GO TO 21100-ENTREE-SERV-ECR-RECH                         00220002
           END-IF.                                                      00230002
      *                                                                 00240000
           MOVE MTRA-ETAT (MTRA-IND)    TO WS-ENC-ET.                   00250006
      *                                                                 00260000
           IF WS-ENTREE      = 'AE'                                     00270009
              IF WS-ENC-ET-I = 'I'                                      00280004
                 MOVE 'IA'              TO WS-TRAIT-PILOTE              00290007
              ELSE                                                      00300000
                 MOVE 'EM'              TO WS-SORTIE                    00310008
              END-IF                                                    00320002
           ELSE                                                         00330000
              MOVE 'IA'                 TO WS-TRAIT-PILOTE              00340007
           END-IF.                                                      00350002
      *                                                                 00360001
           GO TO 21100-ENTREE-SERV-ECR-FIN.                             00370001
      *                                                                 00380001
       21100-ENTREE-SERV-ECR-KO.                                        00390002
           MOVE LS-ENC-FONC             TO MSTD-PMESS (1).              00400012
           MOVE WS-ENC-EC               TO MSTD-PMESS (2).              00410012
           MOVE 'ST9301'                TO MSTD-NOMESS.                 00420012
           MOVE 'PRIN'                  TO STDER-TYPE-ERREUR.           00430013
           MOVE 'AB'                    TO WS-SORTIE.                   00440011
      *                                                                 00450002
       21100-ENTREE-SERV-ECR-FIN.                                       00460001
           EXIT.                                                        00470000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST2100PB                        STDST2100PB        INL
      * *============================================================*  00010000
      * * 21200     I RECOVERY OF CONTEXT  -  RETURN                 *  00020055
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *    FOLLOWING FUNCTION/SCREEN/SERVICE CALL, THE RETURN      *  00050053
      * *        PROCESSING INDUCES THE RECOVERY OF CONTEXT          *  00060053
      * *       AND OF THE PROGRAM DESCRIPTOR IN PROGRESS            *  00070054
      * *                                                            *  00080000
      * *============================================================*  00090000
       21200-RESTAU-CONTEXTE-PGM       SECTION.                         00100000
      *                                                                 00110000
      * *-------------------SCREEN RETURN, SERVICE RETURN               00120053
      * *                        => RECOVERY OF FUNCTION COMMAREA       00130054
           IF  WS-ENTREE          = 'RE' OR                             00140015
                                  = 'RS'                                00150015
               MOVE LSF-FONC      TO WS-ZONTRAV                         00160049
           END-IF.                                                      00170015
      *                                                                 00180000
      * *-------------------RETRIEVAL OF PROGRAM CONTEXT IN PROGRESS    00190054
           MOVE WS-TS-CTXT-NOM    TO WS-TS-NOM.                         00200049
           MOVE LS-MESS           TO MSTD-MESS.                         00210051
           MOVE LS-TSCO-IND       TO WS-TSCO-ITEM.                      00220051
           MOVE LS-TSDES-IND      TO WS-TSDES-ITEM.                     00230051
           EXEC CICS READQ   TS                                         00240051
                     QUEUE   (WS-TS-ID)                                 00250051
                     INTO    (LS-COMMAREA)                              00260051
                     LENGTH  (WS-LGCOM)                                 00270051
                     ITEM    (LS-TSCO-ITEM)                             00280051
                     NOHANDLE                                           00290051
           END-EXEC.                                                    00300051
      *                                                                 00310051
           PERFORM 90000-CONDERR-TEST.                                  00320051
      *                                                                 00330051
           MOVE MSTD-MESS         TO LS-MESS.                           00340051
           MOVE SPACE             TO MSTD-MESS.                         00350051
           MOVE WS-TSCO-ITEM      TO LS-TSCO-IND.                       00360051
           MOVE WS-TSDES-ITEM     TO LS-TSDES-IND.                      00370051
      *                                                                 00380000
      * *--------------------RETRIEVAL OF SCREEN DESCRIPTOR IN PROGRESS 00390054
           IF  WS-ENTREE      NOT = 'RS'                                00400050
               PERFORM 65200-RESTO-DESCRIPTEUR                          00410041
               MOVE WS-STDP-IND   TO STDP-IND                           00420049
               PERFORM 65250-RESTIT-ATTR                                00430041
           END-IF.                                                      00440020
      *                                                                 00450031
      * *--------------------DELETE TS CONTEXT/DESCRIPTOR IF LEVEL 1    00460054
           IF  LS-TSCO-ITEM        = 1                                  00470041
               PERFORM 90000-ERASE-TSDES                                00480044
               PERFORM 90000-ERASE-TSCTX                                00490044
           END-IF.                                                      00500031
      *                                                                 00510000
      * *--------------------SCREEN RETURN, SERVICE RETURN              00520054
      * *                       => RETRIEVAL OF FUNCTION COMMAREA       00530054
           IF  WS-ENTREE          = 'RE' OR                             00540015
                                  = 'RS'                                00550015
               MOVE WS-ZONTRAV    TO LSF-FONC                           00560049
           END-IF.                                                      00570015
      *                                                                 00580016
           MOVE '1'               TO WS-TOPERMAP.                       00590049
           MOVE LS-ENC-ECET       TO WS-ENC-ECET.                       00600049
           MOVE LS-ENCH-ICOURS    TO MTRA-IND.                          00610049
      *                                                                 00620042
      * *--------------------------RETURN TO CODE HELP                  00630054
           IF  MTRA-STD-ACTNOM (MTRA-IND)                               00640041
                                  = WS-ACTNOM-STPF01                    00650034
               MOVE 'F'           TO  WS-TRAIT-PREF                     00660049
               MOVE WS-ACTNOM-STPF01                                    00670041
                                  TO  WS-TRAIT-NOM                      00680049
           ELSE                                                         00690034
               IF  MTRA-STD-ACTNOM (MTRA-IND)                           00700041
                                  = WS-ACTNOM-AIDK                      00710039
                   MOVE 'F'       TO  WS-TRAIT-PREF                     00720049
                   MOVE WS-ACTNOM-AIDK                                  00730041
                                  TO  WS-TRAIT-NOM                      00740049
               ELSE                                                     00750041
                   MOVE MTRA-TRAIT (MTRA-IND)                           00760041
                                  TO  WS-TRAIT                          00770049
               END-IF                                                   00780041
           END-IF.                                                      00790034
      *                                                                 00800034
           MOVE 'ET'              TO  WS-TRAIT-PILOTE.                  00810049
      *                                                                 00820030
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST2100PC                        STDST2100PC        INL
      * *============================================================*  00010000
      * * 21300     I RETURN AFTER CALLING A STD FUNCTION            *  00020036
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  STANDARD FUNCTIONS INDUCING RETURN PROCESSING ARE :       *  00050036
      * *                                                            *  00060036
      * *                                                            *  00070000
      * *  - CODE HELP, TO TRANSFER THE RESULT PARAMETER (CODE, ...) *  00080036
      * *    IN THE INTERNAL MESSAGE.                                *  00090037
      * *  - UPDATE SCREEN HELP.                                     *  00100037
      * *                                                            *  00110000
      * *============================================================*  00120000
       21300-RETDEBR-FONC-STD          SECTION.                         00130000
           MOVE 'EM'                      TO WS-SORTIE.                 00140013
           MOVE '1'                       TO WS-TOPMDTON-ALL.           00150023
      *                                                                 00160025
           IF  WS-TRAIT-NOM            = WS-ACTNOM-AIDK                 00170025
      *---FORCE UPPERCASE / LOWER CASE  CONVERSION                      00180037
      *        EXEC CICS SET TERMINAL (EIBTRMID)                        00190025
      *                      UCTRAN                                     00200025
      *                      NOHANDLE                                   00210025
      *        END-EXEC                                                 00220025
               IF  WS-TRAIT-RESULTAT                                    00230026
                                   NOT = '01' AND                       00240027
                                   NOT = '99'                           00250027
                   MOVE '11'              TO MSTD-PMESS(1)              00260026
                   MOVE 'ST9104'          TO MSTD-NOMESS                00270026
               END-IF                                                   00280026
               GO TO 21300-RETDEBR-FONC-STD-FIN                         00290025
           END-IF.                                                      00300025
      *                                                                 00310018
           IF  WS-TRAIT-NOM        NOT = WS-ACTNOM-STPF01               00320025
               GO TO 21300-RETDEBR-FONC-STD-FIN                         00330018
           END-IF.                                                      00340018
      *                                                                 00350018
      * *---------------------RETURN WITHOUT SELECTION                  00360037
      *                                                                 00370013
           MOVE WS-TRAIT-PARM             TO WS-CTRLET.                 00380028
      *                                                                 00390034
           IF  WS-CTRLET-INDICE-R  NOT = SPACE                          00400034
               MOVE WS-CTRLET-INDICE      TO WS-POS-CURS                00410034
               PERFORM 65250-RESTIT-ATTR                                00420035
           END-IF.                                                      00430034
      *                                                                 00440034
           IF  WS-TRAIT-RESULTAT  NOT  = '01'                           00450026
               GO TO 21300-RETDEBR-FONC-STD-FIN                         00460013
           END-IF.                                                      00470013
      *                                                                 00480032
      * *---------------------RETURN WITH SELECTION                     00490037
      *                                                                 00500032
           PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL                    00510033
                           WS-IND1 > 3                                  00520033
             IF  WS-CTRLET-PARM (WS-IND1) NOT = SPACE                   00530033
                 MOVE 1                   TO WS-IND2                    00540033
                 SET MSGI-CAR-IND         TO WS-CTRLET-POSCHP (WS-IND1) 00550033
                 PERFORM UNTIL WS-IND2 > WS-CTRLET-LGNCHP (WS-IND1)     00560033
                   MOVE WS-CTRLET-PARM-C (WS-IND1 WS-IND2)              00570033
                                          TO MSGI-CAR (MSGI-CAR-IND)    00580032
                   ADD 1                  TO WS-IND2                    00590033
                   SET MSGI-CAR-IND       UP BY 1                       00600032
                END-PERFORM                                             00610032
             END-IF                                                     00620031
           END-PERFORM.                                                 00630031
      *                                                                 00640000
       21300-RETDEBR-FONC-STD-FIN.                                      00650000
           EXIT.                                                        00660024
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4321LIBR  FADR201 MODFADR201Q%=21400 INL
      *==============================================================*
      * *   I RETURN FROM CALLED FUNCTIONS      GENERATED : 03-12-98 *
      * *============================================================*
       21400-RETDEBR-FONC-USER             SECTION.
      *
           MOVE 'RTOURDEB'     TO STDER-BOITE.
      *
           EXIT.
      *
       21400-RETDEBR-FONC-USER-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 21600     I ACQUISITION MESSAGE ET ACTION UTILISATEUR      *
      * *------------------------------------------------------------*
      * *                                                            *
      * * CE TRAITEMENT ASSURE :                                     *
      * *                                                            *
      * *  - LA LECTURE DU MESSAGE PHYSIQUE                          *
      * *  - LE CONTROLE DE SURFACE DES CHAMPS ET L'ENRICHISSEMENT   *
      * *    DU MEESAGE INTERNE A PARTIR DU MESSAGE PHYSIQUE RECU    *
      * *  - LA DETECTION DE LA COMMANDE UTILISATEUR EVENTUELLE      *
      * *  - LA MEMORISATION DES CHAMPS COMMANDES SI SAISIS          *
      * *  - LA RESTAURATION DES ATTRIBUTS MODIFIES (DESCRIPTEUR)    *
      * *                                                            *
      * *============================================================*
       21600-ACQUIS-MSGACT          SECTION.
           PERFORM 21610-LECT-MESPHY.
           PERFORM 21620-ELAB-MESINT.
           PERFORM 21630-DET-COMMANDE.
           PERFORM 21640-RECEPT-CMDE-USER.
           EJECT
      *$XINCLUDE ZSTDST2100PF                        STDST2100PF        INL
      * *============================================================*  00010000
      * * 21610     I READING PHYSICAL MESSAGE                       *  00020029
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  THIS FUNCTION :                                           *  00050029
      * *  - READS THE PHYSICAL MESSAGE TRANSMITTED VIA BMS          *  00060029
      * *   (RECEIVE CICS),                                          *  00061029
      * *  - DETECTS THE FUNCTION KEY (FK) ACTIVATED BY THE          *  00070030
      * *    OPERATOR,                                               *  00080029
      * *  - INTERCEPTS MAPFAIL, IF HAPPENS                          *  00090029
      * *============================================================*  00110000
       21610-LECT-MESPHY               SECTION.                         00120002
           MOVE WS-ENC-ECET      TO WS-ENC-ECET-INI.                    00130021
      *                                                                 00140021
           PERFORM  VARYING  STDP-IND  FROM 1 BY 1                      00150006
                      UNTIL  STDP-IND  >  STDP-NBMAX                    00160006
             IF STDP-NUMECR (STDP-IND)  =  WS-ENC-EC                    00170013
                GO TO  21610-LECT-MESPHY-1                              00180013
             END-IF                                                     00190013
           END-PERFORM.                                                 00200006
      *                                                                 00210028
           MOVE WS-ENC-EC        TO MSTD-PMESS (1).                     00220013
           MOVE 'ST9103'         TO MSTD-NOMESS.                        00230013
           MOVE 'AB'             TO WS-SORTIE.                          00240013
           MOVE 'PRIN'           TO STDER-TYPE-ERREUR.                  00250017
           PERFORM 30000-TRAIT-SORTIE.                                  00260013
      *                                                                 00270028
       21610-LECT-MESPHY-1.                                             00280006
           IF  STDP-MAP (STDP-IND) = 'AIDC04M'                          00290023
               MOVE LENGTH OF WS-ZONTRAV    TO WS-ZONRECB-LONG          00300028
               MOVE ACCEPT-ERR-OUI          TO ACCEPT-LENGERR           00310028
               EXEC CICS RECEIVE INTO   (WS-ZONTRAV)                    00320028
                                 LENGTH (WS-ZONRECB-LONG)               00330028
                                 ASIS                                   00340028
                                 NOHANDLE                               00350028
               END-EXEC                                                 00360028
               PERFORM 90000-CONDERR-TEST                               00370028
           END-IF.                                                      00380028
      *                                                                 00390028
           MOVE ACCEPT-ERR-OUI   TO ACCEPT-MAPFAIL.                     00400013
      * *------------------------READING PHYSICAL MESSAGE               00410029
           IF  STDP-MAP (STDP-IND) = 'AIDC04M'                          00420023
               EXEC CICS RECEIVE MAP  (STDP-MAP (STDP-IND))             00430027
                                 INTO (STDMSP-MSP)                      00440027
                                 FROM (WS-ZONTRAV)                      00450027
                                 NOHANDLE                               00460027
               END-EXEC                                                 00470027
           ELSE                                                         00480023
               EXEC CICS RECEIVE MAP  (STDP-MAP (STDP-IND))             00490027
                                 INTO (STDMSP-MSP)                      00500027
                                 NOHANDLE                               00510027
               END-EXEC                                                 00520027
           END-IF.                                                      00530027
           PERFORM 90000-CONDERR-TEST.                                  00540009
           IF MAPFAIL                                                   00550000
              MOVE LOW-VALUE     TO STDMSP-MSP.                         00560013
                                                                        00570015
      * *------------------------FUNCTION KEY DETECTION                 00580031
                                                                        00590014
           EVALUATE EIBAID                                              00600014
               WHEN DFHENTER                                            00610014
                   MOVE        'EN' TO WS-TF                            00620020
               WHEN DFHPF1                                              00630014
                   MOVE        '01' TO WS-TF                            00640020
               WHEN DFHPF2                                              00650014
                   MOVE        '02' TO WS-TF                            00660020
               WHEN DFHPF3                                              00670014
                   MOVE        '03' TO WS-TF                            00680020
               WHEN DFHPF4                                              00690014
                   MOVE        '04' TO WS-TF                            00700020
               WHEN DFHPF5                                              00710014
                   MOVE        '05' TO WS-TF                            00720020
               WHEN DFHPF6                                              00730014
                   MOVE        '06' TO WS-TF                            00740020
               WHEN DFHPF7                                              00750014
                   MOVE        '07' TO WS-TF                            00760020
               WHEN DFHPF8                                              00770014
                   MOVE        '08' TO WS-TF                            00780020
               WHEN DFHPF9                                              00790014
                   MOVE        '09' TO WS-TF                            00800020
               WHEN DFHPF10                                             00810014
                   MOVE        '10' TO WS-TF                            00820020
               WHEN DFHPF11                                             00830014
                   MOVE        '11' TO WS-TF                            00840020
               WHEN DFHPF12                                             00850014
                   MOVE        '12' TO WS-TF                            00860020
               WHEN DFHPF13                                             00870014
                   MOVE        '13' TO WS-TF                            00880020
               WHEN DFHPF14                                             00890014
                   MOVE        '14' TO WS-TF                            00900020
               WHEN DFHPF15                                             00910014
                   MOVE        '15' TO WS-TF                            00920020
               WHEN DFHPF16                                             00930014
                   MOVE        '16' TO WS-TF                            00940020
               WHEN DFHPF17                                             00950014
                   MOVE        '17' TO WS-TF                            00960020
               WHEN DFHPF18                                             00970014
                   MOVE        '18' TO WS-TF                            00980020
               WHEN DFHPF19                                             00990014
                   MOVE        '19' TO WS-TF                            01000020
               WHEN DFHPF20                                             01010014
                   MOVE        '20' TO WS-TF                            01020020
               WHEN DFHPF21                                             01030014
                   MOVE        '21' TO WS-TF                            01040020
               WHEN DFHPF22                                             01050014
                   MOVE        '22' TO WS-TF                            01060020
               WHEN DFHPF23                                             01070014
                   MOVE        '23' TO WS-TF                            01080020
               WHEN DFHPF24                                             01090014
                   MOVE        '24' TO WS-TF                            01100020
               WHEN DFHCLEAR                                            01110014
                   MOVE        'ER' TO WS-TF                            01120020
                   MOVE        '1'  TO WS-TOPERMAP                      01130020
               WHEN DFHPA1                                              01140014
                   MOVE        'A1' TO WS-TF                            01150020
               WHEN DFHPA2                                              01160014
                   MOVE        'A2' TO WS-TF                            01170020
               WHEN DFHPA3                                              01180014
                   MOVE        'A3' TO WS-TF                            01190020
           END-EVALUATE.                                                01200014
                                                                        01210015
      * *------------------------MEMORIZE CURSOR POSITION               01220029
                                                                        01230015
           MOVE EIBCPOSN         TO WS-CURSEUR-POS.                     01240007
           DIVIDE 80 INTO           WS-CURSEUR-POS                      01250004
                     GIVING         WS-CURSEUR-LIG                      01260004
                     REMAINDER      WS-CURSEUR-COL.                     01270004
           ADD    +2             TO WS-CURSEUR-LIG.                     01280022
           ADD    +1             TO WS-CURSEUR-COL.                     01290022
                                                                        01300015
       21610-LECTMAP-CICS-FIN.                                          01310002
           EXIT.                                                        01320000
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 PROC  4331LIBR  FADR201 STDFADR201R%=21620 INL
      * *============================================================*
      * *   I FORM THE INTERNAL MESSAGE         GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS FUNCTION PROCESSES (VIA A GENERAL MODULE) THE         *
      * * TRANSFORMATION OF THE READ PHYSICAL MESSAGE INTO AN        *
      * * INTERNAL FORMAT MESSAGE. MOREOVER, IT CONTROLS ENTERED     *
      * * FIELDS AND SEND ERRORS.                                    *
      * *                                                            *
      * *============================================================*
       21620-ELAB-MESINT                   SECTION.
      *
           IF  WS-ENC-EC  = '01'
               MOVE WAAPIV          TO DSC-STD-ANPIVOT
                                    OF ADR201-MDSC
      *$         CALL 'ST50CICS'      USING DFHEIBLK
      *$                                    DFHCOMMAREA
      *$                                    STDMSP-IN
      *$                                    STDMSP-MSP
      *$                                    ADR201-MSGI
      *$                                    ADR201-MDSC
      *$                                    STDMSP-ZTRAV
      *$                                    STDMSP-VARIABLES
      *$                                    DFHCOMMAREA
           ELSE
               NEXT SENTENCE.
      *
       21620-ELAB-MESINT-FIN.
           EXIT.
      *$XENDINCLUDE
      *
      *$XINCLUDE XGENFADR201 PROC  4342LIBR  FADR201 STDFADR201S%=21630 INL
      * *============================================================*
      * *           I DETECT COMMANDS           GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS FUNCTION RECOGNIZES USER'S ACTION :                   *
      * *                    THE ACTIVATED FUNCTION KEY,             *
      * *                    THE POSSIBLE COMMAND (VERIFIED)         *
      * *                                                            *
      * *============================================================*
       21630-DET-COMMANDE                  SECTION.
      *
           MOVE  SPACE        TO WS-CMDE
           MOVE  ZERO         TO WS-DET-NUMLIG.
      *
       21630-DET-COMMANDE-FIN.
           EXIT.
      *$XENDINCLUDE
      *
      *$XINCLUDE ZSTDST2100PG                        STDST2100PG        INL
      * *============================================================*  00010011
      * * 21640     I RECEPTION OF ENTERED INT/EXT COMMANDS          *  00020024
      * *------------------------------------------------------------*  00030011
      * *                                                            *  00040011
      * *  THIS FUNCTION PROCESSES RECEPTION OF INTERNAL/EXTERNAL    *  00050024
      * *  COMMANDS ENTERED BY THE OPERATOR.                         *  00060024
      * *                                                            *  00070011
      * *============================================================*  00080011
       21640-RECEPT-CMDE-USER      SECTION.                             00090011
           IF STDMSP-V-2-MAJ       = MODIF OR                           00100023
                                   = IDEM                               00110023
              MOVE STDMSP-V-2-VALEUR TO WS-FONCSVT-IDOPE                00120014
           END-IF.                                                      00130014
      *                                                                 00140021
           IF STDMSP-V-1-MAJ       = MODIF OR                           00150023
                                   = IDEM                               00160023
              MOVE STDMSP-V-1-VALEUR TO WS-FONCSVT-ARGUM                00170015
           END-IF.                                                      00180014
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST2100PH                        STDST2100PH        INL
      * *============================================================*  00010043
      * * 21700     I SEARCH FOR ACTION                              *  00020067
      * *------------------------------------------------------------*  00030043
      * *                                                            *  00040043
      * *  USER'S ACTION (FUNCTION KEY + COMMAND) CAN BE FOUND IN    *  00050068
      * *  TRANSITION MATRIX, AND POSSIBLY IN INTERFUNCTION          *  00060066
      * *  CHAINING TABLE.                                           *  00070066
      * *                                                            *  00080043
      * *------------------------------------------------------------*  00090043
      * * POSSIBLE RESULTS :                                         *  00100066
      * *  .OK     --> GO ON PROCESSING                              *  00110066
      * *  .ERROR  --> DISPLAY ERROR MESSAGE                         *  00120066
      * *============================================================*  00130043
       21700-RECH-ACTION               SECTION.                         00140043
           MOVE 1                            TO MTRA-IND.               00150046
      *                                                                 00160055
       21700-RECH-LIG-MATR.                                             00170043
           IF  MTRA-IND > MTRA-NBMAX                                    00180043
               GO TO 21700-RECH-ACTION-KO.                              00190043
      *                                                                 00200043
           IF  MTRA-ECET (MTRA-IND) NOT = WS-ENC-ECET                   00210051
               ADD 1                         TO MTRA-IND                00220043
               GO TO 21700-RECH-LIG-MATR.                               00230043
      *                                                                 00240043
           IF  MTRA-CODACT (MTRA-IND)   = WS-CODACT                     00250060
               GO TO 21700-RECH-ACTION-OK.                              00260043
      *                                                                 00270060
           IF  WS-TF                NOT = SPACE   AND                   00280062
              (MTRA-TF   (MTRA-IND)     = '? ' OR ' ?' OR '??')         00290062
               SET WS-TABLETF-IND            TO 1                       00300060
               SEARCH WS-TABLETF-LIGNE                                  00310060
                 AT END                                                 00320060
                    CONTINUE                                            00330065
                 WHEN WS-TABLETF-ID   (WS-TABLETF-IND)                  00340063
                                        = WS-TF   AND                   00350063
                      WS-TABLETF-FONC (WS-TABLETF-IND)                  00360063
                                    NOT = STDP-NOM-FONC                 00370063
                    MOVE WS-TABLETF-FONC (WS-TABLETF-IND)               00380060
                                             TO WS-FONCSVT-IDOPE        00390060
                    GO TO 21700-RECH-ACTION-OK2                         00400062
           END-IF.                                                      00410062
      *                                                                 00420043
           ADD 1                             TO MTRA-IND.               00430043
           GO TO 21700-RECH-LIG-MATR.                                   00440043
      *                                                                 00450043
      *----------------------------ACTION FOUND IN MATRIX               00460066
      *                                                                 00470043
       21700-RECH-ACTION-OK.                                            00480043
           IF  WS-TF                NOT = SPACE   AND                   00490062
               WS-TABLETF           NOT = SPACE                         00500062
               SET WS-TABLETF-IND            TO 1                       00510060
               SEARCH WS-TABLETF-LIGNE                                  00520060
                 AT END                                                 00530060
                    CONTINUE                                            00540061
                 WHEN WS-TABLETF-ID   (WS-TABLETF-IND)                  00550064
                                        = WS-TF   AND                   00560063
                      WS-TABLETF-FONC (WS-TABLETF-IND)                  00570063
                                    NOT = STDP-NOM-FONC                 00580063
                    MOVE WS-TABLETF-FONC (WS-TABLETF-IND)               00590060
                                             TO WS-FONCSVT-IDOPE        00600062
           END-IF.                                                      00610062
      *                                                                 00620060
       21700-RECH-ACTION-OK2.                                           00630062
           MOVE MTRA-TRAIT (MTRA-IND)        TO WS-TRAIT.               00640046
           MOVE 'ET'                         TO WS-TRAIT-PILOTE.        00650053
           PERFORM 60000-GESTION-ACTION.                                00660043
           GO TO 21700-RECH-ACTION-FIN.                                 00670043
      *                                                                 00680043
      *----------------------------ACTION NOT FOUND IN MATRIX           00690066
      *                                                                 00700043
       21700-RECH-ACTION-KO.                                            00710043
           MOVE '1'                          TO WS-TOPMDTON.            00720059
           MOVE WS-TF                        TO MSTD-PMESS (1).         00730056
           MOVE 'ST9104'                     TO MSTD-NOMESS.            00740058
           MOVE 'EM'                         TO WS-SORTIE.              00750043
      *                                                                 00760043
       21700-RECH-ACTION-FIN.                                           00770043
           EXIT.                                                        00780043
      *                                                                 00790043
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4333LIBR  FADR201 STDFADR201£%=21800 INL
      * *============================================================*
      * *    I ANALYSE MESSAGE DESCRIPTOR       GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS FUNCTION ANALYSES MAPPING RESULT VIA THE DESCRIPTOR   *
      * * ASSOCIATED TO RECEIVED MESSAGE, AND DETECTS POSSIBLE       *
      * * INPUT ERRORS.                                              *
      * *                                                            *
      * * THIS FUNCTION STORES PARAMETERS RELATIVE TO HELP FOR       *
      * * CODING REQUESTED FOR A FIELD.                              *
      * *                                                            *
      * *============================================================*
       21800-ANAL-DESCRIPTEUR              SECTION.
      *
           IF  WS-ENC-EC  NOT = '01'
               GO TO    21800-ANAL-DSC-01-FINGEN.
      *
           COMPUTE WS-CURSEUR-LIG = WS-CURSEUR-LIG -
                            DSC-DBM-LIGNE OF ADR201-MDSC.
           COMPUTE WS-CURSEUR-COL = WS-CURSEUR-COL -
                            DSC-DBM-COLONNE OF ADR201-MDSC.
      *
           PERFORM 21800-ANAL-DSC-01
           VARYING MDSC-IND-CHP FROM  1 BY 1
             UNTIL MDSC-IND-CHP >     DSC-EN-NBCHPS OF ADR201-MDSC.
      *
           IF  WS-CTRLET-INDICE-R NOT = SPACE
      *                 REQUESTED HELP FOR COFING
               MOVE  '?'               TO WS-CTRLET-APPEL
               MOVE  SPACE             TO WS-CTRLET-CDERR
               MOVE  SPACE             TO MSTD-NOMESS
               MOVE  DSC-RDF-POS       OF ADR201-MDSC (WS-CTRLET-INDICE)
                                       TO WS-CTRLET-POSCHP (1)
               MOVE  DSC-RDF-LGN       OF ADR201-MDSC (WS-CTRLET-INDICE)
                                       TO WS-CTRLET-LGNCHP (1)
               MOVE  DSC-RDF-TABCTRL   OF ADR201-MDSC (WS-CTRLET-INDICE)
                                       TO WS-CTRLET-TABCTRL (1)
               MOVE  DSC-RDF-NOM       OF ADR201-MDSC (WS-CTRLET-INDICE)
                                       TO WS-AIDC-NOM-CHP
               MOVE  CHPBI-NOM-VALEURS OF ADR201-CHPBI
                                       TO CHPBI-NOM-TABLE
               PERFORM 60000-RECH-NOM-BI
               MOVE  WS-AIDC-NOM-BI    TO WS-CTRLET-NOM-BI (1)
               MOVE  DSC-RDF-ATTRIBUT  OF DSC-RDF-DESCRIPTION
                                       OF ADR201-MDSC (WS-CTRLET-INDICE)
                                       TO WS-CTRLET-ATTRIBUT-INI (1)
               MOVE  WS-DSC-ATTRIBUT (WS-CTRLET-INDICE)
                                       TO WS-CTRLET-ATTRIBUT-MOD (1)
               IF  LIEN-CHP-NBMAX      OF ADR201-LIENS
                                  NOT = ZERO
                   MOVE LIEN-CHP-VALEURS
                                       OF ADR201-LIENS
                                       TO WS-LIEN-CHP-TABLE
                   PERFORM 60000-ALIM-CHP-LIEN
               END-IF
               MOVE  SPACE             TO WS-SORTIE.
      *
           GO TO   21800-ANAL-DESCRIPTEUR-FIN.
      *
       21800-ANAL-DSC-01.
      *
           IF  DSC-RDF-NOLIG OF ADR201-MDSC (MDSC-IND-CHP)
                             = WS-CURSEUR-LIG
               ADD  DSC-RDF-NOCOL OF ADR201-MDSC (MDSC-IND-CHP)
                    DSC-RDF-LGN   OF ADR201-MDSC (MDSC-IND-CHP)
                    GIVING WS-CHAMP-COLFIN
               IF  DSC-RDF-NOCOL OF ADR201-MDSC (MDSC-IND-CHP)
                                 NOT > WS-CURSEUR-COL
               AND WS-CURSEUR-COL < WS-CHAMP-COLFIN
                   MOVE CURSEUR TO
                     DSC-RDF-CURSEUR-IN OF ADR201-MDSC (MDSC-IND-CHP).
      *
           IF  WS-CTRLET-CDERR = SPACE
           IF  MTRA-STD-ACTNOM (MTRA-IND)
                           NOT = WS-ACTNOM-STPF01
                           AND NOT = WS-ACTNOM-AIDK
           IF  DSC-RDF-ERREUR OF ADR201-MDSC (MDSC-IND-CHP) NOT = SPACE
               MOVE  DSC-RDF-ERREUR OF ADR201-MDSC (MDSC-IND-CHP)
                                    TO  MSTD-NOMESS-NUM-F
               MOVE  '9999'         TO  MSTD-NOMESS-FONC
               MOVE  '1'            TO  WS-CTRLET-CDERR
               MOVE  'EM'           TO  WS-SORTIE.
      *
           IF  DSC-RDF-CURSEUR-IN OF ADR201-MDSC (MDSC-IND-CHP)
                                   = CURSEUR
           IF  MTRA-STD-ACTNOM (MTRA-IND)
                                   = WS-ACTNOM-STPF01
                                   OR = WS-ACTNOM-AIDK
               MOVE MDSC-IND-CHP    TO  WS-CTRLET-INDICE.
      *
       21800-ANAL-DSC-01-FINGEN.
      *
           EXIT.
      *
       21800-ANAL-DESCRIPTEUR-FIN.
      *
           EXIT.
      *
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4334LIBR  FADR201 MODFADR201$%=21900 INL
      * *============================================================*
      * *    I FORMAT AND CALL PTE ARMIDE                 : 03-12-98 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS FUNCTION PREPARES FORMATTING OF NECESSARY DATA FOR    *
      * * PTE ARMIDE EXECUTION, IT CALLS ARMIDE AND CONTROLS         *
      * * THE RESPONSE.                                              *
      * *                                                            *
      * *============================================================*
       21900-APPEL-PTEARMIDE               SECTION.
      *
           MOVE 'MEFPTE'       TO STDER-BOITE.
      *
           IF  WS-ENC-EC  NOT = '01'
               GO TO    21900-APPEL-PTEARMIDE-01-FGEN.
      *
      * UPDATED FOR TBEN BY MT 05.07.2000 ***
      *    IF  STDP-PTEARMIDE (STDP-IND)     = SPACE    OR
           IF  STDP-PTEARMIDE (STDP-IND)     =
                                               LOW-VALUE
               GO TO    21900-APPEL-PTEARMIDE-FIN.
      * END OF UPDATE BY MT


      * UPDATED FOR TBEN BY MT 05.07.2000 ***

           PERFORM  60000-INITIAL-ARMIDE.

           MOVE ALL '/'               TO SDT-SD-ADR201.
           SET  ARM-VALIDATION-ECRAN  TO TRUE.

           MOVE E-CPAYSBEN          TO SDT-RB-CPAYSBEN.

           MOVE 'PT'                TO ARM-FONCTION.
           MOVE 'PT'                TO ARM-TYPE-OBJ.
           MOVE 'ADR201'            TO ARM-NOM-OBJ.
           MOVE 'ADR201'            TO ARM-NOM-SDT.
           MOVE SDT-SD-ADR201       TO ARM-SDT.


       21900-ETAPE-SUIVANTE-PTE.


           EXEC CICS HANDLE ABEND
                     CANCEL
           END-EXEC.

           CALL ARM-NOMSPRGTP USING DFHEIBLK
                                    DFHCOMMAREA
                                    ARM-COMMAREA.

           EXEC CICS HANDLE ABEND
                     RESET
           END-EXEC.

           IF  ARM-ABEND  OR  ARM-PROBLEME
               MOVE SPACE                 TO STDER-TYPE-ERREUR
               MOVE 'AB'                  TO WS-SORTIE
               PERFORM 30000-TRAIT-SORTIE
           END-IF.

           MOVE ARM-SDT             TO SDT-SD-ADR201.

           IF  ARM-PTE-STOPPEE
               EVALUATE  TRUE
      *           WHEN  ARM-ARRET-PTE
                  WHEN  ARM-DERNIER-STEP-PTE
                     IF ARM-NOM-OBJ = 'CPAYSBEN'
                       MOVE 'CLI241'   TO   MSTD-NOMESS
                       MOVE 'ER'       TO   CPAYSBEN-ERREUR
                       MOVE 'EM'       TO   WS-SORTIE
                     END-IF

               END-EVALUATE
           END-IF.

      *---> SI REJET DE LA PTE ON FAIT VALIDER LE REJET
      *     ( ON EVITE AINSI LA CONFUSION ENTRE LES MESSAGES ET LA
      *       POSITION DU CURSEUR)

      *    IF   MSTD-NOMESS  NOT = SPACE
      *         GO TO   21900-APPEL-PTEARMIDE-FIN
      *    END-IF.



      *    IF   SDT-RB-NIVDECIS NOT = 'C'
      *         MOVE 'CLI147'   TO   MSTD-NOMESS
      *         MOVE 'ER'       TO   CPFCPOSA-ERREUR
      *         MOVE 'EM'       TO   WS-SORTIE
      *    END-IF.

      * END OF UPDATE BY MT
      *
           GO TO   21900-APPEL-PTEARMIDE-FIN.
      *
       21900-APPEL-PTEARMIDE-01-FGEN.
      *
           EXIT.
      *
       21900-APPEL-PTEARMIDE-FIN.
      *
           EXIT.
      *
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 22000     I EXECUTION DU TRAITEMENT SELECTIONNE            *
      * *------------------------------------------------------------*
      * *                                                            *
      * * CE TRAITEMENT :                                            *
      * *   -ACTIVE L'EXECUTION DU STANDARD POUR UNE TRANSITION      *
      * *    TRAITEE PAR UN STANDARD                                 *
      * *   -RECHERCHE SI LA TRANSITION REFERENCE UNE TACHE          *
      * *    ET EN ASSURE L'ACTIVATION                               *
      * *   -ANALYSE LE RESULTAT DU TRAITEMENT EXECUTE POUR          *
      * *    DETERMINER LA NOUVELLE TRANSITION.                      *
      * *                                                            *
      * *============================================================*
       22000-EXEC-TRAITEMENT        SECTION.
           IF WS-TRAIT-PILOTE   NOT = 'ET'  OR
              WS-SORTIE         NOT = SPACE
              GO TO  22000-EXEC-TRAITEMENT-FIN
           END-IF.
      *
           MOVE 'N'           TO WS-TR-IND.
      *
           IF  MTRA-TYPE-TRANSIT (MTRA-IND) = 'S'
               PERFORM 84000-EXEC-ACTION-STANDARD
               GO TO 22000-EXEC-TRAITEMENT-FIN
           END-IF.
      *
           IF  MTRA-TRAIT-PREF (MTRA-IND)   = 'T'
               MOVE SPACE     TO WS-TRAIT-RESULTAT
               PERFORM 22200-ACTIV-TACHE
               MOVE '1'       TO WS-TR-IND
               GO TO 22000-EXEC-RESULT
           END-IF.
      *
           IF  MTRA-TRAIT-PREF (MTRA-IND)   = ' '
               MOVE SPACE     TO WS-TRAIT-RESULTAT
               MOVE '1'       TO WS-TR-IND
               GO TO 22000-EXEC-RESULT
           END-IF.
      *
           IF  MTRA-TRAIT-PREF (MTRA-IND)   = 'F'
               IF  WS-ENTREE = 'RF'
                   MOVE '1'   TO WS-TR-IND
                   GO TO 22000-EXEC-RESULT
               ELSE
                   MOVE 'AF'  TO WS-SORTIE
                   GO TO 22000-EXEC-TRAITEMENT-FIN
               END-IF
           END-IF.
      *
           IF  MTRA-TRAIT-PREF (MTRA-IND)   = 'E'
               IF  WS-ENTREE = 'RE'
                   MOVE '1'   TO WS-TR-IND
                   GO TO 22000-EXEC-RESULT
               ELSE
                   MOVE 'AE'  TO WS-SORTIE
                   GO TO 22000-EXEC-TRAITEMENT-FIN
               END-IF
           END-IF.
      *
           IF  MTRA-TRAIT-PREF (MTRA-IND)   = 'S'
               IF  WS-ENTREE = 'RS'
                   MOVE '1'   TO WS-TR-IND
                   GO TO 22000-EXEC-RESULT
               ELSE
                   MOVE 'AS'  TO WS-SORTIE
                   GO TO 22000-EXEC-TRAITEMENT-FIN
               END-IF
           END-IF.
      *
       22000-EXEC-RESULT.
           IF  WS-SORTIE                    = SPACE   AND
               WS-TR-IND                    = '1'     AND
              (STDER-TYPE-ERREUR            = SPACE   OR
               STDER-TYPE-ERREUR            = 'STAT'  OR
               STDER-TYPE-ERREUR            = 'APPL')
               PERFORM 22300-RECH-TRANSITION
           END-IF.
      *
       22000-EXEC-TRAITEMENT-FIN.
           EXIT.
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4371LIBR  FADR201 STDFADR201T%=22200 INL
      * *============================================================*
      * *           I ACTIVATE TASKS            GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS FUNCTION ACTIVATES THE TASK ASSOCIATED TO USER'S      *
      * * ACTION (FK, CMD).                                          *
      * *                                                            *
      * *============================================================*
       22200-ACTIV-TACHE                   SECTION.
      *
           IF  WS-ENC-EC  = '00' AND MTRA-TRAIT-NOM1 (MTRA-IND)  = '01'
               PERFORM 22200-TACHE-ADR20001
               GO TO   22200-ACTIV-TACHE-FIN.
      *
           IF  WS-ENC-EC  = '01' AND MTRA-TRAIT-NOM1 (MTRA-IND)  = '01'
               PERFORM 22200-TACHE-ADR20101
               GO TO   22200-ACTIV-TACHE-FIN.
      *
       22200-ACTIV-TACHE-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  6311LIBR  ADR20001MODADR20001%=22200 INL
      * *==============================================================*
      * *         I EXECUTION OF TASK ADR20001       GEN. : 03-12-98   *
      * *--------------------------------------------------------------*
      * *                                                              *
      * * DETECTION RECEPTION PARAMETRES                               *
      * *                                                              *
      * *--------------------------------------------------------------*
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *==============================================================*
       22200-TACHE-ADR20001                SECTION.
      *
           MOVE 'ADR20001'       TO STDER-BOITE.
      *
      * *--------------------------------------------------------------*
      * * TASK'S RESULTS  (TO POSITION IN THE PROCESSING)              *
      * *--------------------------------------------------------------*
      * * 01  :  PARAMET. RECUS                                        *
      * * 02  :  PARAMET. ABSENTS                                      *
      * *--------------------------------------------------------------*
      *
           IF  TCLINFOY = 0 OR TCLINFOY NOT NUMERIC
               MOVE '02' TO WS-TRAIT-RESULTAT
               GO TO  22200-TACHE-ADR20001-FIN
           END-IF.


      * *------------------------------------------------------------*
      * *           SELECT D'UNE LIGNE DE LA TABLE TBADRES
      * *------------------------------------------------------------*
           MOVE COM-PRNSOC        TO LSP-SOC
           MOVE TCLINFOY       TO LSP-FOYER
           MOVE TCLILNOMPREN   TO LSP-NOMPREN1
           SET  LSP-ADR-FOUND  TO  TRUE.
           INITIALIZE DCLTBADRES.
           MOVE  TCLINFOY  TO  TADRNFOY.
       SELECT-TBADRES.
           EXEC SQL
                SELECT   TADRNFOY
                      ,  TADRCTYPE
                      ,  TADRLVBEA
                      ,  TADRLADRE
                      ,  TADRCPTT
                      ,  TADRLVILL
                      ,  TADRLLOCACH
                      ,  TADRCPAYS
                      ,  TADRLPAYS
                 INTO   :TADRNFOY
                      , :TADRCTYPE
                      , :TADRLVBEA
                      , :TADRLADRE
                      , :TADRCPTT
                      , :TADRLVILL
                      , :TADRLLOCACH
                      , :TADRCPAYS
                      , :TADRLPAYS
                FROM  TBADRES
                WHERE TADRNFOY  = :TADRNFOY
                  AND TADRCTYPE = 'AD'
           END-EXEC.
      *UPDATED FOR TBEN BY CK 25.07.2000
      *-> APPEL ARMIDE AFIN DE DETERMINER LE NOM DU PAYS UTILISE PAR DEFAUT
      *   POUR SOCIETE 106 ET 103
           MOVE SPACE TO WSTR-CPTT-TMP
           EVALUATE TRUE
               WHEN SQLCODE = 100
                 SET  LSP-ADR-NOT-FOUND    TO     TRUE
                 EVALUATE LSP-SOC
                   WHEN 106
                      MOVE '2'          TO WSTR-CPTT11-TMP
                      MOVE 135          TO  TADRCPAYS
                   WHEN 116
                      MOVE '2'          TO WSTR-CPTT11-TMP
                      MOVE 135          TO  TADRCPAYS
                   WHEN 103
                      MOVE '0'          TO WSTR-CPTT11-TMP
                      MOVE 131          TO  TADRCPAYS
                   WHEN 113
                      MOVE '0'          TO WSTR-CPTT11-TMP
                      MOVE 131          TO  TADRCPAYS
                 END-EVALUATE
                 MOVE WSTR-CPTT-TMP  TO  TADRCPTT

                 PERFORM 60000-INITIAL-ARMIDE

                 MOVE TADRCPAYS      TO ARM-VALEUR-MINI
                 MOVE 'DE'            TO ARM-FONCTION
                 MOVE 'RB'            TO ARM-TYPE-OBJ
                 MOVE 'CPAYS'         TO ARM-NOM-OBJ
                 MOVE SPACE           TO ARM-NOM-SDT
                 EXEC CICS HANDLE ABEND
                          CANCEL
                 END-EXEC

                 CALL ARM-NOMSPRGTP USING DFHEIBLK
                                         DFHCOMMAREA
                                         ARM-COMMAREA

                 EXEC CICS HANDLE ABEND
                      RESET
                 END-EXEC

                 IF ARM-ABEND OR ARM-PROBLEME
                    MOVE SPACE       TO STDER-TYPE-ERREUR
                    MOVE 'AB'        TO WS-SORTIE
                    PERFORM 30000-TRAIT-SORTIE
                 END-IF

                 IF  ARM-NON-TROUVE
                     MOVE 'CLI179'   TO   MSTD-NOMESS
                     MOVE 'ER'       TO   ADRCPAYS-ERREUR
                     MOVE '08'       TO   WS-TRAIT-RESULTAT
                     GO  TO  22200-TACHE-ADR20001-FIN
                  ELSE
                     MOVE ARM-LIBELLE1-RUBRIQUE (1) TO TADRLPAYS
                 END-IF
      *          MOVE  100       TO  TADRCPAYS
      *          MOVE  'FRANCE'  TO  TADRLPAYS
      *END OF UPDATE BY CK
               WHEN SQLCODE < ZERO
                    MOVE 'SELECT TBADRES'  TO STDER-MESSAGE
                    MOVE TADRNFOY            TO ZADRNFOY
                    MOVE TADRCTYPE           TO ZADRCTYPE
                    MOVE ZTBADRES            TO STDER-DB2-CLE
                    MOVE 'TBADRES'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.
           MOVE  TADRLVBEA         TO LSP-ADRLVBEA.
           MOVE  TADRLADRE         TO LSP-ADRLADRE.
           MOVE  TADRCPTT          TO LSP-ADRCPTT.
           MOVE  TADRLVILL         TO LSP-ADRLVILL.
           MOVE  TADRCPAYS         TO LSP-ADRCPAYS.
           MOVE  TADRLPAYS         TO LSP-ADRLPAYS.


           MOVE '01' TO WS-TRAIT-RESULTAT.
      *
      * *--------------------------------------------------------------*
      *
      *
      *             INSERT HERE TASK'S PROCESSINGS
      *                 (CONTROL, UPDATE, ...)
      *
      *
       22200-TACHE-ADR20001-FIN.
           EXIT.
      *$XENDINCLUDE
      *$XINCLUDE XGENFADR201 PROC  6311LIBR  ADR20101MODADR20101%=22200 INL
      * *==============================================================*
      * *         I EXECUTION OF TASK ADR20101       GEN. : 08-12-98   *
      * *--------------------------------------------------------------*
      * *                                                              *
      * * CONTROLE DONNEES SAISIES ET MAJ                              *
      * *                                                              *
      * *--------------------------------------------------------------*
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *                                                              *
      * *==============================================================*
       22200-TACHE-ADR20101                SECTION.
      *
           MOVE 'ADR20101'       TO STDER-BOITE.
      *
      * *--------------------------------------------------------------*
      * * TASK'S RESULTS  (TO POSITION IN THE PROCESSING)              *
      * *--------------------------------------------------------------*
      * * 01  :  SAISIE MAJ OK                                         *
      * * 08  :  ERREUR SAISIE                                         *
      * *--------------------------------------------------------------*
      *

            PERFORM  22200-RECEIVE-DATA
                     THRU  22200-RECEIVE-DATA-FIN.
            MOVE  E-ACTION  TO  LSP-ACTION.
            EVALUATE TRUE
             WHEN LSP-ACTION = 'D' AND LSP-ADR-NOT-FOUND
                MOVE '08'       TO   WS-TRAIT-RESULTAT
                MOVE 'ADR203'   TO   MSTD-NOMESS
                MOVE 'ER'       TO   ACTION-ERREUR
                GO  TO  22200-TACHE-ADR20101-FIN
             WHEN LSP-ACTION = 'D'
                SET ZCOM-DELETE TO TRUE
                GO TO  22200-TRAITEMENT-ACTION
             WHEN LSP-ACTION = ' ' AND LSP-ADR-NOT-FOUND
                SET ZCOM-CREATE TO TRUE
             WHEN LSP-ACTION = ' '
                SET ZCOM-MODIFY TO TRUE
             WHEN OTHER
                MOVE '08'       TO   WS-TRAIT-RESULTAT
                MOVE 'ADR204'   TO   MSTD-NOMESS
                MOVE 'ER'       TO   ACTION-ERREUR
                GO  TO  22200-TACHE-ADR20101-FIN
             END-EVALUATE.

      *UPDATED FOR TBEN BY CK 25.07.2000
              IF E-CPAYSBEN = 'NL'
                 MOVE UNPR     TO  CQUART-ATTRIBUT
              ELSE
                 MOVE PROT-DRK TO  CQUART-ATTRIBUT
                 MOVE SPACE    TO  E-CQUART
              END-IF
      *END OF UPDATE BY CK
              IF E-ADRLADRE > SPACES
              OR E-ADRLVBEA > SPACES
              OR E-ADRCPTT  > SPACES
      *UPDATED FOR TBEN BY CK 25.07.2000
              OR E-CPAYSBEN > SPACES
              OR E-CQUART   > SPACES
      *END OF UPDATE BY CK
              OR E-ADRLVILL > SPACES
              OR E-ADRCPAYS > ZERO
              OR E-ADRLPAYS > SPACES
                 CONTINUE
              ELSE
                 MOVE 'CLI101'   TO   MSTD-NOMESS
                 MOVE '08'  TO WS-TRAIT-RESULTAT
                GO  TO  22200-TACHE-ADR20101-FIN
              END-IF.
      *UPDATED FOR TBEN BY CK 25.07.2000
              MOVE  SPACE  TO   WSTR-CPTT-TMP
              MOVE  SPACE  TO   WSTR-LVILL-TMP
              MOVE  E-ADRLVILL  TO  WSTR-LVILL-TMP
              EVALUATE  E-CPAYSBEN
                  WHEN  'B'
                     MOVE  '0' TO WSTR-CPTT11-TMP
                  WHEN  'E'
                     MOVE  '0' TO WSTR-CPTT11-TMP
                  WHEN  'L'
                     MOVE  '1' TO WSTR-CPTT11-TMP
                  WHEN  'NL'
                     MOVE  E-CQUART    TO  WSTR-CQUART-TMP
                     MOVE  E-ADRLVILL  TO  WSTR-NLVILLE-TMP
                     MOVE  '2' TO WSTR-CPTT11-TMP
              END-EVALUATE
              MOVE E-ADRCPTT  TO  WSTR-CPTT25-TMP
      *       PERFORM  TRT-CPTTBEN THRU
      *                                TRT-CPTTBEN-FIN
              IF   E-ADRLVBEA = LSP-ADRLVBEA
              AND  E-ADRLADRE = LSP-ADRLADRE
              AND  WSTR-LVILL-TMP  =  LSP-ADRLVILL
              AND  WSTR-CPTT-TMP   =  LSP-ADRCPTT
      *       AND  E-ADRCPTT  = LSP-ADRCPTT
      *       AND  E-ADRLVILL = LSP-ADRLVILL
      *END OF UPDATE BY CK
              AND  E-ADRCPAYS = LSP-ADRCPAYS
              AND  E-ADRLPAYS = LSP-ADRLPAYS
                 MOVE 'CLI101'   TO   MSTD-NOMESS
                  MOVE '08'  TO WS-TRAIT-RESULTAT
                 GO  TO  22200-TACHE-ADR20101-FIN
               ELSE
                 SET ZCOM-CHANGE  TO TRUE
              END-IF.

      *   -->  VALIDATION DE L'ADRESSE

      *UPDATED FOR TBEN BY CK 25.07.2000

      *-> REMPLISSAGE AUTOMATIQUE DE LA ZONE CODE PAYS
           EVALUATE E-CPAYSBEN
              WHEN 'B'
                 MOVE  131  TO  E-ADRCPAYS
              WHEN 'L'
                 MOVE  137  TO  E-ADRCPAYS
              WHEN 'NL'
                 MOVE  135  TO  E-ADRCPAYS
              WHEN 'E'
                 MOVE  '0000'  TO  E-ADRCPTT
           END-EVALUATE

      *-> VERIFICATION QUE L'AC A MODIFIER LE LIBELLE DE LA VILLE
              IF E-CPAYSBEN = 'E'
                 IF E-ADRLVILL = LSP-ADRLVILL
                       OR E-ADRLVILL = LSP-ADRNLVILLE
                    MOVE 'CLI244'   TO   MSTD-NOMESS
                    MOVE 'ER'       TO   ADRLVILL-ERREUR
                    MOVE '08'  TO WS-TRAIT-RESULTAT
                    GO  TO  22200-TACHE-ADR20101-FIN
                 END-IF
              END-IF

      *-> VALIDATION CONCERNANT LA VALIDITE DU CODE PAYS BENELUX INTRODUIT
              IF E-CPAYSBEN NOT = 'E' AND E-CPAYSBEN NOT = 'B'
                AND E-CPAYSBEN NOT = 'L' AND E-CPAYSBEN NOT = 'NL'
                    MOVE 'CLI241'   TO   MSTD-NOMESS
                    MOVE 'ER'       TO   CPAYSBEN-ERREUR
                    MOVE '08'  TO WS-TRAIT-RESULTAT
                    GO  TO  22200-TACHE-ADR20101-FIN
              END-IF

      *-> VALIDATION VERIFIANT LE CODE DU PAYS POUR L'ETRANGER EST DIFFERENT
      *   DE 131 , 137 ET 135 QUI CONCERNENT LES PAYS DU BENELUX
              IF E-CPAYSBEN  = 'E'
                IF E-ADRCPAYS = 131 OR E-ADRCPAYS = 137
                       OR E-ADRCPAYS = 135
                    MOVE 'CLI243'   TO   MSTD-NOMESS
                    MOVE 'ER'       TO   ADRCPAYS-ERREUR
                    MOVE '08'  TO WS-TRAIT-RESULTAT
                    GO  TO  22200-TACHE-ADR20101-FIN
                END-IF
              END-IF

      *-> VALIDATION QUE LE CODE QUARTIER EXISTE POUR UNE ADRESSE EN
      *   HOLLANDE
              IF E-CPAYSBEN  = 'NL'
                IF E-CQUART = SPACE
                    MOVE 'CLI242'   TO   MSTD-NOMESS
                    MOVE 'ER'       TO   CQUART-ERREUR
                    MOVE '08'  TO WS-TRAIT-RESULTAT
                    GO  TO  22200-TACHE-ADR20101-FIN
                END-IF
              END-IF

      *END OF UPDATE BY CK

           IF  E-ADRLVBEA NOT = SPACE
              IF  E-ADRLADRE = SPACE AND E-ADRLVILL = SPACE AND
                  E-ADRCPTT  = SPACES
                    MOVE 'CLI139'   TO   MSTD-NOMESS
                    MOVE 'ER'       TO   ADRLADRE-ERREUR
                    MOVE '08'  TO WS-TRAIT-RESULTAT
                    GO  TO  22200-TACHE-ADR20101-FIN
              END-IF
           END-IF

           IF  E-ADRLADRE  = SPACE
              MOVE 'CLI115'   TO   MSTD-NOMESS
              MOVE 'ER'       TO   ADRLADRE-ERREUR
              MOVE '08'  TO WS-TRAIT-RESULTAT
              GO  TO  22200-TACHE-ADR20101-FIN
           END-IF

      *---> PAS D'APPEL A UNIGEO SI LE PAYS N'EST PAS LA FRANCE
      *     CODE FRANCE = 100

      *UPDATED FOR TBEN BY CK 25.07.2000
      *        IF   E-ADRCPAYS        = 100    OR
               IF   E-ADRCPAYS        = 131    OR
                    E-ADRCPAYS        = 137    OR
                    E-ADRCPAYS        = 135    OR
                    E-ADRCPAYS        = ZERO

                    PERFORM   22200-VALIDATION-ADRESSE

                    IF   LSP-ADRESSE-FAUSSE
      *END OF UPDATE BY CK
                         GO TO 22200-TACHE-ADR20101-FIN
                    END-IF
              ELSE
                   MOVE E-ADRLVILL TO   E-ADRLLOCACH
              END-IF

             IF   E-ADRCPTT   =  SPACES
                  MOVE 'CLI114'   TO   MSTD-NOMESS
                  MOVE 'ER'       TO   ADRCPTT-ERREUR
                  MOVE '08'  TO WS-TRAIT-RESULTAT
                  GO  TO  22200-TACHE-ADR20101-FIN
             END-IF.
             IF   E-ADRLVILL  =  SPACE
                  MOVE 'CLI114'   TO   MSTD-NOMESS
                  MOVE 'ER'       TO   ADRLVILL-ERREUR
                  MOVE '08'  TO WS-TRAIT-RESULTAT
                  GO  TO  22200-TACHE-ADR20101-FIN
             END-IF.

             IF LSP-ADRCPAYS NUMERIC AND
                 LSP-ADRCPAYS     NOT  =  E-ADRCPAYS  AND
                 E-ADRCPAYS       NOT  =  ZERO

                 PERFORM 60000-INITIAL-ARMIDE

                 MOVE E-ADRCPAYS      TO ARM-VALEUR-MINI
                 MOVE 'DE'            TO ARM-FONCTION
                 MOVE 'RB'            TO ARM-TYPE-OBJ
                 MOVE 'CPAYS'         TO ARM-NOM-OBJ
                 MOVE SPACE           TO ARM-NOM-SDT
                    EXEC CICS HANDLE ABEND
                              CANCEL
                    END-EXEC

                    CALL ARM-NOMSPRGTP USING DFHEIBLK
                                             DFHCOMMAREA
                                             ARM-COMMAREA

                    EXEC CICS HANDLE ABEND
                          RESET
                    END-EXEC
                   IF ARM-ABEND OR ARM-PROBLEME
                      MOVE SPACE       TO STDER-TYPE-ERREUR
                      MOVE 'AB'        TO WS-SORTIE
                      PERFORM 30000-TRAIT-SORTIE
                   END-IF

                   IF  ARM-NON-TROUVE
                       MOVE 'CLI179'   TO   MSTD-NOMESS
                       MOVE 'ER'       TO   ADRCPAYS-ERREUR
                       MOVE '08'  TO WS-TRAIT-RESULTAT
                       GO  TO  22200-TACHE-ADR20101-FIN
                   ELSE
                       MOVE ARM-LIBELLE1-RUBRIQUE (1) TO E-ADRLPAYS
                   END-IF
                END-IF.


       22200-TRAITEMENT-ACTION.
           INITIALIZE DCLTBADRES.
           MOVE  LSP-FOYER   TO  ZCOM-FOYER.
           MOVE  'AD'        TO  ZCOM-TYPADR.
           MOVE  LSP-NOMPREN1 TO  ZCOM-NOMPREN1.
           MOVE  LSP-ADRLVBEA TO  ZCOM-ADRLVBEA.
           MOVE  LSP-ADRLADRE TO  ZCOM-ADRLADRE.
           MOVE  LSP-ADRCPTT  TO  ZCOM-ADRCPTT.
           MOVE  LSP-ADRLVILL TO  ZCOM-ADRLVILL.
           MOVE  LSP-ADRCPAYS TO  ZCOM-ADRCPAYS.
           MOVE  LSP-ADRLPAYS TO  ZCOM-ADRLPAYS.
           PERFORM 22200-MOVE-DATA     THRU  22200-MOVE-DATA-FIN.
           PERFORM 22200-REGLE-FVADR2  THRU  22200-REGLE-FVADR2-FIN.
           IF  ZCOM-CREATE
               SET  LSP-ADR-FOUND  TO  TRUE
           END-IF.
      *UPDATED FOR TBEN BY CK 26.07.2000
      *-> DEPLACER LA ZONE DE MAJ DES ZONES AVANT LE TEST DU DELETE AFIN
      *   DE REASSIGNER LES VALEUR PAR DEFAUT
           PERFORM 22200-MAJ-ZONES     THRU  22200-MAJ-ZONES-FIN.
           IF  ZCOM-DELETE
               SET  LSP-ADR-NOT-FOUND  TO  TRUE
               MOVE ZERO  TO LSP-ADRCPAYS
               MOVE SPACE TO LSP-ADRLVILL
               MOVE SPACE TO LSP-ADRLADRE
               MOVE SPACE TO LSP-ADRLVBEA
               MOVE SPACE TO LSP-ADRCPTT
               EVALUATE LSP-SOC
                  WHEN 106
                     MOVE '2'          TO  LSP-ADRCPTT11
                     MOVE 135          TO  LSP-ADRCPAYS
                  WHEN 116
                     MOVE '2'          TO  LSP-ADRCPTT11
                     MOVE 135          TO  LSP-ADRCPAYS
                  WHEN 103
                     MOVE '0'          TO  LSP-ADRCPTT11
                     MOVE 131          TO  LSP-ADRCPAYS
                  WHEN 113
                     MOVE '0'          TO  LSP-ADRCPTT11
                     MOVE 131          TO  LSP-ADRCPAYS
               END-EVALUATE

               PERFORM 60000-INITIAL-ARMIDE
               MOVE LSP-ADRCPAYS    TO ARM-VALEUR-MINI
               MOVE 'DE'            TO ARM-FONCTION
               MOVE 'RB'            TO ARM-TYPE-OBJ
               MOVE 'CPAYS'         TO ARM-NOM-OBJ
               MOVE SPACE           TO ARM-NOM-SDT

               EXEC CICS HANDLE ABEND
                        CANCEL
               END-EXEC

               CALL ARM-NOMSPRGTP USING DFHEIBLK
                                       DFHCOMMAREA
                                       ARM-COMMAREA

               EXEC CICS HANDLE ABEND
                    RESET
               END-EXEC

               IF ARM-ABEND OR ARM-PROBLEME
                  MOVE SPACE       TO STDER-TYPE-ERREUR
                  MOVE 'AB'        TO WS-SORTIE
                  PERFORM 30000-TRAIT-SORTIE
               END-IF

               IF  ARM-NON-TROUVE
                   MOVE 'CLI179'   TO   MSTD-NOMESS
                   MOVE 'ER'       TO   ADRCPAYS-ERREUR
                   MOVE '08'       TO   WS-TRAIT-RESULTAT
                   GO  TO  22200-TACHE-ADR20001-FIN
                ELSE
                   MOVE ARM-LIBELLE1-RUBRIQUE (1) TO LSP-ADRLPAYS
               END-IF
           END-IF.
      *    PERFORM 22200-MAJ-ZONES     THRU  22200-MAJ-ZONES-FIN.
      *END OF UPDATE BY CK
           MOVE SPACE TO LSP-ACTION.

           MOVE '01' TO WS-TRAIT-RESULTAT.
      *
      * *--------------------------------------------------------------*
      *
      *
      *             INSERT HERE TASK'S PROCESSINGS
      *                 (CONTROL, UPDATE, ...)
      *
      *

       22200-TACHE-ADR20101-FIN.
           EXIT.

       22200-RECEIVE-DATA                       SECTION.
           IF E-ADRLADRE         = LOW-VALUE
              MOVE SPACES         TO E-ADRLADRE
           END-IF.
           IF E-ADRLVBEA        = LOW-VALUE
              MOVE SPACES         TO E-ADRLVBEA
           END-IF.
      *UPDATED FOR TBEN BY CK 25.07.2000
      *    IF E-ADRCPTT         = LOW-VALUE
      *       MOVE ZEROS          TO E-ADRCPTT
           IF E-ADRCPTT         = LOW-VALUE
              MOVE SPACES         TO E-ADRCPTT
           IF E-CQUART          = LOW-VALUE
              MOVE SPACES         TO E-CQUART
           IF E-CPAYSBEN        = LOW-VALUE
              MOVE SPACES         TO E-CPAYSBEN
      *END OF UPDATE BY CK
           END-IF.
           IF E-ADRLVILL        = LOW-VALUE
              MOVE SPACES         TO E-ADRLVILL
           END-IF.
           IF E-ADRCPAYS        = LOW-VALUE
              MOVE ZEROS          TO E-ADRCPAYS
           END-IF.
           IF E-ADRLPAYS        = LOW-VALUE
              MOVE SPACES         TO E-ADRLPAYS
           END-IF.
           IF E-ACTION          = LOW-VALUE
              MOVE SPACES         TO E-ACTION
           END-IF.
       22200-RECEIVE-DATA-FIN.
           EXIT.


       22200-MOVE-DATA        SECTION.

           MOVE LSP-FOYER    TO TADRNFOY.
           MOVE 'AD'        TO TADRCTYPE.
           MOVE E-ADRLVBEA TO TADRLVBEA
                          LSP-ADRLVBEA.
           MOVE E-ADRLADRE TO TADRLADRE
                          LSP-ADRLADRE.
      *UPDATED FOR TBEN BY CK 26.07.2000
      *-> CONSTRUCTION DU CODE POSTAL POUR LE BENELUX
           MOVE SPACE      TO  WSTR-CPTT-TMP.
           MOVE E-ADRLVILL TO  WSTR-LVILL-TMP.
           EVALUATE  E-CPAYSBEN
               WHEN 'B'
                 MOVE  '0'  TO  WSTR-CPTT11-TMP
               WHEN 'E'
                 MOVE  '0'  TO  WSTR-CPTT11-TMP
               WHEN 'NL'
                 MOVE  E-CQUART   TO  WSTR-CQUART-TMP
                 MOVE  E-ADRLVILL TO  WSTR-NLVILLE-TMP
                 MOVE  '2'  TO  WSTR-CPTT11-TMP
               WHEN 'L'
                 MOVE  '1'  TO  WSTR-CPTT11-TMP
           END-EVALUATE
           MOVE  E-ADRCPTT  TO  WSTR-CPTT25-TMP
      *    MOVE E-ADRCPTT  TO TADRCPTT
      *                   LSP-ADRCPTT.
      *    MOVE E-ADRLVILL TO TADRLVILL
      *                   LSP-ADRLVILL.
           MOVE WSTR-CPTT-TMP TO TADRCPTT
                             LSP-ADRCPTT.
           MOVE WSTR-LVILL-TMP  TO TADRLVILL
                             LSP-ADRLVILL.
      *END OF UPDATE BY CK
           MOVE E-ADRCPAYS TO TADRCPAYS
                          LSP-ADRCPAYS.
           MOVE E-ADRLPAYS TO TADRLPAYS
                          LSP-ADRLPAYS.

       22200-MOVE-DATA-FIN.
           EXIT.

       22200-MAJ-ZONES        SECTION.

           MOVE TADRLVBEA  TO  LSP-ADRLVBEA.
           MOVE TADRLADRE  TO  LSP-ADRLADRE.
           MOVE TADRCPTT   TO  LSP-ADRCPTT.
           MOVE TADRLVILL  TO  LSP-ADRLVILL.
           MOVE TADRCPAYS  TO  LSP-ADRCPAYS.
           MOVE TADRLPAYS  TO  LSP-ADRLPAYS.

       22200-MAJ-ZONES-FIN.
           EXIT.



       22200-VALIDATION-ADRESSE SECTION.


           SET LSP-ADRESSE-OK TO TRUE
      *
      *    MOVE E-ADRLADRE   TO   UGEO-ADR.
      *UPDATED FOR TBEN BY CK 25.07.2000
      *->  PRISE EN COMPTE DU CODE POSTAL BENELUX
           MOVE  SPACES  TO  WSTR-CPTT-TMP.
           EVALUATE E-CPAYSBEN
              WHEN 'NL'
                  MOVE   '2'  TO  WSTR-CPTT11-TMP
              WHEN 'B'
                  MOVE   '0'  TO  WSTR-CPTT11-TMP
              WHEN 'L'
                  MOVE   '1'  TO  WSTR-CPTT11-TMP
              WHEN 'E'
                  MOVE   '0'  TO  WSTR-CPTT11-TMP
           END-EVALUATE
           MOVE  E-ADRCPTT      TO  WSTR-CPTT25-TMP.
           MOVE  WSTR-CPTT-TMP  TO  UGEO-CPTT.
      *    MOVE E-ADRCPTT       TO  UGEO-CPTT.
      *END OF UPDATE BY CK
           MOVE E-ADRLVILL   TO   UGEO-VILL.

           PERFORM 22200-REGLE-FVADR.

           IF ADRESSE-OK

      *       MOVE UGEO-ADR    TO  E-ADRLADRE
      *UPDATED FOR TBEN BY CK 25.07.2000
              MOVE UGEO-CPTT(2:4)   TO  E-ADRCPTT
      *       MOVE UGEO-CPTT   TO  E-ADRCPTT
      *END OF UPDATE BY CK
              MOVE UGEO-VILL   TO  E-ADRLVILL
      *       MOVE UGEO-BDIS   TO  TADRLLOCACH
      *       MOVE UGEO-TDM    TO  TADRCTDM
              ELSE
                   EVALUATE TRUE

                            WHEN ADR-REJ-RUE
                                 MOVE 'ER'  TO   ADRLADRE-ERREUR
                                 MOVE  E-ADRLADRE   TO  LSP-ADRLADRE
      *UPDATED FOR TBEN BY CK 25.07.2000
                                 MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
                                 EVALUATE  E-CPAYSBEN
                                   WHEN  'B'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'L'
                                      MOVE  '1'  TO  LSP-ADRCPTT11
                                   WHEN  'E'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'NL'
                                      MOVE  '2'  TO  LSP-ADRCPTT11
                                      MOVE E-CQUART   TO  LSP-ADRCQUART
                                      MOVE E-ADRLVILL TO  LSP-ADRNLVILLE
                                 END-EVALUATE
                                 MOVE  E-ADRCPTT    TO  LSP-ADRCPTT25
      *                          MOVE  E-ADRCPTT    TO  LSP-ADRCPTT
      *                          MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
                                 SET   LSP-ADRESSE-FAUSSE   TO TRUE


                            WHEN ADR-REJ-VILL
                                 MOVE 'ER'  TO   ADRLVILL-ERREUR
                                 MOVE  E-ADRLADRE   TO  LSP-ADRLADRE
      *UPDATED FOR TBEN BY CK 25.07.2000
                                 MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
                                 EVALUATE  E-CPAYSBEN
                                   WHEN  'B'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'L'
                                      MOVE  '1'  TO  LSP-ADRCPTT11
                                   WHEN  'E'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'NL'
                                      MOVE  '2'  TO  LSP-ADRCPTT11
                                      MOVE E-CQUART   TO  LSP-ADRCQUART
                                      MOVE E-ADRLVILL TO  LSP-ADRNLVILLE
                                 END-EVALUATE
                                 MOVE  E-ADRCPTT    TO  LSP-ADRCPTT25
      *                          MOVE  E-ADRCPTT    TO  LSP-ADRCPTT
      *                          MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
      *END OF UPDATE BY CK
                               WHEN ADR-REJ-CPTT
                                  MOVE 'ER'  TO   ADRCPTT-ERREUR
                                  MOVE  E-ADRLADRE   TO  LSP-ADRLADRE
      *UPDATED FOR TBEN BY CK 25.07.2000
                                 MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
                                 EVALUATE  E-CPAYSBEN
                                   WHEN  'B'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'L'
                                      MOVE  '1'  TO  LSP-ADRCPTT11
                                   WHEN  'E'
                                      MOVE  '0'  TO  LSP-ADRCPTT11
                                   WHEN  'NL'
                                      MOVE  '2'  TO  LSP-ADRCPTT11
                                      MOVE E-CQUART   TO  LSP-ADRCQUART
                                      MOVE E-ADRLVILL TO  LSP-ADRNLVILLE
                                 END-EVALUATE
                                 MOVE  E-ADRCPTT    TO  LSP-ADRCPTT25
      *                          MOVE  E-ADRCPTT    TO  LSP-ADRCPTT
      *                          MOVE  E-ADRLVILL   TO  LSP-ADRLVILL
      *END OF UPDATE BY CK
                            END-EVALUATE
                 END-IF.

       22200-VALIDATION-ADRESSE-FIN.
             EXIT.

      *$XINCLUDE HOBJFVADR2M PROC  8140LIBR  FVADR2MPMODFVADR2MP        INL
      ******************************************************************
      * MODIFICATION                                                   *
      *----------------------------------------------------------------*
      * --/--/---- ! USERID  ! DESCRIPTION                             *MD----
      *----------------------------------------------------------------*
      * 27/05/2013 ! TASPINA ! INDEPENDENCE DONNéS ET TRAITEMENTS      *MD1043
      ************************************************************************
      *================================================================*
      * TRAITEMENT LOGICIEL OU PROGRAMME OU SOUS PROGRAMME FVADR2M
      * MAJ INFO. 2NDE ADRESSE
      * TRAITEMENT PRINCIPAL                                           *
      *================================================================*


       22200-REGLE-FVADR2             SECTION.

             MOVE  ZCOM-FOYER   TO  TADRNFOY.
             MOVE  ZCOM-TYPADR  TO  TADRCTYPE.
             EVALUATE TRUE
               WHEN  ZCOM-CREATE
                    MOVE   1   TO  TADRBCHAD
                    MOVE   WJJMMAAAADB2   TO     TADRDCREAT
                    MOVE   '01.01.0001'   TO     TADRDMOD
                    PERFORM  22200-WRITE-BLOCNOTE
                             THRU  22200-WRITE-BLOCNOTE-FIN
                    PERFORM 22200-INSERT-TBADRES
                           THRU 22200-INSERT-TBADRES-FIN
                    MOVE 'ADR202'   TO   MSTD-NOMESS
                WHEN  ZCOM-MODIFY
                    MOVE   WJJMMAAAADB2   TO     TADRDMOD
                    ADD    1              TO     TADRBCHAD
                    PERFORM  22200-WRITE-BLOCNOTE
                              THRU  22200-WRITE-BLOCNOTE-FIN
                    PERFORM 22200-UPDATE-TBADRES
                           THRU 22200-UPDATE-TBADRES-FIN
                    MOVE 'ADR201'   TO   MSTD-NOMESS
                WHEN ZCOM-DELETE
                    PERFORM  22200-WRITE-BLOCNOTE
                              THRU  22200-WRITE-BLOCNOTE-FIN
                    MOVE  ZCOM-FOYER   TO  TDPRNFOY
                    PERFORM 22200-MAJ-DOSSIER
                           THRU 22200-MAJ-DOSSIER-FIN
                    PERFORM 22200-DELETE-TBADRES
                           THRU 22200-DELETE-TBADRES-FIN
                    MOVE 'ADR205'   TO   MSTD-NOMESS
                END-EVALUATE.

       22200-REGLE-FVADR2-FIN.
           EXIT.

      * *------------------------------------------------------------*
      * *         INSERT D'UNE LIGNE DE LA TABLE TBADRES
      * *------------------------------------------------------------*

       22200-INSERT-TBADRES.
           EXEC SQL
                INSERT INTO TBADRES
                       (
                         TADRNFOY                                       MD1043
                      ,  TADRCTYPE                                      MD1043
                      ,  TADRDCREAT                                     MD1043
                      ,  TADRDMOD                                       MD1043
                      ,  TADRLVBEA                                      MD1043
                      ,  TADRLADRE                                      MD1043
                      ,  TADRCPTT                                       MD1043
                      ,  TADRLVILL                                      MD1043
                      ,  TADRLLOCACH                                    MD1043
                      ,  TADRCPAYS                                      MD1043
                      ,  TADRLPAYS                                      MD1043
                      ,  TADRCTDM                                       MD1043
                      ,  TADRBCHAD                                      MD1043
                       )
      *         VALUES (:DCLTBADRES)                            MD1043
                VALUES ( :TADRNFOY                                      MD1043
                      ,  :TADRCTYPE                                     MD1043
                      ,  :TADRDCREAT                                    MD1043
                      ,  :TADRDMOD                                      MD1043
                      ,  :TADRLVBEA                                     MD1043
                      ,  :TADRLADRE                                     MD1043
                      ,  :TADRCPTT                                      MD1043
                      ,  :TADRLVILL                                     MD1043
                      ,  :TADRLLOCACH                                   MD1043
                      ,  :TADRCPAYS                                     MD1043
                      ,  :TADRLPAYS                                     MD1043
                      ,  :TADRCTDM                                      MD1043
                      ,  :TADRBCHAD          )                          MD1043
           END-EXEC.

           EVALUATE TRUE
               WHEN SQLCODE > ZERO  CONTINUE
               WHEN SQLCODE < ZERO
                    MOVE 'INSERT TBADRES'  TO STDER-MESSAGE
                    MOVE TADRNFOY            TO ZADRNFOY
                    MOVE TADRCTYPE           TO ZADRCTYPE
                    MOVE ZTBADRES            TO STDER-DB2-CLE
                    MOVE 'TBADRES'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.

       22200-INSERT-TBADRES-FIN.
           EXIT.

      * *------------------------------------------------------------*
      * *           UPDATE DE LIGNE DE LA TABLE TBADRES
      * *------------------------------------------------------------*

       22200-UPDATE-TBADRES.
            EXEC SQL
                 UPDATE TBADRES
                    SET TADRDMOD             = :TADRDMOD
                      , TADRLVBEA            = :TADRLVBEA
                      , TADRLADRE            = :TADRLADRE
                      , TADRCPTT             = :TADRCPTT
                      , TADRLVILL            = :TADRLVILL
                      , TADRLLOCACH          = :TADRLLOCACH
                      , TADRCPAYS            = :TADRCPAYS
                      , TADRLPAYS            = :TADRLPAYS
                      , TADRCTDM             = :TADRCTDM
                      , TADRBCHAD            = :TADRBCHAD
                 WHERE TADRNFOY  = :TADRNFOY
                  AND TADRCTYPE = :TADRCTYPE
           END-EXEC.
           EVALUATE TRUE
               WHEN SQLCODE = 100
               WHEN SQLCODE < ZERO
                    MOVE 'UPDATE TBADRES'  TO STDER-MESSAGE
                    MOVE TADRNFOY            TO ZADRNFOY
                    MOVE TADRCTYPE           TO ZADRCTYPE
                    MOVE ZTBADRES            TO STDER-DB2-CLE
                    MOVE 'TBADRES'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.

       22200-UPDATE-TBADRES-FIN.
           EXIT.
      * *------------------------------------------------------------*
      * *          DELETE DE LIGNE DE LA TABLE TBADRES
      * *------------------------------------------------------------*

       22200-DELETE-TBADRES.
            EXEC SQL
                 DELETE FROM TBADRES
                 WHERE TADRNFOY  = :TADRNFOY
                   AND TADRCTYPE = :ZCOM-TYPADR
            END-EXEC.

            EVALUATE TRUE
                WHEN SQLCODE = 100
                WHEN SQLCODE < ZERO
                     MOVE 'DELETE TBADRES'  TO STDER-MESSAGE
                     MOVE TADRNFOY            TO ZADRNFOY
                     MOVE TADRCTYPE           TO ZADRCTYPE
                     MOVE ZTBADRES            TO STDER-DB2-CLE
                     MOVE ZTBADRES            TO STDER-DB2-CLE
                     MOVE 'TBADRES'           TO STDER-DB2-TABLE
                     MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                     PERFORM 30000-TRAIT-SORTIE
            END-EVALUATE.

            INITIALIZE DCLTBADRES.
      *UPDATED FOR TBEN BY CK 26.07.2000
      *     MOVE  100       TO  TADRCPAYS.
      *     MOVE  'FRANCE'  TO  TADRLPAYS.
      *END OF UPDATE BY CK

       22200-DELETE-TBADRES-FIN.
           EXIT.




       22200-MAJ-DOSSIER      SECTION.

      * *--------------------------------------------------------------*
      * *    DECLARE, OPEN, FETCH ET CLOSE DU CURSEUR CURSDOS
      * *             avec intention de mise à jour
      * *--------------------------------------------------------------*

           EXEC SQL
                DECLARE CURSDOS CURSOR FOR
                SELECT   TDPRNFOY
                      ,  TDPRNCONT
                      ,  TDPRNCARTE
                      ,  TDPRNDT
                      ,  TDPRNSOC
                      ,  TDPRCADRESCOUR
                FROM  TBDOPRN
                WHERE TDPRNFOY   = :TDPRNFOY
                FOR UPDATE OF TDPRCADRESCOUR
           END-EXEC.


       22200-OPEN-CURSOR-CURSDOS.
           EXEC SQL
                OPEN CURSDOS
           END-EXEC.

           EVALUATE TRUE
               WHEN SQLCODE < ZERO
                    MOVE 'OPEN CURSDOS'      TO STDER-MESSAGE
                    MOVE 'FVADR2P'           TO STDER-BOITE
                    MOVE TDPRNFOY            TO ZDPRNFOY
                    MOVE TDPRNCONT           TO ZDPRNCONT
                    MOVE TDPRNCARTE          TO ZDPRNCARTE
                    MOVE TDPRNDT             TO ZDPRNDT
                    MOVE TDPRNSOC            TO ZDPRNSOC
                    MOVE ZTBDOPRN            TO STDER-DB2-CLE
                    MOVE 'TBDOPRN'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.



       22200-FETCH-CURSOR-CURSDOS.
           INITIALIZE DCLTBDOPRN.
           EXEC SQL
                FETCH CURSDOS
                 INTO   :TDPRNFOY
                      , :TDPRNCONT
                      , :TDPRNCARTE
                      , :TDPRNDT
                      , :TDPRNSOC
                      , :TDPRCADRESCOUR
           END-EXEC.

           EVALUATE TRUE
               WHEN SQLCODE = 100
                    GO TO   22200-CLOSE-CURSOR-CURSDOS
               WHEN SQLCODE < ZERO
                    MOVE 'FETCH CURSDOS'     TO STDER-MESSAGE
                    MOVE 'FVADR2P'           TO STDER-BOITE
                    MOVE TDPRNFOY            TO ZDPRNFOY
                    MOVE TDPRNCONT           TO ZDPRNCONT
                    MOVE TDPRNCARTE          TO ZDPRNCARTE
                    MOVE TDPRNDT             TO ZDPRNDT
                    MOVE TDPRNSOC            TO ZDPRNSOC
                    MOVE ZTBDOPRN            TO STDER-DB2-CLE
                    MOVE 'TBDOPRN'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.
           IF   TDPRCADRESCOUR  =  ZCOM-TYPADR

                PERFORM  22200-UPDATE-TBDOPRN
                                     THRU    22200-UPDATE-TBDOPRN-FIN
           END-IF.
      *
           GO TO   22200-FETCH-CURSOR-CURSDOS.



       22200-CLOSE-CURSOR-CURSDOS.
           EXEC SQL
                CLOSE CURSDOS
           END-EXEC.

           EVALUATE TRUE
               WHEN SQLCODE < ZERO
                    MOVE 'CLOSE CURSDOS'     TO STDER-MESSAGE
                    MOVE 'FVADR2P'           TO STDER-BOITE
                    MOVE TDPRNFOY            TO ZDPRNFOY
                    MOVE TDPRNCONT           TO ZDPRNCONT
                    MOVE TDPRNCARTE          TO ZDPRNCARTE
                    MOVE TDPRNDT             TO ZDPRNDT
                    MOVE TDPRNSOC            TO ZDPRNSOC
                    MOVE ZTBDOPRN            TO STDER-DB2-CLE
                    MOVE 'TBDOPRN'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.



       22200-MAJ-DOSSIER-FIN.
           EXIT.



      * *--------------------------------------------------------------*
      * *     UPDATE DE LA TABLE TBDOPRN SUR CURSEUR CURSDOS
      * *--------------------------------------------------------------*

       22200-UPDATE-TBDOPRN      SECTION.

      *  CHANGEMENT DU CODE ADRESSE SUR TBDOPRN


           EXEC SQL
                UPDATE TBDOPRN
                   SET TDPRCADRESCOUR       = :ZCOM-TYPEDEF
               WHERE CURRENT OF CURSDOS
           END-EXEC.

           EVALUATE TRUE
               WHEN SQLCODE = 100
               WHEN SQLCODE < ZERO
                    MOVE 'UPDATE CURSDOS'    TO STDER-MESSAGE
                    MOVE 'FVADR2P'           TO STDER-BOITE
                    MOVE TDPRNFOY            TO ZDPRNFOY
                    MOVE TDPRNCONT           TO ZDPRNCONT
                    MOVE TDPRNCARTE          TO ZDPRNCARTE
                    MOVE TDPRNDT             TO ZDPRNDT
                    MOVE TDPRNSOC            TO ZDPRNSOC
                    MOVE ZTBDOPRN            TO STDER-DB2-CLE
                    MOVE 'TBDOPRN'           TO STDER-DB2-TABLE
                    MOVE 'DB2 '              TO STDER-TYPE-ERREUR
                    PERFORM 30000-TRAIT-SORTIE
           END-EVALUATE.


       22200-UPDATE-TBDOPRN-FIN.
           EXIT.

       22200-WRITE-BLOCNOTE  SECTION.

            MOVE   'C'                TO  ZVAR-CLDOS.
      ***  ALIMENTATION INITIALES
            MOVE    COM-AUTNOID       TO  ZVAR-USERID.
            MOVE   'C'                TO  ZVAR-DOMAINE.
            MOVE   ZCOM-SOC           TO  ZVAR-CLESTE.
            MOVE   ZCOM-FOYER         TO  ZVAR-CLECLI.

            MOVE ZVNATADRESSNA        TO ZVAR-NATURE
            MOVE   ZCOM-ADRLVBEA TO  ZVADRCOMPLNA
            MOVE   ZCOM-ADRLADRE TO  ZVADRRUENA
            MOVE   ZCOM-ADRCPTT  TO  ZVADRCPNA
            MOVE   ZCOM-ADRLVILL TO  ZVVILNA
            MOVE   '2EME ADRES'  TO  ZVARADRTYP
            MOVE   LENGTH OF ZVADRESSNA
                                  TO  ZVAR-LENGTH

           PERFORM  22200-REGLE-FVVAR.


       22200-WRITE-BLOCNOTE-FIN.
           EXIT.


           EXEC SQL
              INCLUDE FVVARP
           END-EXEC.

      *$XENDINCLUDE


           EXEC SQL
              INCLUDE FVADRP
           END-EXEC.

      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  6312LIBR  FADR201 MODFADR201V%=22200 INL
      * *==============================================================*
      * *   I TASKS' COMMON PROCESSINGS         GENERATED : 03-12-98   *
      * *--------------------------------------------------------------*
      * *                                                              *
      * * FOLLOWING PROCESSINGS ARE COMMON FOR ALL TASKS.              *
      * * THEY ARE ACTIVATED BY USING "PERFORM".                       *
      * *                                                              *
      * *==============================================================*
      * * --/--/-- * ------- * -------                                 *MD----
      * * 11/02/15 * SCHROYE * AUDIT KBC PROTECT FIELDS FOR KBC        *MD1560
      * * 09/12/13 * TASPINA * INDEPENDANCE DONNEES ET TRAITEMENTS     *MD1043
      * *==============================================================*
       22200-TRAIT-COMM-TAC                     SECTION.
      *
      *        INSERT HERE TASKS' COMMON PROCESSINGS
      *
       22200-TRAIT-COMM-TAC-FIN.
           EXIT.
      *UPDATED FOR TBEN BY CK 26.07.2000
      *   COPY CPTTBEN.
      *END OF UPDATE BY CK
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST2200PB                        STDST2200PB        INL
      * *============================================================*  00010013
      * * 22300     I SEARCH FOR TRANSITION TO EXECUTE               *  00020057
      * *------------------------------------------------------------*  00030013
      * *                                                            *  00040013
      * *  THE RESULT PRODUCED BY EXECUTED PROCESSING CAN BE FOUND   *  00050055
      * *  IN THE TRANSITION MATRIX, BY USING THE LINE IN PROGRESS.  *  00060055
      * *  IT GIVES THE CORRECT TRANSITION TO EXECUTE.               *  00070055
      * *                                                            *  00080013
      * *------------------------------------------------------------*  00090013
      * * POSSIBLE RESULTS :                                         *  00100055
      * *  .OK     --> GO ON PROCESSING                              *  00110056
      * *  .ERREUR --> EXIT WITH ERROR MESSAGE DISPLAY               *  00120056
      * *============================================================*  00130013
       22300-RECH-TRANSITION           SECTION.                         00140013
      *                                                                 00150013
      * *------------------------SEARCH FOR "TASK RESULT" LINE          00160058
      *                                                                 00170013
       22300-RECH-RESULT.                                               00180013
           IF  MTRA-IND                       > MTRA-NBMAX              00190037
               GO TO 22300-RECH-RESULT-KO                               00200038
           END-IF.                                                      00210038
      *                                                                 00220020
           IF  MTRA-TRAIT      (MTRA-IND)       = WS-TRAIT          AND 00230054
               MTRA-RESU       (MTRA-IND)       = WS-TRAIT-RESULTAT     00240054
               GO TO 22300-RECH-RESULT-OK                               00250041
           END-IF.                                                      00260038
      *                                                                 00270054
           IF  MTRA-TRAIT      (MTRA-IND)       = WS-TRAIT          AND 00280054
               MTRA-TRAIT-PREF (MTRA-IND)       = 'F'               AND 00290054
               WS-TRAIT-RESULTAT                = '99'                  00300054
               GO TO 22300-RECH-RESULT-OK                               00310054
           END-IF.                                                      00320054
      *                                                                 00330020
           ADD 1                           TO MTRA-IND.                 00340016
           GO TO 22300-RECH-RESULT.                                     00350013
      *                                                                 00360013
       22300-RECH-RESULT-KO.                                            00370013
           MOVE WS-TRAIT-RESULTAT          TO MSTD-PMESS (1).           00380020
           MOVE WS-TRAIT                   TO MSTD-PMESS (2).           00390026
           MOVE WS-ENC-EC                  TO MSTD-PMESS (3).           00400031
           MOVE 'ST9201'                   TO MSTD-NOMESS.              00410034
           MOVE 'RM'                       TO WS-SORTIE.                00420020
           GO TO 22300-RECH-TRANSITION-FIN.                             00430013
      *                                                                 00440038
       22300-RECH-RESULT-OK.                                            00450013
           IF  MTRA-NECRN (MTRA-IND)      NOT = '?'                     00460037
               MOVE MTRA-NECET (MTRA-IND)  TO WS-NECET                  00470041
           END-IF.                                                      00480042
           IF  MSTD-NOMESS                    = SPACE                   00490053
               MOVE MTRA-NOMESS (MTRA-IND) TO MSTD-NOMESS               00500050
           END-IF.                                                      00510042
      *                                                                 00520042
           IF  WS-NECRN                   NOT = 'EX'              OR    00530042
              (WS-FONCSVT-IDOPE               = SPACE             AND   00540045
               WS-FONCSVT-ARGUM               = SPACE)                  00550045
               MOVE 'TR'                   TO WS-TRAIT-PILOTE           00560042
               GO TO 22300-RECH-TRANSITION-FIN                          00570042
           END-IF.                                                      00580035
      *                                                                 00590041
           PERFORM 80000-CONTROLE-ENCH.                                 00600042
           IF  WS-SORTIE                      = 'EM'                    00610042
               MOVE SPACE                  TO WS-SORTIE                 00620042
               MOVE WS-ENC-ECET-INI        TO WS-NECET                  00630042
               MOVE 'TR'                   TO WS-TRAIT-PILOTE           00640042
               GO TO 22300-RECH-TRANSITION-FIN                          00650042
           END-IF.                                                      00660042
           IF  WS-SORTIE                      = 'AB'                    00670042
               GO TO 22300-RECH-TRANSITION-FIN                          00680042
           END-IF.                                                      00690042
      *                                                                 00700042
           IF  WS-FONCSVT-IDOPE               = STDP-NOM-FONC           00710047
               MOVE 'TR'                   TO WS-TRAIT-PILOTE           00720045
               GO TO 22300-RECH-TRANSITION-FIN                          00730045
           END-IF.                                                      00740045
      *                                                                 00750045
           MOVE WS-FONCSVT-IDOPE           TO WS-ZINQUIRE-TRANID.       00760041
           PERFORM 60000-RECHERCHE-TRANID.                              00770041
           IF  WS-ZINQUIRE-STATUST        NOT = 23                      00780042
               MOVE WS-ENC-ECET-INI        TO WS-NECET                  00790042
               MOVE 'TR'                   TO WS-TRAIT-PILOTE           00800042
              GO TO 22300-RECH-TRANSITION-FIN                           00810041
           END-IF.                                                      00820041
      *                                                                 00830041
           MOVE ZERO                       TO WS-ZINQUIRE-STATUSP.      00840041
      *    EXEC CICS INQUIRE PROGRAM (WS-ZINQUIRE-PGRMID)               00850041
      *                      STATUS  (WS-ZINQUIRE-STATUSP)              00860041
      *                      NOHANDLE                                   00870041
      *    END-EXEC.                                                    00880041
      *                                                                 00890041
           IF  WS-ZINQUIRE-STATUSP        NOT = 23                      00900048
               MOVE WS-ZINQUIRE-PGRMID     TO MSTD-PMESS (1)            00910042
               MOVE 'ST9701'               TO MSTD-NOMESS               00920042
               MOVE WS-ENC-ECET-INI        TO WS-NECET                  00930042
               MOVE 'TR'                   TO WS-TRAIT-PILOTE           00940042
               MOVE 'APPL'                 TO STDER-TYPE-ERREUR         00950042
               GO TO 22300-RECH-TRANSITION-FIN                          00960042
           END-IF.                                                      00970041
      *                                                                 00980041
           MOVE 'TR'                       TO WS-TRAIT-PILOTE.          00990029
      *                                                                 01000013
       22300-RECH-TRANSITION-FIN.                                       01010013
           EXIT.                                                        01020013
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 23000     I EXECUTION DE LA TRANSITION                     *
      * *------------------------------------------------------------*
      * *                                                            *
      * * CE TRAITEMENT DETERMINE LE TYPE DE TRANSITION A EXECUTER   *
      * *    ET ASSURE :                                             *
      * *                                                            *
      * *  - LA MEMORISATION DE LA DERNIERE TOUCHE FONCTION ACTIVEE  *
      * *                                                            *
      * *  - L'APPEL DE LA ROUTINE CONCERNEE PAR LA TRANSITION :     *
      * *    . APPEL ECRAN, SERVICE SANS CHANGEMENT DE PROGRAMME     *
      * *    . FIN FONCTION                                          *
      * *    . FIN APPEL FONCTION, ECRAN, SERVICE                    *
      * *    . RECHERCHE PROGRAMME A ENCHAINER                       *
      * *    . PREPARATION MESSAGE INTERNE                           *
      * *                                                            *
      * *============================================================*
       23000-EXEC-TRANSITION        SECTION.
           IF  WS-TF  NOT = SPACE
               MOVE WS-TF         TO LS-PREC-TF
           END-IF.
      *
           IF  (WS-SORTIE = 'AE'  OR  = 'AS')   AND
               (MTRA-PGM-TRAIT (MTRA-IND)  =  LS-ENC-PROG)
               PERFORM  23100-APPEL-ECRSRV
               GO TO 23000-EXEC-TRANSITION-FIN
           END-IF.
      *
           IF  WS-TRAIT-PILOTE  NOT = 'TR'
               GO TO 23000-PREP-EMISSION
           END-IF.
      *
           IF  WS-NECRN          =  'EX'
               PERFORM 23200-FIN-FONCTION
               GO TO 23000-EXEC-TRANSITION-FIN
           END-IF.
      *
           IF  WS-NECRN          =  'EP'
               PERFORM 23300-FIN-ECRAN-SERVICE
               GO TO 23000-EXEC-TRANSITION-FIN
           END-IF.
      *
           PERFORM 23500-RECH-PGM-SUIVANT.
      *
       23000-PREP-EMISSION.
           IF  WS-SORTIE         = 'EM'
               PERFORM 23600-ACTIV-PREP-ECRAN
           END-IF.
      *
       23000-EXEC-TRANSITION-FIN.
           EXIT.
           EJECT
      *$XINCLUDE ZSTDST2300PI                        STDST2300PI        INL
      * *============================================================*  00010000
      * * 23100  I PROCESSING FOR INITIALIZATION WHEN 'AE' AND 'AS'  *  00020028
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  WHEN 'CALL SCREEN' EXIT OR 'CALL SERVICE' EXIT            *  00050028
      * *  AND WHEN PROGRAM CALLED = PROGRAM IN PROGRESS,            *  00060028
      * *  LOOP THE SAME PROGRAM BY PROCESSING SOME                  *  00070029
      * *  INITIALIZATIONS IN 36000-... AND 10000-...                *  00080029
      * *                                                            *  00090000
      * *============================================================*  00100000
       23100-APPEL-ECRSRV              SECTION.                         00110000
           MOVE  SPACE                      TO  LS-PREC-TF.             00120019
           MOVE  MTRA-IND                   TO  LS-ENCH-ICOURS.         00130020
           MOVE  '1'                        TO  WS-TEST-ITER.           00140024
      *                                                                 00150014
           PERFORM  65000-SAUVE-CONTEXTE-PGM.                           00160000
      *                                                                 00170013
           MOVE  LS-FONC-ENC                TO  LS-FONC-PREC.           00180000
           MOVE  MTRA-TRAIT-NOM (MTRA-IND)  TO  LS-ENC-ECET.            00190025
           MOVE  '01'                       TO  LS-ENC-ET.              00200027
           ADD   1                          TO  LS-TSCO-ITEM.           00210025
           MOVE  WS-SORTIE                  TO  WS-ENTREE.              00220013
           MOVE  SPACE                      TO  WS-SORTIE               00230010
                                                WS-STATUT-MESSAGE       00240010
                                                WS-TRAITEMENT           00250010
                                                WS-TR-IND               00260010
                                                WS-TRAIT-PILOTE.        00270010
           MOVE  LS-ENC-ECET                TO  WS-ENC-ECET.            00280025
      *                                                                 00290000
           IF WS-ENTREE = 'AE'                                          00300017
              MOVE  LOW-VALUE               TO MSGI-MESSAGE             00310023
           END-IF.                                                      00320016
      *$XENDINCLUDE
      *
      *$XINCLUDE ZSTDST2300PA                        STDST2300PA        INL
      * *============================================================*  00010000
      * * 23200     I END OF FUNCTION PROCESSING                     *  00020044
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  THE "END OF FUNCTION" PROESSING (TRANSITION = EX RR) :    *  00050044
      * *                                                            *  00060000
      * *  - GIVES THE TYPE OF EXIT NEEDED ("EXPERT MODE" CHAINING,  *  00070044
      * *    CALL RETURN, CHAINING BY FUN. PROCEDURE).               *  00080044
      * *  - IF CHAINING BY FUNCTIONAL PROCEDURE, SEARCH FOR NEXT    *  00090044
      * *    PROCEDURE'S PHASE.                                      *  00100044
      * *                                                            *  00110034
      * *============================================================*  00120000
       23200-FIN-FONCTION              SECTION.                         00130015
      * *------------------------"EXPERT MODE" CHAINING                 00140044
      *                                                                 00150034
           IF  WS-FONCSVT-IDOPE NOT = SPACE AND                         00160043
               WS-TF            NOT = '04'                              00170043
               MOVE 'EO'                 TO WS-SORTIE                   00180034
               GO TO 23200-FIN-FONCTION-FIN                             00190034
           END-IF.                                                      00200034
      *                                                                 00210000
      * *------------------------END OF A CALLED FUNCTION               00220044
      *                                                                 00230000
           IF  LS-ENC-ENFONC        = 'FF'                              00240037
               PERFORM 90000-ERASE                                      00250035
               MOVE 'RF'                 TO WS-SORTIE                   00260025
               MOVE SPACE                TO LS-ENC-ENFONC               00270025
               GO TO 23200-FIN-FONCTION-FIN                             00280031
           END-IF.                                                      00290031
      *                                                                 00300035
      * *------------------------EXECUTION CONTEXT, FUN. PROC. EXCEPTED 00310044
      *                                                                 00320035
           IF  LS-ENC-PF            = SPACE                             00330035
               MOVE 'RM'                 TO WS-SORTIE                   00340035
               GO TO 23200-FIN-FONCTION-FIN                             00350035
           END-IF.                                                      00360035
      *                                                                 00370035
      * *------------------------EXECUTION CONTEXT, FUN. PROC. ENCLOSED 00380044
      *                                                                 00390035
           PERFORM 90000-ERASE.                                         00400035
           PERFORM 90000-ERASE-TSDES.                                   00410035
      *                                                                 00420028
           MOVE LS-FONC-ENC              TO LS-FONC-PREC.               00430028
      *                                                                 00440035
      * *------------------------SEARCH FOR PROC. PHASES CHAINING       00450044
      *                                                                 00460000
           MOVE SPACE                    TO WS-PFACT.                   00470024
           IF  WS-TF            NOT = '04'                              00480040
               MOVE LS-ENC-FONC          TO LS-RAPPEL-FONC              00490041
               MOVE 'PS'                 TO WS-PFACT-APPEL              00500038
               MOVE LS-PFACT-PHASE       TO WS-PFACT-PHASE              00510038
               MOVE LS-ENC-FONC          TO WS-PFACT-FONC               00520038
               MOVE WS-NETAT             TO WS-PFACT-RESU               00530038
           ELSE                                                         00540038
               MOVE 'PP'                 TO WS-PFACT-APPEL              00550038
               MOVE LS-PFACT-PHASE       TO WS-PFACT-PHASE              00560038
               MOVE LS-RAPPEL-FONC       TO WS-PFACT-FONC               00570038
               MOVE SPACE                TO WS-PFACT-RESU               00580038
               MOVE SPACE                TO LS-RAPPEL-FONC              00590042
           END-IF.                                                      00600038
      *                                                                 00610038
           PERFORM 80000-PILOTE-PF.                                     00620029
      *                                                                 00630022
           IF  WS-SORTIE        NOT = SPACE                             00640031
               GO TO 23200-FIN-FONCTION-FIN.                            00650016
      *                                                                 00660000
           MOVE 'ET'                     TO WS-SORTIE.                  00670025
      *                                                                 00680000
       23200-FIN-FONCTION-FIN.                                          00690015
           EXIT.                                                        00700000
      *                                                                 00710000
      *$XENDINCLUDE
      *
      *$XINCLUDE ZSTDST2300PB                        STDST2300PB        INL
      * *============================================================*  00010000
      * * 23300     I PROCESS END OF SCREEN / END OF SERVICE         *  00020020
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  PROCESSING IS TRIGGERED IF TYPE TRANSITION = (EP RR)      *  00050020
      * *                                                            *  00060000
      * *============================================================*  00070000
       23300-FIN-ECRAN-SERVICE         SECTION.                         00080004
           IF  MTRA-ECRN (MTRA-IND)  >  '49'                            00090004
               MOVE  'RS'          TO  WS-SORTIE                        00100003
           ELSE                                                         00110012
               MOVE  'RE'          TO  WS-SORTIE                        00120003
           END-IF.                                                      00130003
           IF  LS-ENCH-PGMSAUV  =  LS-ENC-PROG                          00140008
               MOVE  LS-FONC-ENC            TO  LS-FONC-PREC            00150003
               MOVE  SPACE                  TO  LS-PREC-TF              00160014
               SUBTRACT  1                FROM  LS-TSCO-ITEM            00170005
               MOVE  WS-SORTIE              TO  WS-ENTREE               00180003
               MOVE  SPACE                  TO  WS-SORTIE               00190013
                                                WS-STATUT-MESSAGE       00200013
                                                WS-TRAITEMENT           00210008
                                                WS-TR-IND               00220008
                                                WS-TRAIT-PILOTE         00230008
               MOVE  MTRA-NETAT (MTRA-IND)  TO  WS-TRAIT-RESULTAT       00240019
               MOVE  '1'                    TO  WS-TEST-ITER            00250009
           END-IF.                                                      00260003
      *                                                                 00270000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST2300PE                        STDST2300PE        INL
      * *============================================================*  00010000
      * * 23500     I SEARCH FOR NEXT PROGRAM                        *  00020041
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  THIS PROCESSING IDENTIFIES NAMES OF PROGRAM AND OF        *  00050041
      * *  TRANSACTION CODE EMITING NEXT SCREEN.                     *  00060041
      * *                                                            *  00070000
      * *============================================================*  00080000
       23500-RECH-PGM-SUIVANT               SECTION.                    00090000
           MOVE LS-FONC-ENC        TO LS-FONC-PREC.                     00100008
           MOVE WS-NECET           TO LS-ENC-ECET.                      00110022
      *                                                                 00120000
      * *------------------------ORIGIN SCREEN = NEXT SCREEN            00130041
      *                                                                 00140000
           IF  WS-NECRN       = WS-ENC-EC                               00150024
             IF  WS-NETAT-I   = 'I'  OR                                 00160024
                 WS-NECRN     > '49'                                    00170024
                 MOVE SPACE       TO LS-PREC-TF                         00180027
                                     WS-ENTREE                          00190027
                                     WS-SORTIE                          00200026
                                     WS-STATUT-MESSAGE                  00210026
                                     WS-TRAITEMENT                      00220026
                                     WS-TR-IND                          00230026
                 MOVE LS-ENC-ECET TO WS-ENC-ECET                        00240026
                 MOVE 'IA'        TO WS-TRAIT-PILOTE                    00250026
                 MOVE '1'         TO WS-TEST-ITER                       00260026
                 GO TO 23500-RECH-PGM-SUIVANT-FIN                       00270020
             ELSE                                                       00280024
                 MOVE 'EM'        TO WS-SORTIE                          00290030
                 MOVE LS-ENC-ECET TO WS-ENC-ECET                        00300030
                 GO TO 23500-RECH-PGM-SUIVANT-FIN                       00310020
             END-IF                                                     00320020
           END-IF.                                                      00330020
      *                                                                 00340000
      * *------------------------ORIGIN SCREEN <> NEXT SCREEN           00350041
      *                                                                 00360000
           MOVE MTRA-PGM-EM (MTRA-IND)  TO  LS-ENC-PROG.                00370020
      *                                                                 00380013
           IF  LS-ENC-PROG    = LS-PREC-PROG                            00390024
             IF  LS-PREC-EC                                             00400034
                          NOT = '00'                                    00410034
                 MOVE LOW-VALUE   TO MSGI-MESSAGE                       00420034
             END-IF                                                     00430034
             MOVE '1'             TO WS-TOPERMAP                        00440037
             MOVE '1'             TO WS-TOPEC                           00450037
             IF  WS-NETAT-I   = 'I'                                     00460033
                 MOVE SPACE       TO LS-PREC-TF                         00470027
                                     WS-ENTREE                          00480027
                                     WS-SORTIE                          00490026
                                     WS-STATUT-MESSAGE                  00500026
                                     WS-TRAITEMENT                      00510026
                                     WS-TR-IND                          00520026
                 MOVE LS-ENC-ECET TO WS-ENC-ECET                        00530026
                 MOVE 'IA'        TO WS-TRAIT-PILOTE                    00540026
                 MOVE '1'         TO WS-TEST-ITER                       00550026
             ELSE                                                       00560026
                 MOVE 'EM'        TO WS-SORTIE                          00570026
                 MOVE LS-ENC-ECET TO WS-ENC-ECET                        00580029
             END-IF                                                     00590026
           ELSE                                                         00600024
               MOVE 'ET'          TO WS-SORTIE                          00610026
           END-IF.                                                      00620020
      *                                                                 00630000
       23500-RECH-PGM-SUIVANT-FIN.                                      00640000
           EXIT.                                                        00650000
      *                                                                 00660000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4381LIBR  FADR201 STDFADR201U%=23600 INL
      * *============================================================*
      * *  I ACTIVATE SCREENS' PREPARATION      GENERATED : 21-08-00 *
      * *============================================================*
       23600-ACTIV-PREP-ECRAN              SECTION.
      *
           IF  WS-ENC-EC  = '01'
               PERFORM 23600-PREPECR-ADR201
               GO TO   23600-ACTIV-PREP-ECRAN-FIN.
      *
       23600-ACTIV-PREP-ECRAN-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  5311LIBR  ADR201  MODADR201U %=23600 INL
      * *============================================================*
      * *      I PREPARE DISPLAY OF SCREEN ADR201    GEN. : 03-12-98 *
      * *============================================================*
       23600-PREPECR-ADR201                SECTION.
      *
           MOVE 'PREPEC01'      TO STDER-BOITE.
      *
      *
      *    INSERT HERE SPECIFIC PROCESSINGS FOR
      *    PREPARATION OF SCREEN  :    ADR201
      *
      *    - data acquisition
      *    - fill internal message :
      *       . screen's initial preparation :
           IF (WS-TOPEC            = '1'  AND
               WS-TOP-PREPINI      = 'N') OR
              (WS-TOP-PREPINI      = '1')
               PERFORM 23600-INITECR-ADR201.
      *UPDATED FOR TBEN BY CK  27.07.2000
           MOVE PROT-DRK  TO  ADRLLOCACH-ATTRIBUT
           IF  E-CPAYSBEN = 'NL'
              MOVE  UNPR      TO  CQUART-ATTRIBUT
           ELSE
              MOVE  PROT-DRK  TO  CQUART-ATTRIBUT
           END-IF
      *END OF UPDATE BY CK

      * MOVE VALUES FROM COMMAREA TO SCREEN
           MOVE LSP-SOC         TO E-DPRNSOC
           MOVE LSP-FOYER       TO E-CLINFOY
           MOVE LSP-NOMPREN1    TO E-CLILNOMPREN
           MOVE LSP-ACTION      TO E-ACTION
      *POPULATE ADDRESS INFO
           MOVE LSP-ADRLVBEA    TO E-ADRLVBEA
           MOVE LSP-ADRLADRE    TO E-ADRLADRE
      *UPDATED FOR TBEN BY CK 24.07.2000
      *-> REPRESENTATION CORRECTE DU CODE POSTAL A L'ECRAN
           EVALUATE LSP-ADRCPTT11
               WHEN '0'
                   IF  LSP-ADRCPTT25  = '0000'
                      MOVE 'E' TO E-CPAYSBEN
                   ELSE
                      MOVE 'B' TO E-CPAYSBEN
                   END-IF
                   MOVE LSP-ADRLVILL TO E-ADRLVILL
               WHEN '1'
                   MOVE 'L' TO E-CPAYSBEN
                   MOVE LSP-ADRLVILL TO E-ADRLVILL
               WHEN '2'
                   MOVE LSP-ADRCQUART      TO E-CQUART
                   MOVE LSP-ADRNLVILLE     TO E-ADRLVILL
                   MOVE 'NL' TO E-CPAYSBEN
               WHEN OTHER
                   MOVE SPACE   TO  E-CQUART
                   MOVE SPACE   TO  E-CPAYSBEN
                   MOVE SPACE   TO  E-ADRLVILL
           END-EVALUATE
           MOVE LSP-ADRCPTT25    TO E-ADRCPTT
      *    MOVE LSP-ADRCPTT     TO E-ADRCPTT
      *    MOVE LSP-ADRLVILL    TO E-ADRLVILL
      *END OF UPDATE BY CK
           MOVE LSP-ADRCPAYS    TO E-ADRCPAYS
           MOVE LSP-ADRLPAYS    TO E-ADRLPAYS
           .

           IF E-DPRNSOC = 100
           AND COM-AUTNIVEAUH <= 4                                      MD1560
              MOVE  PROT        TO ADRLADRE-ATTRIBUT
                                   ADRLVBEA-ATTRIBUT
                                   CPAYSBEN-ATTRIBUT
                                   ADRCPTT-ATTRIBUT
                                   ADRLVILL-ATTRIBUT
                                   ADRLLOCACH-ATTRIBUT
                                   ADRCPAYS-ATTRIBUT
                                   ADRLPAYS-ATTRIBUT
           END-IF                                                       MD1560
           .                                                            MD1560

      *
      *        . other preparation
      *
       23600-PREPECR-ADR201-FIN.
           EXIT.
      *$XENDINCLUDE
      *$XINCLUDE XGENFADR201 PROC  5310LIBR  ADR201  STDADR201V %=23600 INL
      * *============================================================*
      * *   I INITIAL PREPARATION OF SCREEN ADR201    GEN. : 21-08-00*
      * *------------------------------------------------------------*
      * *                                                            *
      * * THIS COMPONENT PROCESSES INTITAL LOAD OF SCREEN'S FIELDS,  *
      * * BASED ON ASSOCIATED APPLICATION DATA.                      *
      * *                                                            *
      * *============================================================*
       23600-INITECR-ADR201                SECTION.
      *
           MOVE TDPRNSOC
                TO E-DPRNSOC           OF ADR201-MSGI.
           MOVE TCLINFOY
                TO E-CLINFOY           OF ADR201-MSGI.
           MOVE TCLILNOMPREN
                TO E-CLILNOMPREN       OF ADR201-MSGI.
           MOVE TADRLADRE
                TO E-ADRLADRE          OF ADR201-MSGI.
           MOVE TADRLVBEA
                TO E-ADRLVBEA          OF ADR201-MSGI.
           MOVE TADRCPAYS
                TO E-ADRCPAYS          OF ADR201-MSGI.
           MOVE TADRLPAYS
                TO E-ADRLPAYS          OF ADR201-MSGI.
           MOVE TACTION
                TO E-ACTION            OF ADR201-MSGI.
      *
       23600-INITECR-ADR201-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 30000     I TRAITEMENT SORTIE DU PROGRAMME                 *
      * *------------------------------------------------------------*
      * *                                                            *
      * * LE TRAITEMENT SORTIE EST EXECUTE A CHAQUE SORTIE PHYSIQUE  *
      * *    DU PROGRAMME. IL ASSURE :                               *
      * *                                                            *
      * *    - LA CONSTITUTION DU MESSAGE EVENTUEL A AFFICHER,       *
      * *    - L'IDENTIFICATION DE LA SORTIE A EFFECTUER, PUIS SON   *
      * *      EXECUTION                                             *
      * *                                                            *
      * *============================================================*
       30000-TRAIT-SORTIE            SECTION.
           MOVE WS-TRAIT-PARM   TO LS-TRAIT-PARM.
      *
           PERFORM 31000-PREP-MSGERR.
      *
           IF  MSTD-MESS  NOT = SPACE
               MOVE MSTD-MESS   TO LS-MESS
           END-IF.
      *
           IF  WS-SORTIE = 'AB'
               PERFORM 90000-TRAIT-ERROR
           END-IF.
      *
           IF  WS-SORTIE = 'EM'
               PERFORM 32000-SOR-ENVOI-MESS
           END-IF.
      *
           IF  WS-SORTIE = 'EO'
               PERFORM 33000-SOR-CMDE-USER
           END-IF.
      *
           IF  WS-SORTIE = 'ET'
               PERFORM 34000-SOR-ENCH-TRAITSUIV
           END-IF.
      *
           IF  WS-SORTIE = 'AF'
               PERFORM 35000-SOR-APPEL-DEBR-FONC
           END-IF.
      *
           IF  WS-SORTIE = 'AE' OR = 'AS'
               PERFORM 36000-SOR-APPEL-ECRSRV
           END-IF.
      *
           IF  WS-SORTIE = 'RF' OR 'RE' OR 'RS'
               PERFORM 37000-SOR-RETOUR-DEBR
           END-IF.
      *
           PERFORM 38000-SOR-RETOUR.
           EJECT
      *$XINCLUDE ZSTDST3100PA                        STDST3100PA        INL
      * *============================================================*  00010023
      * *============================================================*  00020023
      * *============================================================*  00030023
      * *============================================================*  00040023
      * *============================================================*  00050023
      * *============================================================*  00060023
      * * DON'T FORGET PRECOMPILATION !!!!                           *  00070033
      * *------------------------------------------------------------*  00080023
      * *                                                            *  00090023
      * *  - WARNING : THIS MODULE MUST BE PRECOMPILED TO BE         *  00100033
      * *    USED AS A COPY IN SUBROUTINES                           *  00110033
      * *    NAME OF MODULE FOR PRECOMPILATION ---> ST3100TR         *  00120033
      * *    USE ---> COB2TRN                                        *  00130033
      * *                                                            *  00140023
      * *============================================================*  00150023
      * *============================================================*  00160023
      * *============================================================*  00170023
      * *============================================================*  00180023
      * *============================================================*  00190023
      * *============================================================*  00200023
      * *============================================================*  00210000
      * * 31000     I ERROR MESSAGE PREPARATION                      *  00220033
      * *------------------------------------------------------------*  00230000
      * *                                                            *  00240000
      * *  IF A NUMBER OF ERROR MESSAGE IS REFERENCED DURING         *  00250033
      * *  PROCESSING, THERE IS A CALL OF MESSAGE MANAGING           *  00260033
      * *  PROGRAM TO :                                              *  00270033
      * *                                                            *  00280000
      * *  - SEARCH FOR THE MESSAGE'S DESCRIPTION                    *  00290033
      * *  - INSERT PARAMETERS                                       *  00300033
      * *                                                            *  00310000
      * *============================================================*  00320000
       31000-PREP-MSGERR               SECTION.                         00330000
      *                                                                 00340030
      * *------------------------BLANK PUT IN MESSAGE'S DESCRIPTION     00350033
           IF  MSTD-LIBMESS NOT = SPACE                                 00360030
               MOVE SPACE       TO MSTD-LIBMESS                         00370030
           END-IF.                                                      00380030
      *                                                                 00390030
      * *------------------------NO MESSAGE PRODUCED                    00400033
           IF  MSTD-NOMESS      = SPACE                                 00410030
               GO TO 31000-PREP-MSGERR-SUITE                            00420030
           END-IF.                                                      00430030
      *                                                                 00440000
      * *------------------------MESSAGE'S NUMBER PRODUCED BY PROCESSING00450033
           COMPUTE MSTD-LG       = (MESR-NBMAX * 80) + 157.             00460007
           MOVE STDP-NOM-FONC   TO MSTD-NOM-FONC.                       00470000
           MOVE ACCEPT-ERR-OUI  TO ACCEPT-PGMIDERR.                     00480003
      *                                                                 00490000
           EXEC CICS HANDLE ABEND                                       00500009
                     CANCEL                                             00510009
           END-EXEC.                                                    00520009
      *                                                                 00530009
      *$     EXEC CICS LINK PROGRAM  (WS-STDMSG-SUBR)                   00540002
      *$                    COMMAREA (MSTD-DATA)                        00550000
      *$                    LENGTH   (MSTD-LG)                          00560000
      *$                    NOHANDLE                                    00570008
      *$     END-EXEC.                                                  00580000
      *                                                                 00590003
           PERFORM 90000-CONDERR-TEST.                                  00600003
      *                                                                 00610003
           EXEC CICS HANDLE ABEND                                       00620018
                     RESET                                              00630018
           END-EXEC.                                                    00640018
      *                                                                 00650018
      * *------------------------PROGRAM FOR MANAGING ERRORS DISABLED   00660033
           IF PGMIDERR                                                  00670003
              MOVE SPACE                 TO MSTD-NOMESS                 00680019
              MOVE SPACE                 TO MSTD-FIL                    00690019
              MOVE WS-STDMSG-MSG         TO MSTD-LIBMESS                00700019
              MOVE 'CICS'                TO STDER-TYPE-ERREUR           00710021
              GO TO 31000-PREP-MSGERR-SUITE                             00720010
           END-IF.                                                      00730009
      *                                                                 00740000
      * *------------------------PROGRAM ERROR                          00750033
           IF MSTD-RETOUR = '08'                                        00760006
              MOVE 'AB'                  TO WS-SORTIE                   00770006
              GO TO 31000-PREP-MSGERR-FIN                               00780017
           END-IF.                                                      00790009
      *                                                                 00800000
       31000-PREP-MSGERR-SUITE.                                         00810010
           IF   STDER-TYPE-ERREUR NOT = SPACE  AND                      00820029
                STDER-TYPE-ERREUR NOT = 'APPL' AND                      00830032
                STDER-TYPE-ERREUR NOT = 'STAT'                          00831032
                MOVE 'AB'                TO WS-SORTIE                   00840027
           END-IF.                                                      00850013
      *                                                                 00860015
           PERFORM 90000-ENREG-ERROR.                                   00870012
      *                                                                 00880010
       31000-PREP-MSGERR-FIN.                                           00890010
           EXIT.                                                        00900000
      *                                                                 00910000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3200PA                        STDST3200PA        INL
      * *============================================================*  00010000
      * * 32000     I EXIT   SEND MESSAGE                            *  00020049
      * *------------------------------------------------------------*  00030000
      * *  THIS PROCESSING ACTIVATES STANDARD FIELDS FILLING AND     *  00040049
      * *  PHYSICAL MESSAGE'S PREPARATION ; IT SEARCHES IN STATES'   *  00050049
      * *  DIAGRAM FOR THE 1ST LINE OF THE SCREEN/STATE TO BE        *  00060049
      * *  DISPLAYED ; THEN IT DISPLAYS THE PHYSICAL MESSAGE         *  00070049
      * *  VIA BMS.                                                  *  00080049
      * *============================================================*  00090000
       32000-SOR-ENVOI-MESS            SECTION.                         00100000
           PERFORM 32100-MOUV-CHAMPS-STD.                               00110024
           PERFORM 32200-PREP-MESS-PHYSIQUE.                            00120024
      *                                                                 00130024
           IF LS-ENC-ECET                  NOT = LS-PREC-ECET OR        00140028
              LS-MESS-NUM                      = 'ST9601'               00150029
              MOVE SPACE                TO LS-PREC-TF                   00160025
           END-IF.                                                      00170014
      *                                                                 00180024
           MOVE SPACE                   TO LS-MESS.                     00190027
           MOVE LS-FONC-ENC             TO LS-FONC-PREC.                00200046
           MOVE 1                       TO MTRA-IND.                    00210027
      *                                                                 00220021
       32000-RECH-ECRETAT.                                              00230021
           IF  MTRA-IND                        > MTRA-NBMAX             00240027
               GO TO 32000-RECH-ECRETAT-KO                              00250021
           END-IF.                                                      00260021
      *                                                                 00270021
           IF  MTRA-ECET (MTRA-IND)        NOT = WS-ENC-ECET            00280026
               ADD 1                    TO MTRA-IND                     00290021
               GO TO 32000-RECH-ECRETAT                                 00300021
           END-IF.                                                      00310021
      *                                                                 00320021
           IF  WS-TOPERMAP                     = 'N'                    00330042
               EXEC CICS SEND MAP     (STDP-MAP (STDP-IND))             00340027
                              FROM    (STDMSP-MSP)                      00350027
                              DATAONLY                                  00360027
                              CURSOR                                    00370027
                              NOHANDLE                                  00380027
               END-EXEC                                                 00390027
               PERFORM 90000-CONDERR-TEST                               00400032
               GO TO 32000-RECH-ECRETAT-FIN                             00410027
           END-IF.                                                      00420027
      *                                                                 00430027
           IF  MTRA-TYPE-ECET (MTRA-IND)   NOT = 'NE'                   00440027
               EXEC CICS SEND MAP     (STDP-MAP (STDP-IND))             00450027
                              FROM (STDMSP-MSP)                         00460027
                              ERASE                                     00470027
                              CURSOR                                    00480027
                              NOHANDLE                                  00490027
               END-EXEC                                                 00500027
               PERFORM 90000-CONDERR-TEST                               00510032
               GO TO 32000-RECH-ECRETAT-FIN                             00520027
           END-IF.                                                      00530027
      *                                                                 00540027
           MOVE LENGTH OF WS-ZONTRAV    TO WS-ZONRECB-LONG.             00550028
           MOVE ACCEPT-ERR-OUI          TO ACCEPT-LENGERR.              00560032
      *                                                                 00570032
           EXEC CICS RECEIVE BUFFER INTO   (WS-ZONTRAV)                 00580028
                                    LENGTH (WS-ZONRECB-LONG)            00590028
                                    ASIS                                00600028
                                    NOHANDLE                            00610028
           END-EXEC.                                                    00620028
      *                                                                 00630028
           PERFORM 90000-CONDERR-TEST.                                  00640032
           IF LENGERR                                                   00650032
              MOVE LENGTH OF WS-ZONTRAV TO WS-ZONRECB-LONG              00660032
           END-IF.                                                      00670032
      *                                                                 00680032
      *$   CALL WS-ST6000-PGM USING WS-ZONTRAV                          00690034
      *$                            WS-ZONRECB-LONG.                    00700034
      *                                                                 00710028
           EXEC CICS SEND FROM   (WS-ZONTRAV)                           00720028
                          LENGTH (WS-ZONRECB-LONG)                      00730028
                          ERASE                                         00740029
                          NOHANDLE                                      00750028
           END-EXEC.                                                    00760028
           PERFORM 90000-CONDERR-TEST.                                  00770032
      *                                                                 00780028
           EXEC CICS SEND MAP     (STDP-MAP (STDP-IND))                 00790027
                          FROM    (STDMSP-MSP)                          00800027
                          CURSOR                                        00810027
                          NOHANDLE                                      00820027
           END-EXEC.                                                    00830027
           PERFORM 90000-CONDERR-TEST.                                  00840032
      *                                                                 00850000
       32000-RECH-ECRETAT-FIN.                                          00860027
           EXEC CICS RETURN TRANSID  (STDP-CODE-TRN)                    00870016
                            COMMAREA (LS-COMMAREA)                      00880009
                            LENGTH   (WS-LGCOM)                         00890010
           END-EXEC.                                                    00900000
      *                                                                 00910000
       32000-RECH-ECRETAT-KO.                                           00920028
           MOVE LS-ENC-FONC             TO MSTD-PMESS (1).              00930028
           MOVE WS-ENC-ECET             TO MSTD-PMESS (2).              00940028
           MOVE 'ST9304'                TO MSTD-NOMESS.                 00950028
           MOVE 'PRIN'                  TO STDER-TYPE-ERREUR.           00960041
           PERFORM 31000-PREP-MSGERR.                                   00970039
           PERFORM 90000-TRAIT-ERROR.                                   00980040
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3200PB                        STDST3200PB        INL
      * *============================================================*  00010000
      * * 32100     I PREPARATION OF SCREEN'S STANDARD FIELDS       *   00020059
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  THIS PROCESSING SEARCHES FOR THE NAME OF THE SCREEN THAT  *  00050059
      * *  WILL BE DISPLAYED, AND ALLOWS THE FILLING OF SCREEN'S     *  00060059
      * *  FIELDS WHICH ARE REFERENCING A KNOWN VARIABLE.            *  00070059
      * *                                                            *  00080000
      * *============================================================*  00090000
       32100-MOUV-CHAMPS-STD           SECTION.                         00100000
           MOVE 1                       TO STDP-IND.                    00110030
      *                                                                 00120000
       32100-RECH-ECR.                                                  00130000
           IF  STDP-IND > STDP-NBMAX                                    00140000
               MOVE WS-ENC-EC           TO MSTD-PMESS (1)               00150030
               MOVE 'ST9103'            TO MSTD-NOMESS                  00160030
               MOVE 'PRIN'              TO STDER-TYPE-ERREUR            00170036
               PERFORM 31000-PREP-MSGERR                                00180033
               PERFORM 90000-TRAIT-ERROR                                00190034
           END-IF.                                                      00200030
      *                                                                 00210000
           IF  STDP-NUMECR (STDP-IND)  NOT = WS-ENC-EC                  00220030
               ADD 1                    TO STDP-IND                     00230030
               GO TO 32100-RECH-ECR                                     00240017
           END-IF.                                                      00250017
      *                                                                 00260000
      * *------------------------LOAD FIELDS / VARIABLES                00270059
      *                                                                 00280000
           MOVE  WAAAAMMJJ              TO  STDMSP-V-A-VALEUR.          00290022
           MOVE  WS-DQTRT-X             TO  STDMSP-V-B-VALEUR.          00300022
           IF  STDP-TEMPS (STDP-IND) NOT = SPACE                        00310000
               MOVE  EIBTIME            TO  WS-EIBTIME                  00320000
               MOVE  WS-INFO-HEURE      TO  STDMSP-V-C-VALEUR           00330022
           ELSE                                                         00340022
               MOVE  SPACE              TO  STDMSP-V-C-VALEUR           00350022
           END-IF.                                                      00360022
           MOVE  SPACE                  TO  STDMSP-V-D-VALEUR.          00370022
           MOVE  SPACE                  TO  STDMSP-V-E-VALEUR.          00380022
           MOVE  SPACE                  TO  STDMSP-V-F-VALEUR.          00390022
           MOVE  WS-USER-ID             TO  STDMSP-V-G-VALEUR.          00400022
           MOVE  SPACE                  TO  STDMSP-V-H-VALEUR.          00410022
           MOVE  SPACE                  TO  STDMSP-V-I-VALEUR.          00420022
           MOVE  SPACE                  TO  STDMSP-V-J-VALEUR.          00430022
           MOVE  STDP-LIBECR (STDP-IND) TO  STDMSP-V-M-VALEUR.          00440022
           MOVE  STDP-NOMECR (STDP-IND) TO  STDMSP-V-N-VALEUR.          00450022
           MOVE  WS-TS-TRMID            TO  STDMSP-V-O-VALEUR.          00460038
           MOVE  WS-TERM-PRINTER        TO  STDMSP-V-P-VALEUR.          00470055
           MOVE  WS-SESS-IDCICS         TO  STDMSP-V-S-VALEUR.          00480057
           MOVE  SPACE                  TO  STDMSP-V-T-VALEUR.          00490022
           MOVE  SPACE                  TO  STDMSP-V-U-VALEUR.          00500022
           MOVE  LS-MESS                TO  STDMSP-V-X-VALEUR.          00510029
      *                                                                 00520000
      * *------------------------CREATION OF ACTION LINE                00530059
      *                                                                 00540000
           IF STDP-LIGACT (STDP-IND) NOT = SPACE                        00550000
              PERFORM 85000-PREP-LIBACTION                              00560041
           END-IF.                                                      00570041
      *                                                                 00580000
      * *------------------------MANAGEMENT OF DYNAMIC ATTRIBUTES       00590059
      *                                                                 00600000
           PERFORM 65050-MEMORIS-ATTR.                                  00610024
           PERFORM 65100-SAUVE-DESCRIPTEUR.                             00620028
      *                                                                 00630041
      * *------------------------FIELDS FORCED TO MDT ON                00640059
      *                                                                 00650041
           PERFORM 65150-FORCE-MDTON.                                   00660053
      *                                                                 00670053
           IF WS-TOPMDTON-ALL            = '1'                          00680053
              MOVE 1                    TO MDSC-IND-CHP                 00690044
              PERFORM UNTIL MDSC-IND-CHP > WS-EN-NBCHPS                 00700044
                SET WS-DSC-ATTR-IND     TO 1                            00710046
                SEARCH WS-DSC-ATTR-LIGNE                                00720047
                  AT END                                                00730046
                     CONTINUE                                           00740046
                  WHEN WS-DSC-ATTR-MDTOFF (WS-DSC-ATTR-IND) =           00750046
                                        WS-DSC-ATTRIBUT (MDSC-IND-CHP)  00760046
                     MOVE WS-DSC-ATTR-MDTON  (WS-DSC-ATTR-IND) TO       00770046
                                        WS-DSC-ATTRIBUT (MDSC-IND-CHP)  00780044
                END-SEARCH                                              00790046
                ADD 1                   TO MDSC-IND-CHP                 00800044
              END-PERFORM                                               00810044
              PERFORM 65250-RESTIT-ATTR                                 00820044
           END-IF.                                                      00830040
      *                                                                 00840000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4351LIBR  FADR201 STDFADR201W%=32200 INL
      * *============================================================*
      * *     I FORM THE PHYSICAL MESSAGE       GENERATED : 21-08-00 *
      * *============================================================*
       32200-PREP-MESS-PHYSIQUE            SECTION.
      *
           IF  WS-ENC-EC  = '01'
      *        CALL 'ST50CICS'      USING DFHEIBLK
      *                                   DFHCOMMAREA
      *                                   STDMSP-OUT
      *                                   STDMSP-MSP
      *                                   ADR201-MSGI
      *                                   ADR201-MDSC
      *                                   STDMSP-ZTRAV
      *                                   STDMSP-VARIABLES
      *                                   DFHCOMMAREA
               GO TO 32200-PREP-MESS-PHYSIQUE-FIN.
      *
       32200-PREP-MESS-PHYSIQUE-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3300PA                        STDST3300PA        INL
      * *============================================================*  00010000
      * * 33000     I CHAINING EXECUTION WHEN USER'S COMMAND         *  00020035
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  AT END OF FUNC., THIS PROCESSING ALLOWS ENTERED/PROGRAMED *  00050035
      * *  CHAINING TO HAVE A HIGHER PRIORITY THAN OTHER SFD'S       *  00060035
      * *  FUNCTION/PROC. CHAINING.                                  *  00070035
      * *                                                            *  00080035
      * *                                                            *  00090000
      * *============================================================*  00100000
       33000-SOR-CMDE-USER           SECTION.                           00110000
           PERFORM 90000-ERASE.                                         00120022
           PERFORM 90000-ERASE-TSDES.                                   00130022
           PERFORM 90000-ERASE-TSCTX.                                   00140022
      *                                                                 00150022
           MOVE LS-ENC-FONC           TO LS-RAPPEL-FONC.                00160032
           MOVE SPACE                 TO LS-PREC-TF.                    00170016
           MOVE LS-FONC-ENC           TO LS-FONC-PREC.                  00180022
           MOVE SPACE                 TO LS-FONC-ENC                    00190032
                                         LS-PFACT-PHASE.                00200032
      *                                                                 00210016
           MOVE WS-FONCSVT-IDOPE      TO LS-ENC-FONC.                   00220031
           MOVE 'EX'                  TO LS-ENC-ENFONC.                 00230016
      *                                                                 00240016
           IF  WS-ENCH-LGPARM         = -1                              00250028
               EXEC CICS RETURN TRANSID  (LS-ENC-FONC)                  00260028
                                IMMEDIATE                               00270028
                                COMMAREA (LS-COMMAREA)                  00280028
                                LENGTH   (WS-LGCOM)                     00290028
               END-EXEC                                                 00300028
           END-IF.                                                      00310028
      *                                                                 00320006
           PERFORM 90000-ERASE-TSFONC.                                  00330033
           IF  WS-ENCH-LGPARM         >  0                              00340028
               EXEC CICS RETURN TRANSID  (LS-ENC-FONC)                  00350028
                                IMMEDIATE                               00360028
                                COMMAREA (LS-TRAIT-PARM)                00370032
                                LENGTH   (WS-ENCH-LGPARM)               00380028
               END-EXEC                                                 00390028
           END-IF.                                                      00400028
      *                                                                 00410028
           IF  WS-ENCH-LGPARM         =  0                              00420028
               EXEC CICS RETURN TRANSID  (LS-ENC-FONC)                  00430028
                                IMMEDIATE                               00440028
               END-EXEC                                                 00450028
           END-IF.                                                      00460028
      *                                                                 00470028
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3400PA                        STDST3400PA        INL
      * *============================================================*  00010017
      * * 34000     I EXIT   CHAINING NEXT PROCESSING                *  00020045
      * *------------------------------------------------------------*  00030017
      * *                                                            *  00040017
      * *  THIS PROCESSING IS ACTIVATED IF THE TRANSITION NEEDS      *  00050045
      * *  CHAINING ANOTHER PROGRAM.                                 *  00060045
      * *  SO THIS PROCESSING :                                      *  00061045
      * *  - INITIALIZES THE VARIABLES NECESSARY TO EXECUTE THE      *  00070045
      * *    NEXT PROGRAM,                                           *  00080045
      * *  - TRANSFERS CONTROL TO THE NEXT PROGRAM                   *  00090045
      * *    (RETURN TRANSID IMMEDIATE).                             *  00100017
      * *============================================================*  00120017
       34000-SOR-ENCH-TRAITSUIV        SECTION.                         00130017
      *                                                                 00140017
           MOVE SPACE               TO LS-PREC-TF.                      00150030
      *                                                                 00160017
           IF  WS-NECRN                NOT = 'EX'                       00170040
               MOVE MTRA-TRN-EM1 (MTRA-IND)                             00180038
                                    TO WS-ZINQUIRE-TRANID               00190038
               PERFORM 60000-RECHERCHE-TRANID                           00200038
               IF  WS-ZINQUIRE-STATUST NOT = 23                         00210040
                   MOVE 'CICS'      TO STDER-TYPE-ERREUR                00220040
                   PERFORM 31000-PREP-MSGERR                            00230040
                   PERFORM 90000-TRAIT-ERROR                            00240040
               END-IF                                                   00250040
               PERFORM 60000-RECHERCHE-PGRMID                           00260040
               EXEC CICS RETURN TRANSID  (MTRA-TRN-EM1 (MTRA-IND))      00270017
                                IMMEDIATE                               00280017
                                COMMAREA (LS-COMMAREA)                  00290018
                                LENGTH   (WS-LGCOM)                     00300020
               END-EXEC                                                 00310017
           END-IF.                                                      00320017
      *                                                                 00330017
      * *------------------------NEW PHASE IN FUNCTIONAL PROCEDURE      00340045
      *                                                                 00350037
           MOVE SPACE               TO LS-ENC-FONCTION.                 00360024
      *                                                                 00370017
           IF WS-PFACT-NPHASE              = SPACE                      00380040
              IF WS-PFSVT-CODE             = SPACE                      00390040
                 PERFORM 38000-SOR-RETOUR                               00400043
              ELSE                                                      00410022
                 MOVE WS-PFSVT-CODE TO LS-ENC-PF                        00420024
                 MOVE SPACE         TO WS-PFACT                         00430024
                 MOVE 'PI'          TO WS-PFACT-APPEL                   00440024
                 PERFORM 80000-PILOTE-PF                                00450029
                 IF WS-SORTIE              = 'AB'                       00460040
                    PERFORM 31000-PREP-MSGERR                           00470035
                    PERFORM 90000-TRAIT-ERROR                           00480034
                 END-IF                                                 00490024
                 MOVE WS-PFACT-FONC TO LS-ENC-FONC                      00500024
                 MOVE SPACE         TO LS-RAPPEL-FONC                   00510044
              END-IF                                                    00520024
           ELSE                                                         00530024
              MOVE WS-PFACT-FONC    TO LS-ENC-FONC                      00540028
           END-IF.                                                      00550024
      *                                                                 00560017
           MOVE LS-ENC-FONC         TO WS-FONCSVT-IDOPE.                00570041
           MOVE LS-TRAIT-PARM       TO WS-TRAIT-PARM.                   00580041
      *                                                                 00590043
           PERFORM 80000-CONTROLE-ENCH.                                 00600041
           IF WS-SORTIE                    = 'EM'                       00610042
               PERFORM 31000-PREP-MSGERR                                00620042
               MOVE MSTD-MESS       TO LS-MESS                          00630043
               PERFORM 38000-SOR-RETOUR                                 00640042
           END-IF.                                                      00650042
           IF WS-SORTIE                    = 'AB'                       00660042
               PERFORM 31000-PREP-MSGERR                                00670042
               PERFORM 90000-TRAIT-ERROR                                00680042
           END-IF.                                                      00690042
      *                                                                 00700043
           MOVE WS-TRAIT-PARM       TO LS-TRAIT-PARM.                   00710041
      *                                                                 00720041
           MOVE 'EX'                TO LS-ENC-ENFONC.                   00730025
           MOVE LS-ENC-FONC         TO WS-ZINQUIRE-TRANID.              00740038
           PERFORM 60000-RECHERCHE-TRANID.                              00750038
           IF WS-ZINQUIRE-STATUST      NOT = 23                         00760040
              MOVE 'CICS'           TO STDER-TYPE-ERREUR                00770040
              PERFORM 31000-PREP-MSGERR                                 00780040
              PERFORM 90000-TRAIT-ERROR                                 00790040
           END-IF.                                                      00800040
           PERFORM 60000-RECHERCHE-PGRMID.                              00810040
      *                                                                 00820038
           EXEC CICS RETURN TRANSID  (LS-ENC-FONC)                      00830024
                            IMMEDIATE                                   00840017
                            COMMAREA (LS-COMMAREA)                      00850018
                            LENGTH   (WS-LGCOM)                         00860020
           END-EXEC.                                                    00870017
      *                                                                 00880017
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3500PA                        STDST3500PA        INL
      * *============================================================*  00010028
      * * 35000     I EXIT    CALL FUNCTION                          *  00020047
      * *------------------------------------------------------------*  00030028
      * *                                                            *  00040028
      * *  THIS MODULE    :                                          *  00050047
      * *  - CALLS PREPARATION BEFORE CALLING FUNCTION, BUT ONLY     *  00060047
      * *    IF THE CALLED FUNCTION IS NOT STANDARD,                 *  00070047
      * *  - CALLS PROGRAM CONTEXT RECOVERY,                         *  00080047
      * *  - INITIALIZES VARIABLES NECESSARY FOR EXECUTION OF        *  00090047
      * *    THE CALLED FUNCTION,                                    *  00100047
      * *  - CALLS THE FUNCTION (RETURN TRANSID IMMEDIATE).          *  00110047
      * *                                                            *  00120028
      * *============================================================*  00130028
       35000-SOR-APPEL-DEBR-FONC             SECTION.                   00140028
           MOVE  SPACE               TO  LS-PREC-TF.                    00150036
           MOVE  MTRA-IND            TO  LS-ENCH-ICOURS.                00160028
      *                                                                 00170032
           PERFORM 65000-SAUVE-CONTEXTE-PGM.                            00180028
      *                                                                 00190028
           IF  MTRA-TYPE-TRANSIT (MTRA-IND)      = 'S'                  00200040
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STPF01     00210041
                   MOVE WS-CTRLET    TO LS-TRAIT-PARM                   00220041
               END-IF                                                   00230041
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-AIDK       00240041
      *            MOVE STDP-MAPS (STDP-IND)                            00250045
      *                              TO LS-TRAIT-PARM                   00250145
                   MOVE WS-CTRLET    TO LS-TRAIT-PARM                   00251045
               END-IF                                                   00270041
           END-IF.                                                      00280040
      *                                                                 00290040
           IF  MTRA-TYPE-TRANSIT (MTRA-IND)  NOT = 'S'                  00300044
               PERFORM 35100-PREP-DEBR-FONC                             00310044
               MOVE WS-TRAIT-PARM    TO LS-TRAIT-PARM                   00320044
           END-IF.                                                      00330044
      *                                                                 00340044
           MOVE LS-FONC-ENC          TO LS-FONC-PREC.                   00350028
           MOVE WS-TRAIT-NOM         TO LS-ENC-FONC.                    00360039
           MOVE 'AF'                 TO LS-ENC-ENFONC.                  00370033
           MOVE SPACE                TO LS-RAPPEL-FONC.                 00380041
      *                                                                 00390028
           MOVE LS-ENC-FONC          TO WS-ZINQUIRE-TRANID.             00400042
           PERFORM 60000-RECHERCHE-TRANID.                              00410042
           IF WS-ZINQUIRE-STATUST            NOT = 23                   00420043
              MOVE 'CICS'            TO STDER-TYPE-ERREUR               00430043
              PERFORM 31000-PREP-MSGERR                                 00440043
              PERFORM 90000-TRAIT-ERROR                                 00450043
           END-IF.                                                      00460043
           PERFORM 60000-RECHERCHE-PGRMID.                              00470043
      *                                                                 00480042
           EXEC CICS RETURN TRANSID  (LS-ENC-FONC)                      00490038
                            IMMEDIATE                                   00500028
                            COMMAREA (LS-COMMAREA)                      00510029
                            LENGTH   (WS-LGCOM)                         00520031
           END-EXEC.                                                    00530028
      *                                                                 00540028
      *$XENDINCLUDE
      *$XINCLUDE XGENFADR201 PROC  4361LIBR  FADR201 MODFADR201X%=35100 INL
      * *============================================================*
      * *           I CALL FUNCTIONS            GENERATED : 03-12-98 *
      * *============================================================*
       35100-PREP-DEBR-FONC                SECTION.
      *
           MOVE 'APPELDEB'     TO STDER-BOITE.
      *
           EXIT.
      *
       35100-PREPDEBR-FONC-USER-FIN.
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3600PA                        STDST3600PA        INL
      * *============================================================*  00010015
      * * 36000     I EXIT   CALL SCREEN  /  CALL SERVICE            *  00020032
      * *------------------------------------------------------------*  00030015
      * *                                                            *  00040015
      * *  THIS FUNCTION  :                                          *  00050032
      * *  - SEARCHES FOR NAME OF THE PROGRAM PROCESSING SCREEN      *  00060033
      * *    OR SERVICE                                              *  00070033
      * *  - CALLS THE PROGRAM (RETURN TRANSID IMMEDIATE)            *  00080033
      * *                                                            *  00090015
      * *============================================================*  00100015
       36000-SOR-APPEL-ECRSRV                SECTION.                   00110015
      *                                                                 00120015
           MOVE  SPACE                    TO LS-PREC-TF.                00130026
           MOVE  MTRA-IND                 TO LS-ENCH-ICOURS.            00140024
      *                                                                 00150018
           PERFORM 65000-SAUVE-CONTEXTE-PGM.                            00160015
      *                                                                 00170015
           MOVE LS-FONC-ENC               TO LS-FONC-PREC.              00180024
           MOVE MTRA-PGM-TRAIT (MTRA-IND) TO LS-ENC-PROG.               00190024
           MOVE MTRA-TRAIT-NOM (MTRA-IND) TO LS-ENC-ECET.               00200021
           MOVE '01'                      TO LS-ENC-ET.                 00210029
           MOVE WS-SORTIE                 TO LS-ENC-ENFONC.             00220024
      *                                                                 00230015
           MOVE MTRA-TRN-TRAIT1(MTRA-IND) TO WS-ZINQUIRE-TRANID.        00240027
           PERFORM 60000-RECHERCHE-TRANID.                              00250027
           IF WS-ZINQUIRE-STATUST          NOT = 23                     00260028
              MOVE 'CICS'                 TO STDER-TYPE-ERREUR          00270028
              PERFORM 31000-PREP-MSGERR                                 00280028
              PERFORM 90000-TRAIT-ERROR                                 00290028
           END-IF.                                                      00300028
           PERFORM 60000-RECHERCHE-PGRMID.                              00310028
      *                                                                 00320027
           EXEC CICS RETURN TRANSID  (MTRA-TRN-TRAIT1(MTRA-IND))        00330021
                            IMMEDIATE                                   00340015
                            COMMAREA (LS-COMMAREA)                      00350022
                            LENGTH   (WS-LGCOM)                         00360023
           END-EXEC.                                                    00370015
      *                                                                 00380015
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3700PA                        STDST3700PA        INL
      * *============================================================*  00010000
      * * 37000       I EXIT  RETURN AFTER CALL                      *  00020013
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  FUNCTION ACTIVATED WHEN RETURN TO THE CALLING PROGRAM     *  00050013
      * *  (END EXECUTION OF A CALLED FUNCTION, A CALLED SCREEN,     *  00060013
      * *   A CALLED SERVICE)                                        *  00070013
      * *  - INITIALIZES THE VARIABLES NECESSARY TO EXECUTE THE      *  00080013
      * *    CALLING PROGRAM,                                        *  00090013
      * *  - TRANSFERS THE CONTROL TO THE CONCERNED PROGRAM          *  00100013
      * *    (RETURN TRANSID IMMEDIATE).                             *  00110009
      * *                                                            *  00120009
      * *============================================================*  00130000
       37000-SOR-RETOUR-DEBR           SECTION.                         00140000
           MOVE LS-FONC-ENC            TO LS-FONC-PREC.                 00150003
           MOVE WS-NETAT               TO LS-PREC-RESU.                 00160004
           MOVE SPACE                  TO LS-PREC-TF.                   00170010
           MOVE SPACE                  TO LS-ENC-FONCTION.              00180009
           MOVE WS-SORTIE              TO LS-ENC-ENFONC.                00190009
      *                                                                 00200000
           MOVE LS-ENCH-TRNSAUV        TO WS-ZINQUIRE-TRANID.           00210011
           PERFORM 60000-RECHERCHE-TRANID.                              00220011
           IF WS-ZINQUIRE-STATUST          NOT = 23                     00230012
              MOVE 'CICS'              TO STDER-TYPE-ERREUR             00240012
              PERFORM 31000-PREP-MSGERR                                 00250012
              PERFORM 90000-TRAIT-ERROR                                 00260012
           END-IF.                                                      00270012
           PERFORM 60000-RECHERCHE-PGRMID.                              00280012
      *                                                                 00290011
           EXEC CICS RETURN TRANSID  (LS-ENCH-TRNSAUV)                  00300009
                            IMMEDIATE                                   00310009
                            COMMAREA (LS-COMMAREA)                      00320009
                            LENGTH   (WS-LGCOM)                         00330009
           END-EXEC.                                                    00340000
      *                                                                 00350000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST3800PA                        STDST3800PA        INL
      * *============================================================*  00010002
      * * 38000     I EXIT  RETURN   "RM"                            *  00020026
      * *------------------------------------------------------------*  00030002
      * *                                                            *  00040002
      * *  THIS FUNCTION ALLOWS TO RETURN TO A BLANK SCREEN WITHOUT  *  00050027
      * *  PROGRAM'S  ABEND                                          *  00060026
      * *                                                            *  00070002
      * *============================================================*  00080002
       38000-SOR-RETOUR                SECTION.                         00090020
           PERFORM 90000-ERASE.                                         00100002
           PERFORM 90000-ERASE-TSDES.                                   00110012
           PERFORM 90000-ERASE-TSCTX.                                   00120017
           PERFORM 90000-ERASE-TSFONC.                                  00130013
           PERFORM 90000-ERASE-TSAUTO.                                  00140019
      *                                                                 00150002
           IF  LS-MESS  NOT = SPACE                                     00160009
               IF  WS-MESSAGE = SPACE                                   00170021
                   MOVE LS-MESS       TO WS-MESSAGE                     00180021
               ELSE                                                     00190021
                   MOVE LS-MESS       TO WS-MESSAGE-MESS                00200021
               END-IF                                                   00210021
               EXEC CICS SEND FROM (WS-MESSAGE)                         00220016
                              LENGTH (166)                              00230024
                              ERASE                                     00240007
               END-EXEC                                                 00250007
           ELSE                                                         00260015
               EXEC CICS SEND CONTROL                                   00270007
                              ERASE                                     00280007
                              FREEKB                                    00290022
               END-EXEC                                                 00300007
           END-IF.                                                      00310007
      *                                                                 00320012
           EXEC CICS RETURN                                             00330002
           END-EXEC.                                                    00340002
      *                                                                 00350002
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6000PA                        STDST6000PA        INL
      * *============================================================*  00010024
      * * 60000     I MANAGEMENT OF ACTIONS SPECIFIC TO THE SITE     *  00020097
      * *------------------------------------------------------------*  00030024
      * *                                                            *  00040024
      * * THIS PROCESSING DEFINES CASES WHEN PRIORITY MUST           *  00050098
      * * BE DONE TO THE PROCESSING ASSOCIATED TO ACTION,            *  00060098
      * * DEPENDING ON POSSIBLE ERRORS DETECTED BY MAPPING           *  00070098
      * * AND/OR BY CONTROL ROUTINES (TABLE/EXIT).                   *  00080098
      * *                                                            *  00090024
      * *============================================================*  00100024
       60000-GESTION-ACTION          SECTION.                           00110024
           IF MTRA-STD-ACTNOM (MTRA-IND)  =  WS-ACTNOM-STPF02 OR        00120063
                                          =  WS-ACTNOM-TPF3   OR        00130061
                                          =  WS-ACTNOM-STPF04 OR        00140060
                                          =  WS-ACTNOM-STPF05 OR        00150074
                                          =  WS-ACTNOM-STLACT OR        00160074
                                          =  WS-ACTNOM-AIDK             00170074
              MOVE 'I'                         TO WS-STATUT-MESSAGE     00180056
              MOVE '1'                         TO WS-TOPMDTON           00190062
           END-IF.                                                      00200053
      *                                                                 00210073
      *--BYPASS DESCRIPTOR'S ANALYSE, IF END OF FUNCTION WITHOUT TASK   00220098
           IF MTRA-TRAIT      (MTRA-IND)  =  SPACE            AND       00230088
              MTRA-NECRN      (MTRA-IND)  =  'EX'                       00240073
              MOVE 'I'                         TO WS-STATUT-MESSAGE     00250073
           END-IF.                                                      00260073
      *                                                                 00270069
      * *============================================================*  00280069
      * * 60000  I SEARCH FOR A FIELD'S INFOR. BASE IDENTIFIER       *  00290097
      * *------------------------------------------------------------*  00300069
      * *                                                            *  00310069
      * *============================================================*  00320069
       60000-RECH-NOM-BI             SECTION.                           00330070
           MOVE SPACE            TO WS-AIDC-NOM-BI.                     00340072
      *                                                                 00350072
           IF  CHPBI-NOM-TABLE    =  SPACE                              00360076
               GO TO 60000-RECH-BI-FIN                                  00370069
           END-IF.                                                      00380069
      *                                                                 00390069
      *------ SEARCH FOR THE I.B. IDENTIFIER--------                    00400097
           SET CHPBI-NOM-IND     TO 1.                                  00410069
      *                                                                 00420069
           SEARCH CHPBI-NOM-LIGNE                                       00430069
             AT END GO TO 60000-TRAIT-CHPOCC                            00440069
             WHEN CHPBI-NOM-DEVT  (CHPBI-NOM-IND)                       00450076
                                  = SPACE                               00460076
               GO TO 60000-TRAIT-CHPOCC                                 00470093
             WHEN CHPBI-NOM-DEVT  (CHPBI-NOM-IND)                       00480069
                                  = WS-AIDC-NOM-CHP                     00490069
               MOVE CHPBI-NOM-BI  (CHPBI-NOM-IND)                       00500077
                                 TO WS-AIDC-NOM-BI                      00510069
               GO TO 60000-RECH-BI-FIN                                  00520093
           END-SEARCH.                                                  00530093
      *                                                                 00540069
      *-------- SEARCH SINCE AN OCCURED FIELD                           00550097
       60000-TRAIT-CHPOCC.                                              00560069
           PERFORM 60000-TRAIT-NOM-CHP.                                 00570070
           SET CHPBI-NOM-IND     TO 1.                                  00580069
      *                                                                 00590069
           SEARCH CHPBI-NOM-LIGNE                                       00600069
             AT END GO TO 60000-RECH-BI-FIN                             00610069
             WHEN CHPBI-NOM-DEVT  (CHPBI-NOM-IND)                       00620076
                                  = SPACE                               00630076
               GO TO 60000-RECH-BI-FIN                                  00640076
             WHEN CHPBI-CHP-NBOCC (CHPBI-NOM-IND) NOT = 1 AND           00650069
                  CHPBI-NOM-DEVT  (CHPBI-NOM-IND)                       00660069
                                  = WS-NOM-CHP                          00670093
               MOVE CHPBI-NOM-BI  (CHPBI-NOM-IND)                       00680077
                                 TO WS-AIDC-NOM-BI                      00690093
           END-SEARCH.                                                  00700093
      *                                                                 00710071
       60000-RECH-BI-FIN.                                               00720069
           EXIT.                                                        00730069
      *                                                                 00740068
      * *============================================================*  00750068
      * * 60000     I PROCESSING NAME OF OCCURED FIELDS              *  00760097
      * *------------------------------------------------------------*  00770068
      * *                                                            *  00780068
      * *  THIS PROCESSING ALLOWS TO DELETE SUFFIX LETTER OF THE     *  00790097
      * *  OCCURED FIELD NAME.                                       *  00800097
      * *                                                            *  00810068
      * *============================================================*  00820068
       60000-TRAIT-NOM-CHP           SECTION.                           00830068
           MOVE WS-AIDC-NOM-CHP  TO WS-NOM-CHPOCC.                      00840070
           MOVE SPACE            TO WS-NOM-CHP.                         00850070
           MOVE 8                TO WS-IND2.                            00860070
      *                                                                 00870068
       60000-TRAIT-SUFFIXE.                                             00880068
           IF  WS-NOM-CHPOCC-CAR (WS-IND2)                              00890070
                                  = SPACE                               00900070
               SUBTRACT 1      FROM WS-IND2                             00910070
               GO TO 60000-TRAIT-SUFFIXE                                00920070
           END-IF.                                                      00930070
      *                                                                 00940068
           SUBTRACT 1          FROM WS-IND2.                            00950070
           MOVE 1                TO WS-IND3.                            00960070
      *                                                                 00970068
       60000-TRAIT-PREFIXE.                                             00980068
           MOVE WS-NOM-CHPOCC-CAR (WS-IND3)                             00990068
                                 TO WS-NOM-CHP-CAR (WS-IND3).           01000070
      *                                                                 01010070
           IF  WS-IND3            < WS-IND2                             01020070
               ADD 1             TO WS-IND3                             01030070
               GO TO 60000-TRAIT-PREFIXE                                01040070
           END-IF.                                                      01050070
      *                                                                 01060091
      * *============================================================*  01070091
      * * 60000     I  SEARCH FOR LINKS BETWEEN FIELDS               *  01080097
      * *------------------------------------------------------------*  01090091
      * *  DECTECTION OF LINKED FIELDS (SFD LINK)                    *  01100097
      * *  FILLING OF USED AREAS IN HELP FIELD                       *  01110097
      * *-FIELD WHERE THE HELP IS DONE                     : OCCURS 1*  01120097
      * *-FIELD LINKED TO "HELPE" FIELD                    : OCCURS 2*  01130097
      * *-FIELD LINKED TO THE FIELD LINKED TO "HELPE" FIELD: OCCURS 3*  01140097
      * *============================================================*  01150091
       60000-ALIM-CHP-LIEN           SECTION.                           01160091
      *-------------------SEARCH OF THE FIELD LINKED TO HELPE FIELD     01170097
           SET WS-LIEN-CHP-IND   TO 1.                                  01180092
      *                                                                 01190093
           SEARCH WS-LIEN-CHP-LIGNE                                     01200091
                  AT END GO TO 60000-ALIM-CHP-LIEN-FIN                  01210094
                  WHEN WS-LIEN-CHP-GAUCHE (WS-LIEN-CHP-IND)             01220093
                                 = SPACE                                01230093
                    GO TO 60000-ALIM-CHP-LIEN-FIN                       01240094
                  WHEN WS-LIEN-CHP-GAUCHE (WS-LIEN-CHP-IND)             01250091
                                 = WS-AIDC-NOM-CHP                      01260093
                    MOVE WS-LIEN-CHP-TYPE (WS-LIEN-CHP-IND)             01270093
                                 TO WS-CTRLET-LIEN                      01280092
                    IF  WS-LIEN-CHP-NBOCC (WS-LIEN-CHP-IND) NOT = 1     01290095
                        PERFORM 60000-TRAIT-NOM-LIEN                    01300095
                        MOVE WS-NOM-CHP                                 01310095
                                 TO WS-LIEN-CHP-WRK                     01320095
                    ELSE                                                01330095
                        MOVE WS-LIEN-CHP-DROITE (WS-LIEN-CHP-IND)       01340095
                                 TO WS-LIEN-CHP-WRK                     01350092
                    END-IF                                              01360095
           END-SEARCH.                                                  01370091
      *                                                                 01380093
           MOVE 2                TO WS-IND1.                            01390092
      *                                                                 01400091
       60000-ALIM-TROISIEME-LIEN.                                       01410091
           SET WS-LIEN-CHP-IND   TO 1.                                  01420092
      *                                                                 01430093
           SEARCH WS-LIEN-CHP-LIGNE                                     01440091
                  AT END GO TO 60000-ALIM-CHP-LIEN-FIN                  01450092
                  WHEN WS-LIEN-CHP-GAUCHE (WS-LIEN-CHP-IND)             01460091
                                 = WS-LIEN-CHP-WRK                      01470092
                    MOVE WS-LIEN-GAUCHE-POS (WS-LIEN-CHP-IND)           01480093
                                 TO WS-CTRLET-POSCHP (WS-IND1)          01490092
                    MOVE WS-LIEN-GAUCHE-LONG (WS-LIEN-CHP-IND)          01500093
                                 TO WS-CTRLET-LGNCHP (WS-IND1)          01510092
                    IF  WS-LIEN-CHP-NBOCC (WS-LIEN-CHP-IND) NOT = 1     01520095
                        PERFORM 60000-TRAIT-NOM-LIEN                    01530095
                        MOVE WS-NOM-CHP                                 01540095
                                 TO WS-LIEN-CHP-WRK                     01550095
                    ELSE                                                01560095
                        MOVE WS-LIEN-CHP-DROITE (WS-LIEN-CHP-IND)       01570095
                                 TO WS-LIEN-CHP-WRK                     01580095
                    END-IF                                              01590095
                    MOVE WS-LIEN-TABLE-CTRL (WS-LIEN-CHP-IND)           01600093
                                 TO WS-CTRLET-TABCTRL (WS-IND1)         01610092
                    MOVE 1     TO WS-IND2                               01620093
                    SET MSGI-CAR-IND                                    01630093
                                 TO WS-CTRLET-POSCHP (WS-IND1)          01640092
                    PERFORM UNTIL WS-IND2 > WS-CTRLET-LGNCHP (WS-IND1)  01650093
                      MOVE MSGI-CAR (MSGI-CAR-IND)                      01660093
                                 TO WS-CTRLET-PARM-C (WS-IND1 WS-IND2)  01670092
                      ADD 1    TO WS-IND2                               01680093
                      SET MSGI-CAR-IND UP BY 1                          01690093
                    END-PERFORM                                         01700093
           END-SEARCH.                                                  01710091
           IF  WS-IND1 < 3                                              01720092
               ADD 1             TO WS-IND1                             01730092
               GO TO 60000-ALIM-TROISIEME-LIEN                          01740092
           END-IF.                                                      01750091
      *                                                                 01760093
       60000-ALIM-CHP-LIEN-FIN.                                         01770091
           EXIT.                                                        01780091
      *                                                                 01790095
      * *============================================================*  01800095
      * * 60000     I PROCESSING NAME OF LINKED OCCURED FIELDS       *  01810097
      * *------------------------------------------------------------*  01820095
      * *                                                            *  01830095
      * *  THIS PROCESSING ALLOWS TO ADD THE SUFFIX LETTER TO THE    *  01840097
      * *  NAME OF LINKED OCCURED FIELD ON THE RIGHT                 *  01850097
      * *                                                            *  01860095
      * *============================================================*  01870095
       60000-TRAIT-NOM-LIEN          SECTION.                           01880095
           MOVE WS-LIEN-CHP-GAUCHE (WS-LIEN-CHP-IND)                    01890095
                                 TO WS-NOM-CHPOCC.                      01900095
           MOVE WS-LIEN-CHP-DROITE (WS-LIEN-CHP-IND)                    01910095
                                 TO WS-NOM-CHP.                         01920095
           MOVE 8                TO WS-IND2.                            01930095
      *                                                                 01940095
       60000-RECH-SUFFIXE.                                              01950095
           IF  WS-NOM-CHPOCC-CAR (WS-IND2)                              01960095
                                  = SPACE                               01970095
               SUBTRACT 1      FROM WS-IND2                             01980095
               GO TO 60000-RECH-SUFFIXE                                 01990095
           END-IF.                                                      02000095
      *                                                                 02010095
           MOVE 8                TO WS-IND3.                            02020095
      *                                                                 02030095
       60000-ALIM-SUFFIXE.                                              02040095
           IF  WS-NOM-CHP-CAR (WS-IND3)                                 02050095
                                  = SPACE                               02060095
               SUBTRACT 1      FROM WS-IND3                             02070095
               GO TO 60000-ALIM-SUFFIXE                                 02080096
           END-IF.                                                      02090095
      *                                                                 02100096
           ADD 1                 TO WS-IND3.                            02110095
      *                                                                 02120095
           IF  WS-IND3        NOT > 8                                   02130095
               MOVE WS-NOM-CHPOCC-CAR (WS-IND2)                         02140095
                                 TO WS-NOM-CHP-CAR (WS-IND3)            02150095
           END-IF.                                                      02160095
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6000PB                        STDST6000PB        INL
      *===============================================================* 00010009
      * 60000       I SERVICE FOR DATE AND TIME TRANSFORMATION        * 00020017
      *---------------------------------------------------------------* 00030009
      *    - CPU DATE TRANSFORMATION     YYDDD   --->  CCYYMMDD       * 00040018
      *    - PROCESS. DATE TRANSFORM.    YYMMDD  --->  CCYYDDD        * 00050018
      *    - DB2 DATE TRANSFORMATION   CCYYMMDD  --->  DD.MM.CCYY     * 00060018
      *    -                         DD.MM.CCYY  --->  CCYYMMDD       * 00070018
      *    - DB2 TIME TRANSFORMATION     HHMMSS  --->  HH.MM.SS       * 00080018
      *                                HH.MM.SS  --->  HHMMSS         * 00090012
      *===============================================================* 00100009
       60000-TRANSF-DATES          SECTION.                             00110009
      *                                                                 00120009
      * *--------------- CPU DATE  YYDDD  --->  CCYYMMDD                00130018
      *                                                                 00140009
           MOVE EIBDATE           TO WS-DAT-AAQQQ.                      00150011
           MOVE ZERO              TO WS-DAT-AAMMJJ.                     00160011
           DIVIDE WS-DAT-Q-AA BY 4 GIVING WS-CPT                        00170011
                  REMAINDER WS-RESTE.                                   00180011
           IF  WS-RESTE        = 0                                      00190011
               MOVE 29            TO WS-TABDATE-JJ (2)                  00200011
           END-IF.                                                      00210009
           PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL WS-IND1 > 12       00220011
              IF  WS-DAT-Q-JJ  > WS-TABDATE-JJ (WS-IND1)                00230011
                  ADD 1           TO WS-DAT-MM                          00240011
                  SUBTRACT WS-TABDATE-JJ (WS-IND1)                      00250011
                                  FROM WS-DAT-Q-JJ                      00260011
              ELSE                                                      00270011
                  NEXT SENTENCE                                         00280009
              END-IF                                                    00290009
           END-PERFORM.                                                 00300009
           ADD  1                 TO  WS-DAT-MM.                        00310011
           MOVE WS-DAT-Q-JJ       TO  WS-DAT-JJ.                        00320011
           MOVE WS-DAT-Q-AA       TO  WS-DAT-AA.                        00330011
           MOVE WS-DAT-AAMMJJ     TO  WS-DTCPU-AMJ.                     00340011
      *                                                                 00350009
      * *--------------- PROCESS. DATE    YYMMDD  --->  CCYYDDD         00360018
      *                                                                 00370009
           MOVE WAAMMJJ           TO  WS-DAT-AAMMJJ.                    00380011
           MOVE ZERO              TO  WS-DAT-AAQQQ.                     00390011
           DIVIDE WS-DAT-AA BY 4 GIVING WS-CPT                          00400011
                  REMAINDER WS-RESTE.                                   00410011
           IF  WS-RESTE        = 0                                      00420011
               MOVE 29            TO  WS-TABDATE-JJ (2)                 00430011
           ELSE                                                         00440011
               MOVE 28            TO  WS-TABDATE-JJ (2)                 00450011
           END-IF.                                                      00460009
           PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL WS-IND1 > 12       00470011
              IF  WS-IND1  NOT > (WS-DAT-MM - 1)                        00480009
                  ADD WS-TABDATE-JJ (WS-IND1)                           00490011
                                  TO  WS-DAT-Q-JJ                       00500011
              ELSE                                                      00510011
                  NEXT SENTENCE                                         00520009
              END-IF                                                    00530009
           END-PERFORM.                                                 00540009
           ADD  WS-DAT-JJ         TO  WS-DAT-Q-JJ.                      00550011
           MOVE WS-DAT-AA         TO  WS-DQTRT-AA.                      00560011
           MOVE WS-DAT-Q-JJ       TO  WS-DQTRT-QQ.                      00570011
      *                                                                 00580012
      * *--------------- DATE       CCYYMMDD  --->  DD.MM.CCYY DB2      00590018
      *                                                                 00600012
       60000-MEF-DATE-DB2          SECTION.                             00610012
           IF  WS-AFFICH-DATE  = LOW-VALUE                              00620014
               MOVE '00010101'    TO  WS-AFFICH-DATE                    00630014
           END-IF.                                                      00640014
      *                                                                 00650014
           IF  WS-AFFICH-SSAA  = 0                                      00660012
               MOVE 1             TO  WS-AFFICH-SSAA                    00670012
           END-IF.                                                      00680012
           MOVE WS-AFFICH-SSAA    TO  WS-DB2-SSAA.                      00690012
      *                                                                 00700012
           IF  WS-AFFICH-MM    = 0                                      00710012
               MOVE 1             TO  WS-AFFICH-MM                      00720012
           END-IF.                                                      00730012
           MOVE WS-AFFICH-MM      TO  WS-DB2-MM.                        00740012
      *                                                                 00750012
           IF  WS-AFFICH-JJ    = 0                                      00760012
               MOVE 1             TO  WS-AFFICH-JJ                      00770012
           END-IF.                                                      00780012
           MOVE WS-AFFICH-JJ      TO  WS-DB2-JJ.                        00790012
           MOVE  '.'              TO  WS-DB2-JJ-POINT                   00792016
                                      WS-DB2-MM-POINT.                  00793016
      *                                                                 00800012
      * *--------------- DB2 DATE DD.MM.CCYY  --->  CCYYMMDD            00810018
      *                                                                 00820012
       60000-MEF-DATE-AFFICH       SECTION.                             00830012
           IF  WS-DB2-DATE     = '01.01.0001' OR                        00840015
                               = SPACE                                  00850015
               MOVE '00.00.0000'  TO  WS-DB2-DATE                       00860013
           END-IF.                                                      00870013
      *                                                                 00880015
           MOVE  WS-DB2-JJ        TO  WS-AFFICH-JJ.                     00890012
           MOVE  WS-DB2-MM        TO  WS-AFFICH-MM.                     00900012
           MOVE  WS-DB2-SSAA      TO  WS-AFFICH-SSAA.                   00910012
      *                                                                 00920012
      * *--------------- TIME         HHMMSS  --->  HH.MM.SS DB2        00930018
      *                                                                 00940012
       60000-MEF-TIME-DB2          SECTION.                             00950012
           IF  WS-AFFICH-TIME  = LOW-VALUE                              00960014
               MOVE 0             TO  WS-AFFICH-TIME                    00970014
           END-IF.                                                      00980014
      *                                                                 00990014
           MOVE WS-AFFICH-TIMHH   TO  WS-DB2-TIMHH.                     01000012
           MOVE WS-AFFICH-TIMMM   TO  WS-DB2-TIMMM.                     01010012
           MOVE WS-AFFICH-TIMSS   TO  WS-DB2-TIMSS.                     01020012
      *                                                                 01030012
      * *--------------- DB2 TIME    HHMMSS  --->  HH.MM.SS             01040018
      *                                                                 01050012
       60000-MEF-TIME-AFFICH       SECTION.                             01060012
           IF  WS-DB2-TIME     = SPACE                                  01070015
               MOVE '00.00.00'    TO  WS-DB2-TIME                       01080015
           END-IF.                                                      01090015
      *                                                                 01100015
           MOVE  WS-DB2-TIMHH     TO  WS-AFFICH-TIMHH.                  01110012
           MOVE  WS-DB2-TIMMM     TO  WS-AFFICH-TIMMM.                  01120012
           MOVE  WS-DB2-TIMSS     TO  WS-AFFICH-TIMSS.                  01130012
      *                                                                 01140012
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6000PC                        STDST6000PC        INL
      *                                                                 00010003
      * *============================================================*  00020003
      * * 60000     I CONTROL OF TRANSACTION CODE'S VALIDITY         *  00030010
      * *------------------------------------------------------------*  00040000
      * *                                                            *  00050000
      * *============================================================*  00060000
       60000-RECHERCHE-TRANID        SECTION.                           00070000
           MOVE SPACE                    TO WS-ZINQUIRE-PGRMID.         00080000
           MOVE ZERO                     TO WS-ZINQUIRE-STATUST.        00090000
      *                                                                 00100000
      *    EXEC CICS INQUIRE TRANSACTION (WS-ZINQUIRE-TRANID)           00110000
      *                      PROGRAM     (WS-ZINQUIRE-PGRMID)           00120000
      *                      STATUS      (WS-ZINQUIRE-STATUST)          00130000
      *                      NOHANDLE                                   00140000
      *    END-EXEC.                                                    00150000
      *                                                                 00160000
           IF  WS-ZINQUIRE-STATUST NOT = 23                             00170000
               MOVE WS-ZINQUIRE-TRANID   TO MSTD-PMESS (1)              00180000
               MOVE 'ST9702'             TO MSTD-NOMESS                 00190000
           END-IF.                                                      00200000
      *                                                                 00210000
      * *============================================================*  00220000
      * * 60000     I CONTROL --> OPERATIONAL PROGRAM                *  00230010
      * *------------------------------------------------------------*  00240000
      * *                                                            *  00250000
      * *============================================================*  00260000
       60000-RECHERCHE-PGRMID        SECTION.                           00270000
           MOVE ZERO                     TO WS-ZINQUIRE-STATUSP.        00280000
      *    EXEC CICS INQUIRE PROGRAM     (WS-ZINQUIRE-PGRMID)           00290000
      *                      STATUS      (WS-ZINQUIRE-STATUSP)          00300000
      *                      NOHANDLE                                   00310000
      *    END-EXEC.                                                    00320000
      *                                                                 00330000
           IF  WS-ZINQUIRE-STATUSP NOT = 23                             00340005
               MOVE WS-ZINQUIRE-PGRMID   TO MSTD-PMESS (1)              00350000
               MOVE 'ST9701'             TO MSTD-NOMESS                 00360000
               MOVE 'CICS'               TO STDER-TYPE-ERREUR           00370000
               PERFORM 31000-PREP-MSGERR                                00380000
               PERFORM 90000-TRAIT-ERROR                                00390000
           END-IF.                                                      00400000
           EJECT                                                        00410002
      *                                                                 00420002
      * *============================================================*  00430002
      * * 60000     I INITIALIZATION OF ARMIDE CALL                  *  00440010
      * *------------------------------------------------------------*  00450002
      * *                                                            *  00460002
      * *============================================================*  00470002
       60000-INITIAL-ARMIDE          SECTION.                           00480002
           INITIALIZE ARM-ARMIDE.                                       00490002
           INITIALIZE ARM-SDT.                                          00500002
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6500PA                        STDST6500PA        INL
      * *============================================================*  00010000
      * * 65000     I PROGRAM CONTEXT BACKUP                         *  00020022
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *    THIS FUNCTION SAVES PROGRAM CONTEXT IN PROGRESS,        *  00050022
      * *    TO RETRIEVE IT WHEN RETURN                              *  00060022
      * *    FROM FUNCTION/SCREEN/SERVICE CALL.                      *  00070022
      * *                                                            *  00080000
      * *============================================================*  00090000
       65000-SAUVE-CONTEXTE-PGM              SECTION.                   00100000
           IF  WS-SORTIE             NOT = 'AS' AND                     00110020
               LS-TSDES-ITEM             < LS-TSCO-ITEM                 00120018
               PERFORM 65050-MEMORIS-ATTR                               00130018
               PERFORM 65100-SAUVE-DESCRIPTEUR                          00140018
           END-IF.                                                      00150018
      *                                                                 00160018
       65000-SAUVE-CONTEXTE-PGM-SUITE.                                  00170018
           MOVE WS-TS-CTXT-NOM       TO WS-TS-NOM.                      00180006
      *                                                                 00190009
           IF  LS-TSCO-IND               < LS-TSCO-ITEM                 00200016
               MOVE LS-TSCO-ITEM     TO LS-TSCO-IND                     00210009
                                        WS-TSCO-ITEM                    00220009
               EXEC CICS WRITEQ TS QUEUE  (WS-TS-ID)                    00230021
                                   FROM   (LS-COMMAREA)                 00240021
                                   LENGTH (WS-LGCOM)                    00250021
                                   ITEM   (WS-TSCO-ITEM)                00260021
                                   NOHANDLE                             00270021
               END-EXEC                                                 00280021
               PERFORM 90000-CONDERR-TEST                               00290006
               IF WS-TSCO-ITEM      NOT = LS-TSCO-ITEM AND              00300017
                  LS-TSCO-ITEM          > +1                            00310017
                  MOVE 'CONTEXTE'    TO MSTD-PMESS (1)                  00320010
                  MOVE LS-TSCO-ITEM  TO WS-ITEM-TRAV                    00330012
                  MOVE WS-ITEM-TRAV  TO MSTD-PMESS (2)                  00340012
                  MOVE WS-TSCO-ITEM  TO WS-ITEM-TRAV                    00350012
                  MOVE WS-ITEM-TRAV  TO MSTD-PMESS (3)                  00360012
                  MOVE 'PRIN'        TO STDER-TYPE-ERREUR               00370013
                  MOVE 'ST9401'      TO MSTD-NOMESS                     00380013
                  PERFORM 31000-PREP-MSGERR                             00390009
                  PERFORM 90000-TRAIT-ERROR                             00400009
               END-IF                                                   00410009
               IF WS-TSCO-ITEM      NOT = LS-TSCO-ITEM AND              00420017
                  LS-TSCO-ITEM          = +1                            00430017
                  PERFORM 90000-ERASE-TSCTX                             00440017
                  GO TO 65000-SAUVE-CONTEXTE-PGM-SUITE                  00450018
               END-IF                                                   00460017
           ELSE                                                         00470000
               EXEC CICS WRITEQ TS QUEUE  (WS-TS-ID)                    00480021
                                   FROM   (LS-COMMAREA)                 00490021
                                   LENGTH (WS-LGCOM)                    00500021
                                   ITEM   (LS-TSCO-ITEM)                00510021
                                   REWRITE                              00520021
                                   NOHANDLE                             00530021
               END-EXEC                                                 00540021
               PERFORM 90000-CONDERR-TEST                               00550006
           END-IF.                                                      00560006
      *                                                                 00570000
           MOVE STDP-NOM-PGM         TO LS-ENCH-PGMSAUV.                00580005
           MOVE STDP-CODE-TRN        TO LS-ENCH-TRNSAUV.                00590001
      *                                                                 00600000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4391LIBR  FADR201 STDFADR201Y%=65050 INL
      * *============================================================*
      * *           I ATTRIBUTES STORAGE        GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * *  STORE ATTRIBUTES OF CURRENT SCREEN-STATE                  *
      * *   BEFORE DISPLAYING.                                       *
      * *                                                            *
      * *============================================================*
       65050-MEMORIS-ATTR SECTION.
      *
           IF  STDP-IND        =  0
               GO TO 65050-MEMORIS-ATTR-FIN.
           MOVE 1    TO MDSC-IND-CHP.
      *
           IF  STDP-NUMECR (STDP-IND) NOT = '01'
               GO TO 65050-MEMORIS-ADR201-FIN.
      *
       65050-MEMORIS-ADR201.
      *
      * *-----------------------STORE  ATTRIBUTES  OF SCREEN 01
      *
           COMPUTE WS-TSDES-LG = (DSC-EN-NBCHPS OF ADR201-MDSC
                                  * 4) + 4.
      *
           IF  MDSC-IND-CHP > DSC-EN-NBCHPS OF ADR201-MDSC
               GO TO 65050-MEMORIS-ADR201-FIN.
      *
           MOVE DSC-RDF-ATTRIBUT   OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-DSC-ATTRIBUT   (MDSC-IND-CHP).
      *
           MOVE DSC-RDF-COULEUR    OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-DSC-COULEUR    (MDSC-IND-CHP).
      *
           MOVE DSC-RDF-HILIGHT    OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-DSC-HILIGHT    (MDSC-IND-CHP).
      *
           MOVE DSC-RDF-VALIDATION OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-DSC-VALIDATION (MDSC-IND-CHP).
      *
           IF   DSC-RDF-CURSEUR OF ADR201-MDSC (MDSC-IND-CHP)
                                 = CURSEUR
            AND WS-POS-CURS      = ZERO
                MOVE MDSC-IND-CHP TO WS-POS-CURS.
      *
           ADD 1 TO MDSC-IND-CHP.
           GO TO 65050-MEMORIS-ADR201.
      *
       65050-MEMORIS-ADR201-FIN.
      *
           EXIT.
      *
       65050-MEMORIS-ATTR-FIN.
      *
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6500PB                        STDST6500PB        INL
      * *============================================================*  00010003
      * * 65100     I SCREEN'S DESCRIPTOR BACKUP                     *  00020028
      * *------------------------------------------------------------*  00030003
      * *                                                            *  00040003
      * *  THIS FUNCTION SAVES SCREEN'S DESCRIPTOR IN PROGRESS       *  00050028
      * *                                                            *  00060028
      * *                                                            *  00070003
      * *============================================================*  00080003
       65100-SAUVE-DESCRIPTEUR               SECTION.                   00090003
           MOVE STDP-IND             TO WS-STDP-IND.                    00100022
           MOVE LS-TSCO-ITEM         TO LS-TSDES-ITEM.                  00110022
           MOVE WS-TS-DSCT-NOM       TO WS-TS-NOM.                      00120022
      *                                                                 00130022
           IF LS-TSDES-IND              < LS-TSDES-ITEM                 00140022
               MOVE LS-TSDES-ITEM    TO LS-TSDES-IND                    00150022
                                        WS-TSDES-ITEM                   00160022
               EXEC CICS WRITEQ TS QUEUE  (WS-TS-ID)                    00170007
                                   FROM   (WS-DSC-CHAMPS-OUTPUT)        00180003
                                   LENGTH (WS-TSDES-LG)                 00190006
                                   ITEM   (WS-TSDES-ITEM)               00200022
                                   MAIN                                 00210014
                                   NOHANDLE                             00220010
               END-EXEC                                                 00230003
               PERFORM 90000-CONDERR-TEST                               00240010
               IF WS-TSDES-ITEM     NOT = LS-TSDES-ITEM AND             00250026
                  LS-TSDES-ITEM         > +1                            00260026
                  MOVE 'DESCRIPTEUR' TO MSTD-PMESS (1)                  00270022
                  MOVE LS-TSDES-ITEM TO WS-ITEM-TRAV                    00280023
                  MOVE WS-ITEM-TRAV  TO MSTD-PMESS (2)                  00290023
                  MOVE WS-TSDES-ITEM TO WS-ITEM-TRAV                    00300023
                  MOVE WS-ITEM-TRAV  TO MSTD-PMESS (3)                  00310023
                  MOVE 'PRIN'        TO STDER-TYPE-ERREUR               00320024
                  MOVE 'ST9401'      TO MSTD-NOMESS                     00330024
                  PERFORM 31000-PREP-MSGERR                             00340022
                  PERFORM 90000-TRAIT-ERROR                             00350022
               END-IF                                                   00360022
               IF WS-TSDES-ITEM     NOT = LS-TSDES-ITEM AND             00370026
                  LS-TSDES-ITEM         = +1                            00380026
                  PERFORM 90000-ERASE-TSDES                             00390026
                  GO TO 65100-SAUVE-DESCRIPTEUR                         00400026
               END-IF                                                   00410026
           ELSE                                                         00420003
               EXEC CICS WRITEQ TS QUEUE  (WS-TS-ID)                    00430007
                                   FROM   (WS-DSC-CHAMPS-OUTPUT)        00440003
                                   LENGTH (WS-TSDES-LG)                 00450006
                                   ITEM   (LS-TSDES-ITEM)               00460003
                                   MAIN                                 00470014
                                   REWRITE                              00480003
                                   NOHANDLE                             00490010
               END-EXEC                                                 00500010
               PERFORM 90000-CONDERR-TEST                               00510010
           END-IF.                                                      00520010
      *                                                                 00530003
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4396LIBR  FADR201 STDFADR201§%=65150 INL
      * *============================================================*
      * *           I FORCE MDT BIT             GENERATED : 21-08-00 *
      * *------------------------------------------------------------*
      * *                                                            *
      * *  FORCE MDT BITS OF UPDATED FIELDS                          *
      * *             AND OF CHAINING AREAS.                         *
      * *                                                            *
      * *============================================================*
       65150-FORCE-MDTON  SECTION.
      *
           MOVE 1    TO MDSC-IND-CHP.
      *
           IF  STDP-NUMECR (STDP-IND) NOT = '01'
               GO TO 65150-FORCEMDT-ADR201-FIN.
      *
       65150-FORCEMDT-ADR201.
      *
      * *------------FORCE  MDT  BITS  FOR  FIELDS  OF  SCREEN  01
      *
           IF  MDSC-IND-CHP > DSC-EN-NBCHPS OF ADR201-MDSC
               GO TO 65150-FORCE-MDTON-FIN.
      *
           IF (WS-TOPMDTON                = '1')  AND
              (DSC-RDF-TYPE-SAISIE OF ADR201-MDSC (MDSC-IND-CHP)
                                          = MODIF OR
                                          = IDEM)
               SET WS-DSC-ATTR-IND TO 1
               SEARCH WS-DSC-ATTR-LIGNE
                 AT END
                    CONTINUE
                 WHEN WS-DSC-ATTR-MDTOFF (WS-DSC-ATTR-IND) =
                                      DSC-RDF-ATTRIBUT
                                   OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                    MOVE WS-DSC-ATTR-MDTON (WS-DSC-ATTR-IND)
                                   TO DSC-RDF-ATTRIBUT
                                   OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP).
      *
           IF (DSC-RDF-TYPVAR      OF ADR201-MDSC (MDSC-IND-CHP)
                                          = '1'  OR
                                          = '2') AND
               WS-ENTREE              NOT = 'P3'
               MOVE SPACE          TO DSC-RDF-TYPVAR
                                   OF ADR201-MDSC (MDSC-IND-CHP)
               MOVE DSC-RDF-POS    OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-IND1
               MOVE DSC-RDF-LGN    OF ADR201-MDSC (MDSC-IND-CHP)
                                   TO WS-IND2
               IF MSGI-MESSAGE (WS-IND1:WS-IND2)
                                      NOT = SPACE     AND
                                      NOT = LOW-VALUE
                   SET WS-DSC-ATTR-IND TO 1
                   SEARCH WS-DSC-ATTR-LIGNE
                     AT END
                        CONTINUE
                     WHEN WS-DSC-ATTR-MDTOFF (WS-DSC-ATTR-IND) =
                                      DSC-RDF-ATTRIBUT
                                   OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP)
                        MOVE WS-DSC-ATTR-MDTON (WS-DSC-ATTR-IND)
                                   TO DSC-RDF-ATTRIBUT
                                   OF DSC-RDF-OUTPUT
                                   OF ADR201-MDSC (MDSC-IND-CHP).
      *
           ADD 1 TO MDSC-IND-CHP.
           GO TO 65150-FORCEMDT-ADR201.
      *
       65150-FORCEMDT-ADR201-FIN.
      *
           EXIT.
      *
       65150-FORCE-MDTON-FIN.
      *
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST6500PC                        STDST6500PC        INL
      * *============================================================*  00010000
      * * 65200     I SCREEN'S DESCRIPTOR RECOVERY                   *  00020009
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  THIS FUNCTION RECOVERS SCREEN'S DESCRIPTOR IN PROGRESS    *  00050009
      * *                                                            *  00060000
      * *============================================================*  00070000
       65200-RESTO-DESCRIPTEUR               SECTION.                   00080000
           MOVE WS-TS-DSCT-NOM TO WS-TS-NOM.                            00090000
           COMPUTE WS-TSDES-LG = (WS-EN-NBCHPS * 4) + 4.                00100008
      *                                                                 00110000
           EXEC CICS READQ   TS                                         00120000
                     QUEUE   (WS-TS-ID)                                 00130000
                     INTO    (WS-DSC-CHAMPS-OUTPUT)                     00140000
                     LENGTH  (WS-TSDES-LG)                              00150000
                     ITEM    (LS-TSDES-ITEM)                            00160000
                     NOHANDLE                                           00170000
           END-EXEC.                                                    00180000
      *                                                                 00190000
           PERFORM 90000-CONDERR-TEST.                                  00200000
      *                                                                 00210004
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE XGENFADR201 PROC  4401LIBR  FADR201 STDFADR201Z%=65250 INL
      * *============================================================*
      * *           I ATTRIBUTES' RETRIEVAL                          *
      * *------------------------------------------------------------*
      * *                                                            *
      * *  RETRIEVE ATTRIBUTES FOR CURRENT SCREEN-STATE              *
      * *                                                            *
      * *============================================================*
       65250-RESTIT-ATTR SECTION.
      *
           IF  STDP-IND        =  0
               GO TO 65250-RESTIT-ATTR-FIN.
           MOVE 1 TO MDSC-IND-CHP.
      *
           IF  STDP-NUMECR (STDP-IND) NOT = '01'
               GO TO 65250-RESTIT-ADR201-FIN.
      *
       65250-RESTIT-ADR201.
      *
      * *---------------------RETRIEVE ATTRIBUTES OF SCREEN 01
      *
           IF  MDSC-IND-CHP NOT > DSC-EN-NBCHPS OF ADR201-MDSC
               MOVE    WS-DSC-ATTRIBUT   (MDSC-IND-CHP)
                    TO DSC-RDF-ATTRIBUT   OF DSC-RDF-OUTPUT
                                          OF ADR201-MDSC (MDSC-IND-CHP)
               MOVE    WS-DSC-COULEUR    (MDSC-IND-CHP)
                    TO DSC-RDF-COULEUR    OF DSC-RDF-OUTPUT
                                          OF ADR201-MDSC (MDSC-IND-CHP)
               MOVE    WS-DSC-HILIGHT    (MDSC-IND-CHP)
                    TO DSC-RDF-HILIGHT    OF DSC-RDF-OUTPUT
                                          OF ADR201-MDSC (MDSC-IND-CHP)
               MOVE    WS-DSC-VALIDATION (MDSC-IND-CHP)
                    TO DSC-RDF-VALIDATION OF DSC-RDF-OUTPUT
                                          OF ADR201-MDSC (MDSC-IND-CHP)
               MOVE    SPACE
                    TO DSC-RDF-CURSEUR    OF ADR201-MDSC (MDSC-IND-CHP)
               ADD 1 TO MDSC-IND-CHP
               GO TO 65250-RESTIT-ADR201.
      *
           IF  WS-CTRLET-CDERR  NOT = '1'
               AND WS-POS-CURS  NOT = ZERO
               MOVE CURSEUR  TO DSC-RDF-CURSEUR
                             OF ADR201-MDSC (WS-POS-CURS).
           MOVE ZERO         TO WS-POS-CURS.
      *
           MOVE DSC-EN-NBCHM OF ADR201-MDSC
                             TO WS-EN-NBCHM.
      *
       65250-RESTIT-ADR201-FIN.
      *
           EXIT.
      *
       65250-RESTIT-ATTR-FIN.
      *
           EXIT.
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST8000PA                        STDST8000PA        INL
      * *============================================================*  00010000
      * * 80000     I CONTROL CHAINING BETWEEN FUNCTIONS             *  00020020
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  CALL THE SUBROUTINE WHICH CONTROLS CHAINING BETWEEN       *  00050020
      * *  FUNCTIONS.                                                *  00060020
      * *                                                            *  00070000
      * *------------------------------------------------------------*  00080000
      * * POSSIBLE RESULTS :                                         *  00090020
      * *  .'00'   --> CHAINING ACCEPTED                             *  00100020
      * *  .'04'   --> CHAINING REJECTED   - REDISPLAY SCREEN/STATE  *  00110020
      * *  .'08'   --> CHAINING REJECTED   - REDISPLAY SCREEN/STATE  *  00120020
      * *============================================================*  00130000
       80000-CONTROLE-ENCH           SECTION.                           00140002
           EXEC CICS SYNCPOINT                                          00150011
           END-EXEC.                                                    00160011
      *                                                                 00170011
           INITIALIZE WS-COMMAREA-ENCH.                                 00180013
           MOVE ZERO                        TO WS-ENCH-RETOUR.          00190014
           MOVE STDP-NOM-FONC               TO WS-ENCH-NOM-FONC.        00200014
           MOVE WS-FONCSVT-IDOPE            TO WS-ENCH-FONCSVT-IDOPE.   00210014
           MOVE WS-TF                       TO WS-ENCH-TF.              00220014
           MOVE WS-FONCSVT-ARGUM            TO WS-ENCH-FONCSVT-ARGUM.   00230014
      *                                                                 00240015
           IF  WS-FONCSVT-IDOPE  = SPACE AND                            00250015
               WS-FONCSVT-ARGUM  = SPACE                                00260015
               MOVE WS-ZLECT-LONG           TO WS-ENCH-ZLECT-LONG       00270015
           ELSE                                                         00280015
               MOVE  ZERO                   TO WS-IND2                  00290015
               PERFORM VARYING WS-IND1 FROM 20 BY -1                    00300016
                       UNTIL  WS-IND1 = 0                               00310015
                          OR  WS-IND2 = 1                               00320015
                  IF  WS-FONCSVT-ARGUM-C (WS-IND1)                      00330015
                             NOT = SPACE AND                            00340017
                             NOT = LOW-VALUE                            00350017
                      MOVE WS-IND1          TO WS-ENCH-ZLECT-LONG       00360015
                      MOVE 1                TO WS-IND2                  00370015
                  END-IF                                                00380015
               END-PERFORM                                              00390015
           END-IF.                                                      00400015
      *                                                                 00410015
           MOVE LS-FONC-VISI                TO WS-ENCH-FONC-VISI.       00420019
           MOVE LS-FONC-VISI-PREC           TO WS-ENCH-FONC-VISI-PREC.  00430019
           MOVE WS-TRAIT-PARM               TO WS-ENCH-TRAIT-PARM.      00440019
           MOVE LS-TRAIT-PARM-PREC          TO WS-ENCH-TRAIT-PARM-PREC. 00450014
           MOVE ACCEPT-ERR-OUI              TO ACCEPT-PGMIDERR.         00460014
      *                                                                 00470000
           EXEC CICS HANDLE ABEND                                       00480000
                     CANCEL                                             00490000
           END-EXEC.                                                    00500000
      *                                                                 00510000
           EXEC CICS LINK PROGRAM  (WS-STENCH-PGM)                      00520002
                          COMMAREA (WS-COMMAREA-ENCH)                   00530002
                          LENGTH   (LENGTH OF WS-COMMAREA-ENCH)         00540014
                          NOHANDLE                                      00550000
           END-EXEC.                                                    00560000
      *                                                                 00570000
           PERFORM 90000-CONDERR-TEST.                                  00580000
      *                                                                 00590000
           EXEC CICS HANDLE ABEND                                       00600000
                     RESET                                              00610000
           END-EXEC.                                                    00620000
      *                                                                 00630000
      * *------------------------SUB ROUTINE DISABLED                   00640020
           IF  PGMIDERR                                                 00650007
               MOVE WS-STENCH-PGM           TO MSTD-PMESS (1)           00660014
               MOVE 'ST9701'                TO MSTD-NOMESS              00670014
               MOVE 'CICS'                  TO STDER-TYPE-ERREUR        00680014
               MOVE 'AB'                    TO WS-SORTIE                00690014
               GO TO 80000-CONTROLE-ENCH-FIN                            00700007
           END-IF.                                                      00710007
      *                                                                 00720000
      * *------------------------CHAINING ACCEPTED                      00730020
           IF  WS-ENCH-RETOUR    = '00'                                 00740015
               MOVE WS-ENCH-FONCSVT-IDOPE   TO WS-FONCSVT-IDOPE         00750014
               MOVE WS-ENCH-FONC-VISI       TO LS-FONC-VISI             00760019
               MOVE WS-ENCH-FONC-VISI-PREC  TO LS-FONC-VISI-PREC        00770019
               MOVE WS-ENCH-TRAIT-PARM      TO WS-TRAIT-PARM            00780014
               MOVE WS-ENCH-TRAIT-PARM-PREC TO LS-TRAIT-PARM-PREC       00790014
               GO TO 80000-CONTROLE-ENCH-FIN                            00800008
           END-IF.                                                      00810005
      *                                                                 00820005
      * *------------------------CHAINING REJECTED                      00830020
           IF  WS-ENCH-RETOUR    = '04'                                 00840015
               MOVE WS-ENCH-PMESS (1)       TO MSTD-PMESS (1)           00850014
               MOVE WS-ENCH-PMESS (2)       TO MSTD-PMESS (2)           00860014
               MOVE WS-ENCH-PMESS (3)       TO MSTD-PMESS (3)           00870014
               MOVE WS-ENCH-NOMESS          TO MSTD-NOMESS              00880014
               MOVE 'EM'                    TO WS-SORTIE                00890014
               GO TO 80000-CONTROLE-ENCH-FIN                            00900002
           END-IF.                                                      00910000
      *                                                                 00920004
      * *------------------------PROGRAM ERROR                          00930020
           IF  WS-ENCH-RETOUR    = '08'                                 00940015
               MOVE SPACE                   TO STDER-TYPE-ERREUR        00950014
               MOVE 'AB'                    TO WS-SORTIE                00960014
           END-IF.                                                      00970000
      *                                                                 00980000
       80000-CONTROLE-ENCH-FIN.                                         00990002
           EXIT.                                                        01000000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST8000PB                        STDST8000PB        INL
      * *============================================================*  00010000
      * * 80000     I SEARCH FOR ELEMENTS IN PROC. CHAINING TABLE    *  00020043
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  CALL FUN. PROC. PILOTE TO EXECUTE THE REQUESTED           *  00050043
      * *  OPERATION.                                                *  00060043
      * *  IF PROC. PILOTE IS DISABLED (FUN. PROC. NOT AVAILABLE),   *  00070043
      * *  RETURN TO SUMMARY.                                        *  00080043
      * *                                                            *  00090000
      * *------------------------------------------------------------*  00100000
      * * POSSIBLE RESULTS :                                         *  00110043
      * *  .OK     --> GO ON PROCESSING                              *  00120043
      * *  .ERROR  --> RETURN TO SUMMARY                             *  00130043
      * *============================================================*  00140000
       80000-PILOTE-PF               SECTION.                           00150028
           MOVE LENGTH OF WS-COMMAREA-PF TO WS-PFACT-LGCOM.             00160023
           MOVE ZERO                     TO WS-PFACT-RETOUR.            00170023
           MOVE LS-ENC-PF                TO WS-PILOTE-PF.               00180023
           MOVE ACCEPT-ERR-OUI           TO ACCEPT-PGMIDERR.            00190023
      *                                                                 00200033
           EXEC CICS HANDLE ABEND                                       00210033
                     CANCEL                                             00220033
           END-EXEC.                                                    00230033
      *                                                                 00240033
           EXEC CICS LINK PROGRAM  (WS-NOM-PILOTE-PF)                   00250021
                          COMMAREA (WS-COMMAREA-PF)                     00260023
                          LENGTH   (WS-PFACT-LGCOM)                     00270022
                          NOHANDLE                                      00280000
           END-EXEC.                                                    00290000
      *                                                                 00300033
           PERFORM 90000-CONDERR-TEST.                                  00310003
      *                                                                 00320000
           EXEC CICS HANDLE ABEND                                       00330039
                     RESET                                              00340039
           END-EXEC.                                                    00350039
      *                                                                 00360039
      * *-------------------FUN. PROC. PILOTE DISABLED                  00370043
      *                                                                 00380023
           IF  PGMIDERR                                                 00390032
               MOVE WS-NOM-PILOTE-PF     TO MSTD-PMESS (1)              00400032
               MOVE 'ST9701'             TO MSTD-NOMESS                 00410032
               MOVE 'CICS'               TO STDER-TYPE-ERREUR           00420040
               MOVE 'AB'                 TO WS-SORTIE                   00430032
               GO TO 80000-PILOTE-PF-FIN                                00440032
           END-IF.                                                      00450032
      *                                                                 00460003
           IF  WS-PFACT-RETOUR = ZERO                                   00470032
               MOVE WS-PFACT-PHASE       TO LS-PFACT-PHASE              00480032
               GO TO 80000-PILOTE-PF-FIN                                00490032
           END-IF.                                                      00500032
      *                                                                 00510023
           MOVE 'RM'                     TO WS-SORTIE.                  00520023
      * *------------------------FUNCTION RESULT UNKNOWN                00530043
      *                                                                 00540023
           IF  WS-PFACT-RETOUR = '02'                                   00550022
               MOVE WS-PFACT-RESU        TO MSTD-PMESS (1)              00560023
               MOVE WS-PFACT-FONC        TO MSTD-PMESS (2)              00570023
               MOVE 'ST9302'             TO MSTD-NOMESS                 00580029
               GO TO 80000-PILOTE-PF-FIN                                00590032
           END-IF.                                                      00600032
      * *------------------------NEW PHASE UNKNOWN                      00610043
      *                                                                 00620023
           IF  WS-PFACT-RETOUR = '04'                                   00630032
               MOVE WS-PFACT-NPHASE      TO MSTD-PMESS (1)              00640023
               MOVE LS-ENC-PF            TO MSTD-PMESS (2)              00650031
               MOVE 'ST9303'             TO MSTD-NOMESS                 00660030
               GO TO 80000-PILOTE-PF-FIN                                00670032
           END-IF.                                                      00680027
      * *------------------------PROGRAM ERROR                          00690043
      *                                                                 00700032
           IF  WS-PFACT-RETOUR = '08'                                   00710032
               MOVE SPACE                TO STDER-TYPE-ERREUR           00720038
               MOVE 'AB'                 TO WS-SORTIE                   00730032
           END-IF.                                                      00740032
      *                                                                 00750000
       80000-PILOTE-PF-FIN.                                             00760028
           EXIT.                                                        00770000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST8400PA                        STDST8400PA        INL
      * *============================================================*  00010035
      * * 84000     I ANALYSE AND EXECUTE STANDARD ACTION            *  00020099
      * *------------------------------------------------------------*  00030035
      * *                                                            *  00040035
      * *  THIS FUNCTION IS ACTIVATED IF DETECTED ACTION IS          *  00050099
      * *  STANDARD.                                                 *  00060099
      * *                                                            *  00070035
      * *  IT CALLS THE PROCESSING ASSOCIATED TO ACTIVATED STANDARD  *  00080099
      * *  ACTION.                                                   *  00090099
      * *                                                            *  00100035
      * *------------------------------------------------------------*  00110035
      * * POSSIBLE RESULTS :                                         *  00120099
      * *  .OK     --> GO ON PROCESSING                              *  00130099
      * *  .ERROR  --> END OF FUNCTION WITH MESSAGE DISPLAY          *  00140099
      * *============================================================*  00150035
       84000-EXEC-ACTION-STANDARD      SECTION.                         00160035
           IF  MTRA-TYPAPP-TRAIT (MTRA-IND)      = 'P' OR               00170051
                                                 = 'G'                  00180051
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STPF01     00190051
               OR  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-AIDK       00200099
                   PERFORM 84100-STPF01                                 00210041
               ELSE                                                     00220035
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STPF02     00230051
                   PERFORM 84200-STPF02                                 00240041
               ELSE                                                     00250035
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-TPF3       00260058
                   PERFORM 84300-STPF03                                 00270045
               ELSE                                                     00280041
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STPF04     00290051
                   PERFORM 84400-STPF04                                 00300041
               ELSE                                                     00310041
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STPF05     00320051
                   PERFORM 84500-STPF05                                 00330041
               ELSE                                                     00340041
               IF  MTRA-STD-ACTNOM (MTRA-IND)    = WS-ACTNOM-STLACT     00350051
                   PERFORM 84600-STLACT                                 00360041
               ELSE                                                     00370090
               IF  MTRA-NATURE-TRAIT (MTRA-IND)  = 'F'                  00380035
                   MOVE 'F'                          TO WS-TRAIT-PREF   00390051
                   MOVE MTRA-PGM-TRAIT (MTRA-IND)    TO WS-TRAIT-NOM    00400046
                   MOVE 'AF'                         TO WS-SORTIE       00410046
               ELSE                                                     00420035
                   MOVE MTRA-TYPAPP-TRAIT (MTRA-IND) TO MSTD-PMESS (1)  00430035
                   MOVE MTRA-STD-ACTNOM   (MTRA-IND) TO MSTD-PMESS (2)  00440052
                   MOVE 'ST9801'                     TO MSTD-NOMESS     00450052
                   MOVE 'RM'                         TO WS-SORTIE       00460051
           ELSE                                                         00470035
                   MOVE MTRA-TYPAPP-TRAIT (MTRA-IND) TO MSTD-PMESS (1)  00480035
                   MOVE 'ST9802'                     TO MSTD-NOMESS     00490052
                   MOVE 'RM'                         TO WS-SORTIE.      00500051
      *                                                                 00510035
      * *============================================================*  00520035
      * * 84100     I  STD-ACTION PROCESSING : HELP ON LINE          *  00530099
      * *------------------------------------------------------------*  00540035
      * *                                                            *  00550035
      * *  THE "HELP ON LINE" STANDARD ACTION PREPARES THE CALL OF   *  00560099
      * *  CODE HELP FUNCTION.                                       *  00570099
      * *                                                            *  00580035
      * *============================================================*  00590035
       84100-STPF01                    SECTION.                         00600041
           MOVE STDP-MAPS (STDP-IND)    TO WS-CTRLET-NOM-MAP (1).       00610099
           MOVE MTRA-PGM-TRAIT (MTRA-IND)                               00620096
                                        TO WS-TRAIT-NOM.                00630099
           MOVE 'AF'                    TO WS-SORTIE.                   00640099
      *                                                                 00650099
           IF WS-CTRLET-INDICE-R        = SPACE                         00660099
              GO TO 84100-STPF01-FIN                                    00670099
           END-IF.                                                      00680099
      *                                                                 00690099
           SET MSGI-CAR-IND             TO WS-CTRLET-POSCHP (1).        00700099
           MOVE 1                       TO WS-IND1.                     00710099
      *                                                                 00720099
           PERFORM UNTIL WS-IND1 > WS-CTRLET-LGNCHP (1)                 00730099
             MOVE MSGI-CAR (MSGI-CAR-IND)                               00740099
                                        TO WS-CTRLET-PARM-C (1 WS-IND1) 00750099
             ADD 1                      TO WS-IND1                      00760099
             SET MSGI-CAR-IND UP BY 1                                   00770099
           END-PERFORM.                                                 00780099
      *                                                                 00790099
       84100-STPF01-FIN.                                                00800099
           EXIT.                                                        00810099
      *                                                                 00820041
      * *============================================================*  00830041
      * * 84200     I  STD-ACTION PROCESSING :  CONTEXT BACKUP       *  00840099
      * *------------------------------------------------------------*  00850041
      * *                                                            *  00860041
      * *============================================================*  00870041
       84200-STPF02    SECTION.                                         00880041
           MOVE ACCEPT-ERR-OUI           TO ACCEPT-PGMIDERR.            00890047
      *                                                                 00900081
           EXEC CICS HANDLE ABEND                                       00910081
                     CANCEL                                             00920081
           END-EXEC.                                                    00930081
      *                                                                 00940047
           EXEC CICS LINK PROGRAM  (MTRA-PGM-TRAIT (MTRA-IND))          00950056
                          COMMAREA (LS-COMMAREA)                        00960056
                          LENGTH   (WS-LGCOM)                           00970056
                          NOHANDLE                                      00980056
           END-EXEC.                                                    00990041
      *                                                                 01000081
           PERFORM 90000-CONDERR-TEST.                                  01010047
      *                                                                 01020047
           EXEC CICS HANDLE ABEND                                       01030093
                     RESET                                              01040093
           END-EXEC.                                                    01050093
      *                                                                 01060093
      * *------------------------PROGRAM DISABLED                       01070099
      *                                                                 01080047
           IF PGMIDERR                                                  01090047
              MOVE MTRA-PGM-TRAIT (MTRA-IND)                            01100050
                                         TO MSTD-PMESS (1)              01110048
              MOVE 'ST9701'              TO MSTD-NOMESS                 01120053
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           01130083
              MOVE 'EM'                  TO WS-SORTIE                   01140083
              GO TO 84200-STPF02-FIN                                    01150053
           END-IF.                                                      01160048
      *                                                                 01170041
           IF LS-MESS-NUM               = '999999'                      01180095
              MOVE SPACE                 TO LS-MESS-NUM                 01190095
                                            STDER-TYPE-ERREUR           01200095
              MOVE 'AB'                  TO WS-SORTIE                   01210095
              GO TO 84200-STPF02-FIN                                    01220095
           END-IF.                                                      01230095
      *                                                                 01240095
           MOVE LS-MESS                  TO MSTD-MESS.                  01250099
           MOVE SPACE                    TO LS-MESS.                    01260099
      *                                                                 01270099
           IF MSTD-NOMESS               = 'ST9601' AND                  01280099
              (WS-FONCSVT-IDOPE     NOT = SPACE    OR                   01290099
               WS-FONCSVT-ARGUM     NOT = SPACE)                        01300099
              MOVE SPACE                 TO WS-STATUT-MESSAGE           01310099
              MOVE 'EN'                  TO WS-TF                       01320099
              PERFORM 21630-DET-COMMANDE                                01330099
              PERFORM 21700-RECH-ACTION                                 01340099
                IF WS-SORTIE            = 'EM'                          01350099
                   MOVE SPACE            TO MSTD-PMESS (1)              01360099
                   MOVE 'ST9601'         TO MSTD-NOMESS                 01370099
                   MOVE 'EO'             TO WS-SORTIE                   01380099
                ELSE                                                    01390099
                   PERFORM 21800-ANAL-DESCRIPTEUR                       01400099
                     IF WS-SORTIE       = 'EM'                          01410099
                        MOVE 'ST9601'    TO MSTD-NOMESS                 01420099
                        GO TO 84200-STPF02-FIN                          01430099
                     ELSE                                               01440099
                        PERFORM 60000-INITIAL-ARMIDE                    01450099
                        PERFORM 21900-APPEL-PTEARMIDE                   01460099
                        PERFORM 22000-EXEC-TRAITEMENT                   01470099
                        GO TO 84200-STPF02-FIN                          01480099
                     END-IF                                             01490099
                END-IF                                                  01500099
           ELSE                                                         01510063
              MOVE 'EM'                  TO WS-SORTIE                   01520063
              GO TO 84200-STPF02-FIN                                    01530099
           END-IF.                                                      01540063
      *                                                                 01550063
           PERFORM 80000-CONTROLE-ENCH.                                 01560099
           IF WS-SORTIE             NOT = 'EO'                          01570099
              GO TO 84200-STPF02-FIN                                    01580099
           END-IF.                                                      01590099
      *                                                                 01600099
           IF WS-FONCSVT-IDOPE          = STDP-NOM-FONC                 01610099
              GO TO 84200-STPF02-FIN                                    01620099
           END-IF.                                                      01630099
      *                                                                 01640099
           MOVE WS-FONCSVT-IDOPE         TO WS-ZINQUIRE-TRANID.         01650099
           PERFORM 60000-RECHERCHE-TRANID.                              01660099
           IF WS-ZINQUIRE-STATUST   NOT = 23                            01670099
              MOVE 'ST9601'              TO MSTD-NOMESS                 01680099
              MOVE 'EM'                  TO WS-SORTIE                   01690099
              GO TO 84200-STPF02-FIN                                    01700099
           END-IF.                                                      01710099
      *                                                                 01720099
           MOVE ZERO                     TO WS-ZINQUIRE-STATUSP.        01730099
      *    EXEC CICS INQUIRE PROGRAM (WS-ZINQUIRE-PGRMID)               01740099
      *                      STATUS  (WS-ZINQUIRE-STATUSP)              01750099
      *                      NOHANDLE                                   01760099
      *    END-EXEC.                                                    01770099
      *                                                                 01780099
           IF WS-ZINQUIRE-STATUSP   NOT = 23                            01790099
              MOVE 'ST9601'              TO MSTD-NOMESS                 01800099
              MOVE 'EM'                  TO WS-SORTIE                   01810099
           END-IF.                                                      01820099
      *                                                                 01830099
       84200-STPF02-FIN.                                                01840053
           EXIT.                                                        01850053
      *                                                                 01860041
      * *============================================================*  01870041
      * * 84300     I  STD-ACTION PROCESSING :  RECALL FUNCTION      *  01880099
      * *------------------------------------------------------------*  01890041
      * *                                                            *  01900041
      * *============================================================*  01910041
       84300-STPF03    SECTION.                                         01920041
           MOVE ACCEPT-ERR-OUI           TO ACCEPT-QIDERR.              01930061
           MOVE WS-TS-PF2-NOM1           TO WS-TS-NOM.                  01940061
      *                                                                 01950041
           EXEC CICS READQ TS QUEUE  (WS-TS-ID)                         01960049
                              INTO   (WTS-MONO)                         01970049
                              ITEM   (1)                                01980055
                              LENGTH (WTS-LENGTH)                       01990049
                              NOHANDLE                                  02000049
           END-EXEC.                                                    02010049
      *                                                                 02020042
           PERFORM 90000-CONDERR-TEST.                                  02030042
           IF  NOT QIDERR                                               02040057
               GO TO  84300-STPF03-SUIT1                                02050099
           END-IF.                                                      02060057
      *                                                                 02070057
           MOVE ACCEPT-ERR-OUI           TO ACCEPT-QIDERR.              02080061
           MOVE WS-TS-PF2-NOM2           TO WS-TS-NOM.                  02090061
      *                                                                 02100057
           EXEC CICS READQ TS QUEUE  (WS-TS-ID)                         02110057
                              INTO   (WTS-MONO)                         02120057
                              ITEM   (1)                                02130057
                              LENGTH (WTS-LENGTH2)                      02140057
                              NOHANDLE                                  02150057
           END-EXEC.                                                    02160057
      *                                                                 02170057
           PERFORM 90000-CONDERR-TEST.                                  02180057
           IF  QIDERR                                                   02190042
               MOVE 'ST9603'             TO MSTD-NOMESS                 02200072
               GO TO  84300-STPF03-FIN                                  02210056
           END-IF.                                                      02220042
           GO TO  84300-STPF03-SUIT2.                                   02230099
      *                                                                 02240056
       84300-STPF03-SUIT1.                                              02250099
           IF (WTS-MONO-USERID    NOT = WS-USER-ID) AND                 02260099
               WTS-MONO-USERID    NOT = SPACE                           02270099
               MOVE 'ST9603'             TO MSTD-NOMESS                 02280099
               GO TO  84300-STPF03-FIN                                  02290099
           END-IF.                                                      02300099
      *                                                                 02310099
       84300-STPF03-SUIT2.                                              02320099
           IF  WS-EN-NBCHM        NOT = ZERO                            02330099
               MOVE 'ST9604'             TO MSTD-NOMESS                 02340072
               GO TO  84300-STPF03-FIN                                  02350072
           END-IF.                                                      02360072
      *                                                                 02370072
           MOVE MTRA-PGM-TRAIT (MTRA-IND)                               02380099
                                         TO WS-ZINQUIRE-TRANID.         02390099
           PERFORM 60000-RECHERCHE-TRANID.                              02400099
           IF WS-ZINQUIRE-STATUST NOT = 23                              02410099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           02420099
              GO TO 84300-STPF03-FIN                                    02430099
           END-IF.                                                      02440099
      *                                                                 02450099
           MOVE ZERO                     TO WS-ZINQUIRE-STATUSP.        02460099
      *    EXEC CICS INQUIRE PROGRAM (WS-ZINQUIRE-PGRMID)               02470099
      *                      STATUS  (WS-ZINQUIRE-STATUSP)              02480099
      *                      NOHANDLE                                   02490099
      *    END-EXEC.                                                    02500099
      *                                                                 02510099
           IF WS-ZINQUIRE-STATUSP NOT = 23                              02520099
              MOVE WS-ZINQUIRE-PGRMID    TO MSTD-PMESS (1)              02530099
              MOVE 'ST9701'              TO MSTD-NOMESS                 02540099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           02550099
              GO TO 84300-STPF03-FIN                                    02560099
           END-IF.                                                      02570099
      *                                                                 02580099
           PERFORM 90000-ERASE.                                         02590056
           PERFORM 90000-ERASE-TSDES.                                   02600056
           PERFORM 90000-ERASE-TSCTX.                                   02610059
           PERFORM 90000-ERASE-TSFONC.                                  02620056
      *                                                                 02630056
           EXEC CICS RETURN TRANSID (MTRA-PGM-TRAIT (MTRA-IND))         02640056
                            IMMEDIATE                                   02650056
           END-EXEC.                                                    02660056
      *                                                                 02670041
       84300-STPF03-FIN.                                                02680056
           MOVE 'EM'                     TO WS-SORTIE.                  02690061
      *                                                                 02700099
      * *============================================================*  02710041
      * * 84400   I  STD-ACTION PROCESSONG :  RECALL PREV. FUNCTION  *  02720099
      * *------------------------------------------------------------*  02730041
      * *                                                            *  02740041
      * *============================================================*  02750041
       84400-STPF04    SECTION.                                         02760041
           IF  LS-RAPPEL-FONC           = SPACE AND                     02770099
               LS-ENC-ENFONC        NOT = 'FF'                          02780099
               MOVE 'ST9605'             TO MSTD-NOMESS                 02790068
               MOVE 'EM'                 TO WS-SORTIE                   02800068
               GO TO 84400-STPF04-FIN                                   02810098
           END-IF.                                                      02820068
      *                                                                 02830068
           IF  WS-EN-NBCHM          NOT = ZERO  AND                     02840098
               LS-PREC-TF           NOT = '04'                          02850080
               MOVE 'ST9606'             TO MSTD-NOMESS                 02860068
               MOVE 'EM'                 TO WS-SORTIE                   02870066
               GO TO 84400-STPF04-FIN                                   02880098
           END-IF.                                                      02890065
      *                                                                 02900065
           IF  LS-ENC-PF            NOT = SPACE OR                      02910098
               LS-ENC-ENFONC            = 'FF'                          02920098
               MOVE 'TR'                 TO WS-TRAIT-PILOTE             02930098
               MOVE 'EX'                 TO WS-NECRN                    02940098
               MOVE '99'                 TO WS-NETAT                    02950098
               GO TO 84400-STPF04-FIN                                   02960098
           END-IF.                                                      02970098
      *                                                                 02980098
           MOVE LS-RAPPEL-FONC           TO WS-FONCSVT-IDOPE.           02990066
           MOVE SPACE                    TO WS-FONCSVT-ARGUM.           03000066
           MOVE 'EO'                     TO WS-SORTIE.                  03010089
      *                                                                 03020099
           PERFORM 80000-CONTROLE-ENCH.                                 03030099
           IF WS-SORTIE             NOT = 'EO'                          03040099
              GO TO 84400-STPF04-FIN                                    03050099
           END-IF.                                                      03060099
      *                                                                 03070099
           MOVE WS-FONCSVT-IDOPE         TO WS-ZINQUIRE-TRANID.         03080099
           PERFORM 60000-RECHERCHE-TRANID.                              03090099
           IF WS-ZINQUIRE-STATUST   NOT = 23                            03100099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           03110099
              MOVE 'EM'                  TO WS-SORTIE                   03120099
              GO TO 84400-STPF04-FIN                                    03130099
           END-IF.                                                      03140099
      *                                                                 03150099
           MOVE ZERO                     TO WS-ZINQUIRE-STATUSP.        03160099
      *    EXEC CICS INQUIRE PROGRAM (WS-ZINQUIRE-PGRMID)               03170099
      *                      STATUS  (WS-ZINQUIRE-STATUSP)              03180099
      *                      NOHANDLE                                   03190099
      *    END-EXEC.                                                    03200099
      *                                                                 03210099
           IF WS-ZINQUIRE-STATUSP   NOT = 23                            03220099
              MOVE WS-ZINQUIRE-PGRMID    TO MSTD-PMESS (1)              03230099
              MOVE 'ST9701'              TO MSTD-NOMESS                 03240099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           03250099
              MOVE 'EM'                  TO WS-SORTIE                   03260099
           END-IF.                                                      03270099
      *                                                                 03280099
       84400-STPF04-FIN.                                                03290065
           EXIT.                                                        03300066
      *                                                                 03310041
      * *============================================================*  03320041
      * * 84500     I  STD-ACTION PROCESSING :  RETURN TO SUMMARY    *  03330099
      * *------------------------------------------------------------*  03340041
      * *                                                            *  03350041
      * *============================================================*  03360041
       84500-STPF05    SECTION.                                         03370041
           IF  LS-ENC-PF            NOT = SPACE                         03380099
               MOVE WS-TF                TO MSTD-PMESS(1)               03390099
               MOVE 'ST9104'             TO MSTD-NOMESS                 03400099
               MOVE 'EM'                 TO WS-SORTIE                   03410099
               GO TO  84500-STPF05-FIN                                  03420099
           END-IF.                                                      03430099
      *                                                                 03440099
           IF  COM-AUTCFONCSOMM         = SPACE                         03450099
               MOVE 'RM'                 TO WS-SORTIE                   03460099
               GO TO  84500-STPF05-FIN                                  03470099
           END-IF.                                                      03480099
      *                                                                 03490099
           IF  WS-EN-NBCHM          NOT = ZERO AND                      03500080
               LS-PREC-TF   NOT = '05'                                  03510070
               MOVE 'ST9607'             TO MSTD-NOMESS                 03520070
               MOVE 'EM'                 TO WS-SORTIE                   03530070
               GO TO  84500-STPF05-FIN                                  03540070
           END-IF.                                                      03550070
      *                                                                 03560070
           MOVE COM-AUTCFONCSOMM         TO WS-FONCSVT-IDOPE.           03570099
           MOVE SPACE                    TO WS-FONCSVT-ARGUM.           03580099
           MOVE 'EO'                     TO WS-SORTIE.                  03590099
      *                                                                 03600099
           PERFORM 80000-CONTROLE-ENCH.                                 03610099
           IF WS-SORTIE             NOT = 'EO'                          03620099
              GO TO 84500-STPF05-FIN                                    03630099
           END-IF.                                                      03640099
      *                                                                 03650099
           MOVE WS-FONCSVT-IDOPE         TO WS-ZINQUIRE-TRANID.         03660099
           PERFORM 60000-RECHERCHE-TRANID.                              03670099
           IF WS-ZINQUIRE-STATUST   NOT = 23                            03680099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           03690099
              MOVE 'EM'                  TO WS-SORTIE                   03700099
              GO TO 84500-STPF05-FIN                                    03710099
           END-IF.                                                      03720099
      *                                                                 03730099
           MOVE ZERO                     TO WS-ZINQUIRE-STATUSP.        03740099
      *    EXEC CICS INQUIRE PROGRAM (WS-ZINQUIRE-PGRMID)               03750099
      *                      STATUS  (WS-ZINQUIRE-STATUSP)              03760099
      *                      NOHANDLE                                   03770099
      *    END-EXEC.                                                    03780099
      *                                                                 03790099
           IF WS-ZINQUIRE-STATUSP   NOT = 23                            03800099
              MOVE WS-ZINQUIRE-PGRMID    TO MSTD-PMESS (1)              03810099
              MOVE 'ST9701'              TO MSTD-NOMESS                 03820099
              MOVE 'APPL'                TO STDER-TYPE-ERREUR           03830099
              MOVE 'EM'                  TO WS-SORTIE                   03840099
              GO TO 84500-STPF05-FIN                                    03850099
           END-IF.                                                      03860099
      *                                                                 03870099
           PERFORM 90000-ERASE-TSFONC.                                  03880099
      *                                                                 03890099
       84500-STPF05-FIN.                                                03900070
           EXIT.                                                        03910070
      *                                                                 03920035
      * *============================================================*  03930035
      * * 84600     I  STD-ACTION PROCESSING :  DISPALY ACTION LINE  *  03940099
      * *------------------------------------------------------------*  03950035
      * *                                                            *  03960035
      * *  THE ACTION "DISPLAY ACTION LINE" IS A REQUEST FOR         *  03970099
      * *  SCROLLING ON ACTION LINE, BECAUSE THE FIELD CANNOT        *  03980099
      * *  CONTAIN THE WHOLE AVAILABLE ACTIONS.                      *  03990099
      * *                                                            *  04000035
      * *============================================================*  04010035
       84600-STLACT                    SECTION.                         04020044
           MOVE '1'                      TO WS-SCROLL.                  04030073
           MOVE 'EM'                     TO WS-SORTIE.                  04040035
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST8500PA                        STDST8500PA        INL
      * *============================================================*  00010021
      * * 85000     I PREPARATION OF ACTION LINE                     *  00020029
      * *------------------------------------------------------------*  00030021
      * *                                                            *  00040021
      * *  THIS PROCESSING DETECTS SCROLLING CONTEXT IN ACTION       *  00050028
      * *  LINE ; IT SEARCHES FOR ACTIONS OF THE CONCERNED           *  00060028
      * *  SCREEN/STATE ; THEN IT CALLS THE MODULE WHICH FORMS       *  00070028
      * *  THE ACTION LINE.                                          *  00080028
      * *                                                            *  00090021
      * *============================================================*  00100021
       85000-PREP-LIBACTION            SECTION.                         00110021
           IF  LS-PREC-ECET     NOT = WS-ENC-ECET  OR                   00120026
               WS-SCROLL            = 'N'                               00130026
               MOVE ZERO      TO LS-PREC-ACT-IND                        00140026
           END-IF.                                                      00150021
      *                                                                 00160021
           MOVE 1             TO MTRA-IND.                              00170021
           PERFORM 85100-CONSTIT-MEM.                                   00180027
      *                                                                 00190021
           PERFORM 85100-CONSTIT-CHARGT.                                00200021
      *                                                                 00210021
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST8500PB                        STDST8500PB        INL
      * *============================================================*  00010017
      * * 85100     I LOAD THE ACTION LINE                           *  00020029
      * *------------------------------------------------------------*  00030017
      * *                                                            *  00040017
      * *  THIS PROCESSING ALLOWS ACTION LINE CONSTITUTION,          *  00050029
      * *  IF A FIELD ASSOCIATED TO "LIGACT" VARIABLE WAS DEFINED    *  00060029
      * *  IN THE PROCESSED SCREEN.                                  *  00070029
      * *  ACTION LINE IS MEMORIZED IN "LIGACT" VARIABLE.            *  00080029
      * *                                                            *  00090017
      * *============================================================*  00100017
       85100-CONSTIT-MEM                SECTION.                        00110019
      *                                                                 00120019
      * *-------------MATRIX READING                                    00130029
      * *                       AND ACTIONS MEMORIZED                   00140029
           IF  MTRA-IND                   > MTRA-NBMAX                  00150023
               GO TO 85100-CONSTIT-MEM-FIN                              00160019
           END-IF.                                                      00170019
      *                                                                 00180017
           IF  MTRA-ECET (MTRA-IND)   NOT = WS-ENC-ECET                 00190023
               ADD 1                           TO MTRA-IND              00200019
               GO TO 85100-CONSTIT-MEM                                  00210019
           END-IF.                                                      00220019
      *                                                                 00230017
           IF  MTRA-LIBACT (MTRA-IND)     = SPACE                       00240023
               ADD 1                           TO MTRA-IND              00250023
               GO TO 85100-CONSTIT-MEM                                  00260023
           END-IF.                                                      00270023
      *                                                                 00280023
           MOVE MTRA-TF (MTRA-IND)             TO WS-ACTION-TF.         00290023
           IF  WS-ACTION-TF           NOT = '? ' AND                    00300023
                                      NOT = ' ?' AND                    00310023
                                      NOT = '??'                        00320023
               MOVE MTRA-LIBACT (MTRA-IND)     TO WS-ACTION-LIBACT      00330026
               PERFORM 85100-CONSTIT-MEM-SUITE                          00340023
               ADD 1                           TO MTRA-IND              00350023
               GO TO 85100-CONSTIT-MEM                                  00360025
           END-IF.                                                      00370023
      *                                                                 00380019
           PERFORM VARYING WS-IND2 FROM 1 BY 1                          00390026
                   UNTIL WS-IND2          > WS-TABLETF-NBMAX            00400026
              IF  WS-TABLETF-FONC        (WS-IND2)                      00410027
                                      NOT = STDP-NOM-FONC               00420027
                  MOVE WS-TABLETF-ID     (WS-IND2)                      00430027
                                               TO WS-ACTION-TF          00440027
                  MOVE WS-TABLETF-LIBACT (WS-IND2)                      00450027
                                               TO WS-ACTION-LIBACT      00460027
                  PERFORM 85100-CONSTIT-MEM-SUITE                       00470027
              END-IF                                                    00480027
           END-PERFORM.                                                 00490025
           ADD 1                               TO MTRA-IND.             00500019
           GO TO 85100-CONSTIT-MEM.                                     00510017
      *                                                                 00520023
       85100-CONSTIT-MEM-SUITE.                                         00530023
           IF  WS-ACTION-TF               = 'ER' AND                    00540023
               WS-PTF-X (01)          NOT = 'X'                         00550023
               MOVE 'X'                        TO WS-PTF-X   (01)       00560023
               MOVE WS-ACTION-LIBACT           TO WS-PTF-LIB (01)       00570026
           ELSE                                                         00580023
           IF  WS-ACTION-TF               = 'A1' AND                    00590023
               WS-PTF-X (27)          NOT = 'X'                         00600023
               MOVE 'X'                        TO WS-PTF-X   (27)       00610023
               MOVE WS-ACTION-LIBACT           TO WS-PTF-LIB (27)       00620026
           ELSE                                                         00630023
           IF  WS-ACTION-TF               = 'A2' AND                    00640023
               WS-PTF-X (28)          NOT = 'X'                         00650023
               MOVE 'X'                        TO WS-PTF-X   (28)       00660023
               MOVE WS-ACTION-LIBACT           TO WS-PTF-LIB (28)       00670026
           ELSE                                                         00680023
           IF  WS-ACTION-TF               = 'A3' AND                    00690023
               WS-PTF-X (29)          NOT = 'X'                         00700023
               MOVE 'X'                        TO WS-PTF-X   (29)       00710023
               MOVE WS-ACTION-LIBACT           TO WS-PTF-LIB (29)       00720026
           ELSE                                                         00730023
           IF  WS-ACTION-TF = 'EN'  OR  SPACE  OR  '01'  OR             00740023
                              '02'  OR  '03'   OR  '04'  OR             00750028
                              '05'  OR  '11'             OR             00760028
               WS-ACTION-TF < '01'  OR > '24'                           00770023
               NEXT SENTENCE                                            00780023
           ELSE                                                         00790023
               ADD 2 WS-ACTION-TF9 GIVING WS-IND1                       00800023
               IF  WS-PTF-X (WS-IND1) NOT = 'X'                         00810023
                   MOVE 'X'                    TO WS-PTF-X   (WS-IND1)  00820023
                   MOVE WS-ACTION-LIBACT       TO WS-PTF-LIB (WS-IND1)  00830026
               END-IF                                                   00840023
               IF  WS-ACTION-LIBACT       = 'LACT'                      00850026
                   MOVE WS-IND1                TO WS-ACTS.              00860023
      *                                                                 00870017
       85100-CONSTIT-MEM-FIN.                                           00880017
           EXIT.                                                        00890017
           EJECT                                                        00900019
      *                                                                 00910017
      * *------------------------LOAD ACTION LINE                       00920029
       85100-CONSTIT-CHARGT             SECTION.                        00930019
           IF WS-ACTS = ZERO                                            00940017
              MOVE 1                           TO WS-IND2               00950019
              PERFORM 85110-CHARGT-TFCODE                               00960017
                      VARYING WS-IND1 FROM 1 BY 1                       00970017
                      UNTIL   WS-IND1 > 29 OR                           00980019
                              WS-IND2 > 26                              00990019
           ELSE                                                         01000017
              PERFORM 85120-CHARGT-TFLIBACT                             01010019
           END-IF.                                                      01020019
      *                                                                 01030017
           MOVE WS-LIGNE                       TO STDMSP-V-Y-VALEUR.    01040019
      *                                                                 01050019
      * *============================================================*  01060017
      * * 85110     I CREATION OF ACTION LINE BY DEFAULT             *  01070029
      * *------------------------------------------------------------*  01080017
      * *                                                            *  01090017
      * *  IF A FK STD FOR SCROLLING ACTION LINE IS NOT DEFINED,     *  01100031
      * *  THIS MODULE LOADS A LINE CONTAINING ONLY THE LIST OF      *  01110032
      * *  POSSIBLE FK FOR THE SCREEN/STATE.                         *  01120031
      * *                                                            *  01130017
      * *============================================================*  01140017
       85110-CHARGT-TFCODE               SECTION.                       01150017
           IF  WS-PTF-X (WS-IND1) = 'X'                                 01160019
               MOVE WS-PTF-TF (WS-IND1)        TO WS-ACT-PTF (WS-IND2)  01170019
               ADD 1                           TO WS-IND2               01180019
           END-IF.                                                      01190019
      *                                                                 01200017
      * *============================================================*  01210017
      * * 85120     I CREATION OF ACTION LINE WITH DESCRIPTION       *  01220032
      * *------------------------------------------------------------*  01230017
      * *                                                            *  01240017
      * *  CREATION OF ACTION LINE WITH A DESCRIPTION ASSOCIATED TO  *  01250032
      * *  EACH ACTION OF THE SCREEN/STATE :                         *  01260032
      * *  -EITHER BY USING THE 1ST ALLOWED ACTION,                  *  01270032
      * *  -OR BY SCROLLING FROM THE CURRENT POSTION.                *  01280032
      * *                                                            *  01290017
      * *============================================================*  01300017
       85120-CHARGT-TFLIBACT             SECTION.                       01310017
           MOVE 1                              TO WS-IND3.              01320019
           MOVE SPACE                          TO WS-PTF-X (WS-ACTS).   01330019
           ADD  1 LS-PREC-ACT-IND          GIVING WS-IND1.              01340019
      *                                                                 01350017
       85120-CHARGT-TFLIBACT-SUITE.                                     01360017
           IF  WS-IND1 > 29                                             01370017
               PERFORM  VARYING  WS-IND4  FROM  1  BY  1                01380017
                          UNTIL  WS-IND4 > 29                           01390017
                 IF  WS-PTF-X (WS-IND4)      = 'X'                      01400019
                     MOVE WS-IND4              TO WS-IND1               01410019
                     GO TO  85120-CHARGT-TFLIBACT-SUITE                 01420019
                 END-IF                                                 01430019
               END-PERFORM                                              01440017
               GO TO 85120-CHARGT-TFLIBACT-FIN                          01450017
           END-IF.                                                      01460017
      *                                                                 01470017
           IF  WS-PTF-X (WS-IND1) NOT = 'X'                             01480017
               ADD  1                          TO  WS-IND1              01490019
               GO TO  85120-CHARGT-TFLIBACT-SUITE                       01500019
           END-IF.                                                      01510019
      *                                                                 01520019
           MOVE  WS-PTF-ACT (WS-IND1)          TO WS-PTF-ED (WS-IND3).  01530019
           MOVE  SPACE                         TO WS-PTF-X (WS-IND1).   01540019
           MOVE  WS-IND1                       TO LS-PREC-ACT-IND.      01550019
      *                                                                 01560019
           IF  WS-IND3 < 7                                              01570017
               ADD   1                         TO WS-IND1               01580019
                                                  WS-IND3               01590019
               GO TO  85120-CHARGT-TFLIBACT-SUITE                       01600017
           END-IF.                                                      01610017
                                                                        01620017
           PERFORM  VARYING  WS-IND4  FROM  1  BY  1                    01630017
                      UNTIL  WS-IND4 > 29                               01640017
             IF  WS-PTF-X (WS-IND4)  NOT = SPACE                        01650019
                 MOVE WS-PTF-TF (WS-ACTS)      TO WS-LIG-ACT-PTF        01660019
                 MOVE '-> '                    TO WS-LIG-ACT-LIB        01670019
                                                  WS-LIG-ACT-CONTINU    01680019
                 MOVE  30                      TO WS-IND4               01690019
             END-IF                                                     01700019
           END-PERFORM.                                                 01710017
      *                                                                 01720017
       85120-CHARGT-TFLIBACT-FIN.                                       01730017
           EXIT.                                                        01740017
      *                                                                 01750017
      *$XENDINCLUDE
           EJECT
      * *============================================================*
      * * 90000     I GESTION DES ERREURS DU PROGRAMME               *
      * *------------------------------------------------------------*
      * *                                                            *
      * *     - GESTION DES ERREURS CICS                             *
      * *     - GESTION DES ABENDS                                   *
      * *     - HISTORISATION DES ERREURS                            *
      * *     - SUPRESSION DES TS                                    *
      * *                                                            *
      * *============================================================*
      *
      *$XINCLUDE ZSTDST9000PA                        STDST9000PA        INL
      * *============================================================*  00010099
      * *============================================================*  00020099
      * *============================================================*  00030099
      * *============================================================*  00040099
      * *============================================================*  00050099
      * *============================================================*  00060099
      * * DON'T FORGET PRECOMPILATION !!!!                           *  00070099
      * *------------------------------------------------------------*  00080099
      * *                                                            *  00090099
      * *  - WARNING : THIS MODULE MUST BE PRECOMPILED TO BE USED    *  00100099
      * *    AS A COPY IN SUBROUTINES.                               *  00110099
      * *    NAME OF SOURCE MODULE        ---> ST9000PA              *  00120099
      * *    NAME OF PRECOMPILED MODULE   ---> ST9000TR              *  00130099
      * *    MODIFY ONLY ST9000PA !!!!!!!!!!!!!!!!!!!                *  00140099
      * *    USE   ---> COB2TRN                                      *  00150099
      * *                                                            *  00160099
      * *============================================================*  00170099
      * *============================================================*  00180099
      * *============================================================*  00190099
      * *============================================================*  00200099
      * *============================================================*  00210099
      * *============================================================*  00220099
      * *============================================================*  00230099
      * * 90000     I MANAGEMENT OF RETURN CODES AND CICS ERRORS     *  00240099
      * *------------------------------------------------------------*  00250099
      * *                                                            *  00260099
      * *  - TEST ON ERROR TYPE AND FLAG ALIGNMENT IF                *  00270099
      * *    REQUESTER INTERCEPTS THE CONDITIONS.                    *  00280099
      * *  - INITIALIZATION OF THE HANDLE CONDITION ERROR.           *  00290099
      * *                                                            *  00300099
      * *============================================================*  00310099
       90000-CONDERR-TEST      SECTION.                                 00320099
      *                                                                 00330099
      * *-----------------------ERROR TEST AND ERROR-COND UPRDATE       00340099
           MOVE  DFHEIBLK                TO  STDER-EIB-BLOC.            00350099
           IF  EIBRESP = 00  OR  06                                     00360099
               MOVE 'NORESP'             TO STDER-EXEC-RETOUR           00370099
           ELSE                                                         00380099
               PERFORM 90000-CONDERR-RECHRC                             00390099
           END-IF.                                                      00400099
      *                                                                 00410099
           PERFORM 90000-CONDERR-INIT.                                  00420099
                                                                        00430099
      * *----------------------- ERROR CODE UPDATE                      00440099
       90000-CONDERR-RECHRC    SECTION.                                 00450099
           SET  STDER-HEX-I          TO 1.                              00460099
           SEARCH STDER-HEX-POSTE                                       00470099
            AT END PERFORM 90000-ERROR-CICS                             00480099
            WHEN STDER-HEX-CODE    (STDER-HEX-I) = EIBRESP        AND   00490099
                 STDER-CODE-ACCEPT (STDER-HEX-I) = ACCEPT-ERR-OUI       00500099
                 MOVE STDER-CODE-RETOUR (STDER-HEX-I)                   00510099
                                     TO STDER-EXEC-RETOUR.              00520099
      *                                                                 00530099
       90000-CONDERR-INIT      SECTION.                                 00540099
      *                                                                 00550099
      * *-----------------------HANDLE CONDITION CICS                   00560099
           EXEC CICS HANDLE CONDITION                                   00570099
                     ERROR (90000-ERROR-CICS)                           00580099
           END-EXEC.                                                    00590099
      *                                                                 00600099
      * *----------INITIALIZATION OF ACCEPT-ERR FLAGS WITH "NON" VALUE  00610099
           PERFORM 90000-CONDERR-REFUS                                  00620099
                   VARYING STDER-HEX-I FROM 1 BY 1                      00630099
                   UNTIL STDER-HEX-I > STDER-HEX-CTR.                   00640099
      *                                                                 00650099
       90000-CONDERR-REFUS     SECTION.                                 00660099
           MOVE ACCEPT-ERR-NON       TO STDER-CODE-ACCEPT (STDER-HEX-I).00670099
      *                                                                 00680099
      * *============================================================*  00690099
      * * 90000     I INTERCEPTION OF CICS ERRORS                    *  00700099
      * *------------------------------------------------------------*  00710099
      * *                                                            *  00720099
      * *  ERRORS TAKEN IN CHARGE, DEPENDING ON CICS ORDERS WHICH    *  00730099
      * *  ARE DETECTED BY HANDLE CONDITION.                            00740099
      * *                                                            *  00750099
      * *============================================================*  00760099
       90000-ERROR-CICS  SECTION.                                       00770099
           MOVE  'CICS' TO STDER-TYPE-ERREUR.                           00780099
           MOVE  'AB'   TO WS-SORTIE.                                   00790099
           PERFORM 90000-ENREG-ERROR.                                   00800099
           PERFORM 90000-TRAIT-ERROR.                                   00810099
           EJECT                                                        00820099
      * *============================================================*  00830099
      * * 90000     I INTERCEPTION OF PROGRAMED ABENDS               *  00840099
      * *------------------------------------------------------------*  00850099
      * *                                                            *  00860099
      * *  PROGRAMED ABENDS TAKEN IN CHARGE                          *  00870099
      * *                                                            *  00880099
      * *============================================================*  00890099
       90000-ERROR-ABEND  SECTION.                                      00900099
      * *-----------------------SEARCH FOR ABEND CODE                   00910099
           EXEC CICS ASSIGN                                             00920099
                     ABCODE (STDER-ABCODE)                              00930099
           END-EXEC.                                                    00940099
      *                                                                 00950099
           MOVE 'AB'                      TO  WS-SORTIE                 00960099
           EVALUATE STDER-ABCODE-1                                      00970099
               WHEN 'DH'                                                00980099
                    MOVE 'DL1 '           TO  STDER-TYPE-ERREUR         00990099
               WHEN OTHER                                               01000099
                    MOVE 'ABEN'           TO  STDER-TYPE-ERREUR         01010099
           END-EVALUATE.                                                01020099
      *                                                                 01030099
           IF (STDER-ABCODE NOT = 'ADCI' AND NOT = 'ADLD'               01040099
                        AND NOT = 'AEIK' AND NOT = 'AEIS'               01050099
                        AND NOT = 'APCT' AND NOT = 'ABMS'               01060099
                        AND NOT = 'ADCA' AND NOT = 'AEY9'               01070099
                        AND NOT = 'AEI0'                                01080099
                        AND NOT = 'DHAI' AND NOT = 'DHOI'               01090099
                        AND NOT = 'DHTA' AND NOT = 'DHTE'               01100099
                        AND NOT = 'DHDJ' AND NOT = 'DHTP'               01110099
                        AND NOT = 'DHAM' AND NOT = 'DHTJ')              01120099
               EXEC CICS ASKTIME                                        01130099
                         ABSTIME(STDER-ABSTIME-FIN)                     01140099
               END-EXEC                                                 01150099
               EXEC CICS DUMP DUMPCODE (STDER-ABCODE)                   01160099
                              NOHANDLE                                  01170099
               END-EXEC                                                 01180099
               MOVE 'O'                   TO  STDER-DUMP                01190099
           END-IF.                                                      01200099
      *                                                                 01210099
           EXEC CICS HANDLE ABEND                                       01220099
                            CANCEL                                      01230099
           END-EXEC.                                                    01240099
      *                                                                 01250099
           PERFORM 90000-ENREG-ERROR.                                   01260099
           PERFORM 90000-TRAIT-ERROR.                                   01270099
           EJECT                                                        01280099
      * *============================================================*  01290099
      * * 90000     I ARCHIVE PROGRAMED ERRORS                       *  01300099
      * *------------------------------------------------------------*  01310099
      * *                                                            *  01320099
      * *  RECORD DL1/DB2/ARMIDE/PRINCIPIA/APPLICATION/CICS/ABEND    *  01330099
      * *  ERRORS IN DB2 TABLES.                                     *  01340099
      * *                                                            *  01350099
      * *============================================================*  01360099
       90000-ENREG-ERROR SECTION.                                       01370099
           IF  STDER-TYPE-ERREUR = SPACES                               01380099
               GO TO 90000-ENREG-ERROR-FIN                              01390099
           END-IF.                                                      01400099
      *                                                                 01410099
           MOVE EIBTASKN                TO STDER-TACHE.                 01420099
           MOVE EIBTRNID                TO STDER-CODE-TRANS.            01430099
           MOVE EIBTRMID                TO STDER-TERM-PHYS.             01440099
           MOVE WS-USER-ID              TO STDER-USER.                  01450099
           MOVE WHEN-COMPILED           TO STDER-DATE-COMPILE.          01460099
           MOVE WS-SESS-ID              TO STDER-ENVIRONNEMENT.         01470099
           MOVE MSTD-MESS               TO STDER-LS-MESS.               01480099
      *                                                                 01490099
           IF    WS-SORTIE = 'AB'                                       01500099
                 EXEC CICS                                              01510099
                     SYNCPOINT ROLLBACK                                 01520099
                 END-EXEC                                               01530099
                 MOVE 'O'       TO STDER-BACKOUT                        01540099
           ELSE                                                         01550099
                 EXEC CICS                                              01560099
                     SYNCPOINT                                          01570099
                 END-EXEC                                               01580099
           END-IF.                                                      01590099
      *                                                                 01600099
           PERFORM 90000-EVALUATE-TYPE-ERREUR.                          01610099
      *                                                                 01620099
           PERFORM 90000-SPECIF-ERROR.                                  01630099
      *                                                                 01640099
           IF  STDER-ABCODE          = SPACE                            01650099
               EXEC CICS HANDLE ABEND                                   01660099
                         CANCEL                                         01670099
               END-EXEC                                                 01680099
           END-IF.                                                      01690099
      *                                                                 01700099
      *$   EXEC CICS LINK PROGRAM  (WS-STERROR-PGM)                     01710099
      *$                  COMMAREA (STDER-ERREUR)                       01720099
      *$                  LENGTH(LENGTH OF STDER-ERREUR)                01730099
      *$                  NOHANDLE                                      01740099
      *$   END-EXEC.                                                    01750099
      *                                                                 01760099
           IF  STDER-ABCODE          = SPACE                            01770099
               EXEC CICS HANDLE ABEND                                   01780099
                         RESET                                          01790099
               END-EXEC                                                 01800099
           END-IF.                                                      01810099
      *                                                                 01820099
       90000-ENREG-ERROR-FIN.                                           01830099
           EXIT.                                                        01840099
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST9000PB                        STDST9000PB        INL
       90000-EVALUATE-TYPE-ERREUR SECTION.                              00010001
      * *----------------- EVALUATE ERROR TYPE AND                      00020027
      * *----------------- LOAD SIGNIFICANT FIELDS                      00030027
           IF  STDER-ABSTIME-FIN = ZERO                                 00040019
               EXEC CICS ASKTIME                                        00050019
                         ABSTIME(STDER-ABSTIME-FIN)                     00060019
               END-EXEC                                                 00070019
           END-IF.                                                      00080019
      *                                                                 00090019
           EVALUATE  STDER-TYPE-ERREUR                                  00100000
               WHEN  'DB2'                                              00120000
                     MOVE SQLCODE         TO  WS-SQLCODEX               00130018
                                              STDER-DB2-SQLCODE         00140018
                     MOVE SQLCA           TO  STDER-DB2-SQLCA           00150018
                     IF   SQLCODE > -900  AND SQLCODE NOT = -818        00160010
                                          AND SQLCODE NOT = -805        00170010
                                          AND SQLCODE NOT = -204        00180025
                                          AND SQLCODE NOT = -206        00190025
                          EXEC CICS                                     00200017
                               DUMP TASK DUMPCODE (WS-SQLCODEX)         00210017
                          END-EXEC                                      00220017
                          MOVE 'O'        TO  STDER-DUMP                00230018
                     END-IF                                             00240017
               WHEN  'DLI'                                              00260017
               WHEN  'DL1'                                              00270017
      *              MOVE DIBSTAT         TO  WS-DIBSTAT2               00280017
      *                                       STDER-DL1-DIBSTAT         00290017
                     IF  STDER-DUMP NOT = 'O'                           00300021
                         EXEC CICS                                      00310021
                              DUMP TASK DUMPCODE (WS-DIBSTAT)           00320021
                         END-EXEC                                       00330021
                         MOVE 'O'         TO  STDER-DUMP                00340021
                     END-IF                                             00350021
           END-EVALUATE.                                                00360000
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST9000PD                        STDST9000PD        INL
       90000-SPECIF-ERROR         SECTION.                              00010001
           IF  STDER-DUMP NOT = 'O'                                     00020010
               EXEC CICS ASKTIME                                        00030010
                    ABSTIME(STDER-ABSTIME-FIN)                          00040010
               END-EXEC                                                 00050010
           END-IF.                                                      00060010
      *                                                                 00070010
           MOVE WS-TERM-PRINTER         TO STDER-IMPR.                  00080013
           MOVE STDP-NOM-FONC           TO STDER-NOM-FONCTION.          00090001
           MOVE STDP-NOM-PGM            TO STDER-NOM-PROG.              00100001
           IF  STDP-IND         NOT > STDP-NBMAX AND                    00110006
                                    > ZERO                              00120006
               MOVE STDP-MAPS    (STDP-IND) TO STDER-NOM-MAPSET         00130001
               MOVE STDP-MAP     (STDP-IND) TO STDER-NOM-MAP            00140001
               MOVE STDP-LIBECR  (STDP-IND) TO STDER-LIB-ECRAN          00150001
           END-IF.                                                      00160001
           MOVE LS-TABTS-NOM (1)        TO STDER-TS-USER (1).           00170001
           MOVE LS-TABTS-NOM (2)        TO STDER-TS-USER (2).           00180001
           MOVE LS-TABTS-NOM (3)        TO STDER-TS-USER (3).           00190001
           MOVE LS-TABTS-NOM (4)        TO STDER-TS-USER (4).           00200001
           MOVE LS-TABTS-NOM (5)        TO STDER-TS-USER (5).           00210001
           MOVE WS-TRAIT-PARM           TO STDER-COMENCH.               00220014
           IF   MTRA-IND        NOT > MTRA-NBMAX AND                    00230006
                                    > ZERO                              00240006
                MOVE MTRA-LIGNE (MTRA-IND)   TO STDER-LIG-MTRA          00250001
           END-IF.                                                      00260001
      *                                                                 00270004
      *$XENDINCLUDE
           EJECT
      *$XINCLUDE ZSTDST9000PE                        STDST9000PE        INL
      * *============================================================*  00010000
      * * 90000     I ABNORMAL END OF PROGRAM                        *  00020024
      * *------------------------------------------------------------*  00030000
      * *                                                            *  00040000
      * *  TS DELETION AND CALL OF ERROR DISPLAY TRANSACTION         *  00050023
      * *                                                            *  00060023
      * *============================================================*  00070000
       90000-TRAIT-ERROR          SECTION.                              00080000
           PERFORM 90000-ERASE.                                         00090000
           PERFORM 90000-ERASE-TSDES.                                   00100000
           PERFORM 90000-ERASE-TSCTX.                                   00110000
           PERFORM 90000-ERASE-TSFONC.                                  00120000
           PERFORM 90000-ERASE-TSAUTO.                                  00130006
      *                                                                 00140003
           IF STDER-DATE        NOT = ZERO                              00150004
              MOVE STDER-DATE           TO WS-ER-COMMAREA-DATE          00160004
              MOVE STDER-HEURE          TO WS-ER-COMMAREA-HEURE         00170004
           ELSE                                                         00180004
              MOVE EIBDATE              TO WS-ER-COMMAREA-DATE          00190004
              MOVE EIBTIME              TO WS-ER-COMMAREA-HEURE         00200004
           END-IF.                                                      00210004
      *                                                                 00220004
           MOVE '01.01.0001'            TO WS-ER-COMMAREA-DATE-DB2.     00230003
           MOVE '01.01.01'              TO WS-ER-COMMAREA-HEURE-DB2.    00240003
           MOVE EIBTASKN                TO WS-ER-COMMAREA-TACHE.        00250003
           MOVE 'ZTER'                  TO WS-ER-COMMAREA-CTRANS.       00260003
           MOVE 'ABEND'                 TO WS-ER-COMMAREA-ORIG.         00270005
           MOVE STDER-TYPE-ERREUR       TO WS-ER-COMMAREA-TYPE.         00280017
           MOVE STDER-USER              TO WS-ER-COMMAREA-USER.         00290017
           MOVE EIBTRNID                TO WS-ER-COMMAREA-ERREUR.       00300018
      *                                                                 00310000
           MOVE WS-STERROR-TRN          TO WS-ZINQUIRE-TRANID.          00320008
           PERFORM 60000-RECHERCHE-TRANID.                              00330008
      *                                                                 00340010
           IF  WS-ZINQUIRE-STATUST NOT = 23                             00350020
               MOVE SPACE                TO LS-MESS                     00360020
               PERFORM 38000-SOR-RETOUR                                 00370020
           END-IF.                                                      00380009
      *                                                                 00390010
           MOVE ZERO                    TO WS-ZINQUIRE-STATUSP.         00400010
      *    EXEC CICS INQUIRE PROGRAM     (WS-ZINQUIRE-PGRMID)           00410010
      *                      STATUS      (WS-ZINQUIRE-STATUSP)          00420010
      *                      NOHANDLE                                   00430010
      *    END-EXEC.                                                    00440010
      *                                                                 00450010
           IF  WS-ZINQUIRE-STATUSP NOT = 23                             00460013
               MOVE SPACE               TO LS-MESS                      00470010
               PERFORM 38000-SOR-RETOUR                                 00480015
           END-IF.                                                      00490010
      *                                                                 00500019
           IF STDER-MESSAGE = 'ABEND STER01T'                           00510019
              MOVE 'ABEND'              TO WS-ER-COMMAREA-ORIG          00520019
              MOVE 'STER01T'            TO WS-ER-COMMAREA-ERREUR        00530019
           END-IF.                                                      00540019
      *                                                                 00550010
           EXEC CICS RETURN TRANSID  (WS-STERROR-TRN)                   00560000
                            IMMEDIATE                                   00570000
                            COMMAREA (WS-ER-COMMAREA)                   00580000
                            LENGTH   (LENGTH OF WS-ER-COMMAREA)         00590000
                            NOHANDLE                                    00600000
           END-EXEC.                                                    00610000
           EJECT                                                        00620000
      * *============================================================*  00630000
      * * 90000     I  DELETION OF SPECIFIC TS                       *  00640023
      * *------------------------------------------------------------*  00650000
      * *                                                            *  00660000
      * *  DELETION OF TS SPECIFIC TO THE PROGRAM                    *  00670023
      * *                                                            *  00680000
      * *============================================================*  00690000
       90000-ERASE              SECTION.                                00700000
      *                                                                 00710000
      * *-----------DESTRUCTION OF TS SPECIFIC TO MULT ITEM PGM         00720023
           IF  LS-TABTS-NBMAX      > +5                                 00730000
               MOVE +5             TO LS-TABTS-NBMAX                    00740000
           END-IF.                                                      00750000
      *                                                                 00760000
           PERFORM 90000-ERASE-TABTS                                    00770000
                   VARYING WS-IND1 FROM 1 BY 1                          00780000
                   UNTIL   WS-IND1 > LS-TABTS-NBMAX.                    00790000
           MOVE ZERO               TO LS-TABTS-NBMAX.                   00800000
           GO TO 90000-ERASE-FIN.                                       00810000
      *                                                                 00820000
       90000-ERASE-TABTS.                                               00830000
           IF  LS-TABTS-NOM (WS-IND1) NOT = SPACE                       00840000
               MOVE LS-TABTS-NOM (WS-IND1)                              00850000
                                   TO WS-TS-NOM                         00860000
               EXEC CICS DELETEQ TS                                     00870000
                         QUEUE (WS-TS-ID)                               00880000
                         NOHANDLE                                       00890000
               END-EXEC                                                 00900000
               MOVE SPACE          TO LS-TABTS-NOM (WS-IND1)            00910000
           END-IF.                                                      00920000
      *                                                                 00930000
       90000-ERASE-FIN.                                                 00940000
             EXIT.                                                      00950000
      *                                                                 00960000
      * *============================================================*  00970000
      * * 90000     I  DELETION OF DESCRIPTOR TS                     *  00980023
      * *------------------------------------------------------------*  00990000
      * *                                                            *  01000000
      * *  DELETION OF THE DESCRIPTOR TS.                            *  01010023
      * *                                                            *  01020000
      * *============================================================*  01030000
       90000-ERASE-TSDES        SECTION.                                01040000
           IF LS-TSDES-IND           NOT = ZERO                         01050000
              MOVE WS-TS-DSCT-NOM  TO WS-TS-NOM                         01060000
              EXEC CICS DELETEQ TS                                      01070000
                                QUEUE (WS-TS-ID)                        01080000
                                NOHANDLE                                01090000
              END-EXEC                                                  01100000
              MOVE ZERO            TO LS-TSDES-IND                      01110000
                                      LS-TSDES-ITEM                     01120000
           END-IF.                                                      01130000
      *                                                                 01140000
      * *============================================================*  01150000
      * * 90000     I  DELETION OF CONTEXT TS                        *  01160023
      * *------------------------------------------------------------*  01170000
      * *                                                            *  01180000
      * *  DELETION OF THE CONTEXT TS.                               *  01190023
      * *                                                            *  01200000
      * *============================================================*  01210000
       90000-ERASE-TSCTX        SECTION.                                01220000
           PERFORM 90000-ERASE-TSUSER.                                  01230000
      *                                                                 01240000
           IF LS-TSCO-IND            NOT = ZERO                         01250000
              MOVE WS-TS-CTXT-NOM  TO WS-TS-NOM                         01260000
              EXEC CICS DELETEQ TS                                      01270000
                                QUEUE (WS-TS-ID)                        01280000
                                NOHANDLE                                01290000
              END-EXEC                                                  01300000
              MOVE 1               TO LS-TSCO-ITEM                      01310000
              MOVE ZERO            TO LS-TSCO-IND                       01320000
           END-IF.                                                      01330000
      *                                                                 01340000
      * *============================================================*  01350000
      * * 90000     I  DELETION OF APPLICATION TS                    *  01360023
      * *------------------------------------------------------------*  01370000
      * *                                                            *  01380000
      * *  DELETION OF APPLICATION TS FOR ALL PREVIOUS LEVELS        *  01390023
      * *  CALLED BY CALL/RETURN.                                    *  01400023
      * *                                                            *  01410000
      * *============================================================*  01420000
       90000-ERASE-TSUSER       SECTION.                                01430000
           IF LS-TSCO-ITEM > 1                                          01440021
              MOVE LS-COMMAREA     TO WS-ZONTRAV                        01450000
              PERFORM 90000-ERAS-TSUSER                                 01460000
                      UNTIL LS-TSCO-ITEM = 1                            01470016
              MOVE WS-ZONTRAV      TO LS-COMMAREA                       01480000
           END-IF.                                                      01490000
      *                                                                 01500000
           GO TO 90000-ERASE-TSUSER-FIN.                                01510000
      *                                                                 01520000
       90000-ERAS-TSUSER.                                               01530000
           SUBTRACT 1         FROM LS-TSCO-ITEM.                        01540016
      *                                                                 01550000
           MOVE WS-TS-CTXT-NOM     TO WS-TS-NOM.                        01560000
           EXEC CICS READQ   TS                                         01570000
                     QUEUE   (WS-TS-ID)                                 01580000
                     INTO    (LS-COMMAREA)                              01590000
                     LENGTH  (WS-LGCOM)                                 01600000
                     ITEM    (LS-TSCO-ITEM)                             01610016
                     NOHANDLE                                           01620000
           END-EXEC.                                                    01630000
      *                                                                 01640000
           PERFORM 90000-ERASE.                                         01650000
      *                                                                 01660000
       90000-ERASE-TSUSER-FIN.                                          01670000
           EXIT.                                                        01680000
      *                                                                 01690000
      * *============================================================*  01700000
      * * 90000     I  DELETION OF INTERFUNCTION TS                *    01710023
      * *------------------------------------------------------------*  01720000
      * *                                                            *  01730000
      * *  DELETION OF THE INTERFUNCTION TS.                         *  01740023
      * *                                                            *  01750000
      * *============================================================*  01760000
       90000-ERASE-TSFONC       SECTION.                                01770000
           IF  LS-TSFONC-NOM          NOT = SPACE                       01780000
               MOVE LS-TSFONC-NOM  TO WS-TS-NOM                         01790000
               EXEC CICS DELETEQ TS                                     01800000
                                 QUEUE (WS-TS-ID)                       01810000
                                 NOHANDLE                               01820000
               END-EXEC                                                 01830000
               MOVE SPACE          TO LS-TSFONC-NOM                     01840000
           END-IF.                                                      01850000
      *                                                                 01860006
      * *============================================================*  01870006
      * * 90000     I  DELETION OF AUTHORIZATION TS                  *  01880023
      * *------------------------------------------------------------*  01890006
      * *                                                            *  01900006
      * *  DELETION OF THE AUTHORIZATION TS.                         *  01910023
      * *                                                            *  01920006
      * *============================================================*  01930006
       90000-ERASE-TSAUTO       SECTION.                                01940006
           MOVE WS-TS-AUTO-NOM     TO WS-TS-NOM.                        01950006
           EXEC CICS DELETEQ TS                                         01960006
                             QUEUE (WS-TS-ID)                           01970006
                             NOHANDLE                                   01980006
           END-EXEC.                                                    01990006
      *$XENDINCLUDE
